import{E as a,s as e,r as s,R as i,Y as l,G as t,x as o,e as c,b as r,c as n,g as d,F as u,p,u as f,o as v,f as m,z as g,y,J as _,n as h,j as k,A as w,t as x,al as j}from"./index-BgH6xnyV.js";import{_ as C}from"./uni-icons.C97tYrvo.js";import{a as T,r as b}from"./uni-app.es.wmAOsoD-.js";import{A,f as P,i as $,g as z}from"./apis.BPdXt_sA.js";import{u as I}from"./video.BFhzdTnD.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const Y=L({__name:"video",setup(L){T((async()=>{console.log("下拉刷新触发"),await Y(),a()}));const Y=async()=>{try{const a={page:1,limit:10},e=await A(a);console.log("API 返回数据:",e),e.data&&e.data.records&&Array.isArray(e.data.records)?(F.value=e.data.records.map((a=>({title:a.title,src:"http://video.caimizm.com/"+a.url,id:a.id,account:a.account,likeCount:a.likeCount,createTime:a.createTime,flag:a.price>0&&a.flag,price:a.price,updateTime:a.updateTime,imgurl:"http://video.caimizm.com/"+a.vimg}))),console.log("更新后的 videoList:",F.value)):console.warn("API 返回数据格式不符合预期:",e)}catch(a){console.error("获取视频失败:",a),e({title:"获取视频失败",icon:"none"})}},q=I(),B=s(["排列五","排列三","七星彩","福彩3D"]),D=s(0),E=s("plw");s("plw"),s("home"),s(["8","6","8","5","7"]),s(["2","0","4","9","3","8","8"]),s("25214期"),s("3225期"),s("follow");const F=s([]);s([]);const G=a=>{const e=a.detail.value;switch(D.value=e,e){case 0:E.value="plw";break;case 1:E.value="pls";break;case 2:E.value="qxc";break;case 3:E.value="fc"}},J=async a=>{try{a.hasPaid=!0,e({title:"支付成功，开始播放",icon:"success"}),p({url:`/pages/video/play?id=${a.id}`})}catch(s){e({title:"支付失败",icon:"none"})}};return i((async()=>{Y()})),(a,s)=>{const i=l("StatusBarPlaceholder"),T=w,A=x,I=b(t("uni-icons"),C),L=f,Y=j;return v(),o(u,null,[c(i),c(T,{class:"photo",src:"/assets/swiper-Cfj1pMYL.png",mode:""}),c(L,{class:"header-container"},{default:r((()=>[c(L,{class:"picker-container"},{default:r((()=>[c(Y,{onChange:G,value:D.value,range:B.value},{default:r((()=>[c(L,{class:"picker"},{default:r((()=>[c(A,{class:"picker-text"},{default:r((()=>[m(g(B.value[D.value]),1)])),_:1}),c(I,{type:"down",size:"16",color:"#333"})])),_:1})])),_:1},8,["value","range"])])),_:1}),c(L,{class:"review-text"},{default:r((()=>[c(A,null,{default:r((()=>[m("精彩回顾")])),_:1})])),_:1})])),_:1}),"plw"===E.value?(v(),n(L,{key:0,class:"area"},{default:r((()=>[(v(!0),o(u,null,y(F.value,((a,s)=>(v(),n(L,{class:"title",key:s},{default:r((()=>[c(L,{class:"video-title"},{default:r((()=>[m(g(a.title),1)])),_:2},1024),_("img",{src:a.imgurl,class:h(["video-image",{"paid-video":a.hasPaid,"free-video":!a.flag}]),onClick:s=>(async a=>{if(!P())return e({title:"请先登录",icon:"none"}),void setTimeout((()=>{p({url:"/pages/login/login"})}),1500);if(q.setCurrentVideo(a),a.flag&&0!==a.price)try{const e=await $({videoId:a.id,account:z()});e.data?e.data?p({url:`/pages/video/play?id=${a.id}`}):k({title:"付费视频",content:`观看此视频需要支付${a.price}金币`,confirmText:"立即支付",cancelText:"取消",success:async e=>{e.confirm&&await J(a)}}):p({url:`/pages/video/play?id=${a.id}`})}catch(s){e({title:s.message||"查询失败",icon:"none"})}else p({url:`/pages/video/play?id=${a.id}`})})(a)},null,10,["src","onClick"]),c(L,{class:"video-info"},{default:r((()=>[a.flag&&a.price>0?(v(),n(A,{key:0,class:"video-price"},{default:r((()=>[m(g(a.hasPaid?"已付费":`付费视频 ${a.price}金币`),1)])),_:2},1024)):(v(),n(A,{key:1,class:"video-free"},{default:r((()=>[m("免费视频")])),_:1}))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):d("",!0),c(L,{class:"publish-btn",onClick:s[0]||(s[0]=a=>{p({url:"/pages/video/oss"})})},{default:r((()=>[c(I,{type:"plus",size:"20",color:"#fff"})])),_:1})],64)}}},[["__scopeId","data-v-ce3f3997"]]);export{Y as default};
