import{r as e,R as a,l,s as t,G as s,c,b as n,aq as o,u,o as i,e as r,f as d,y as v,z as m,x as f,F as g,g as _,k as y,j as p,a6 as h,q as k,t as $,I as b,v as w,A as x}from"./index-D0AdlXYI.js";import{_ as C}from"./uni-icons.E5IxVglq.js";import{r as I}from"./uni-app.es.DeTReHEE.js";import{H as P,g as z}from"./apis.BsLnrVmb.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=j({__name:"dream-interpretation",setup(j){const S=e([]),U=e(!1),A=e(!1),E=e(""),L=e([]),M=e(!1),T=e(1),F=e(10),O=e(0),R=e(0),V=e(!1),q=e(!0),B=e(["苍蝇幼虫","走私被捕","剪刀割手","跳楼","伯父死了","失踪少女"]),D=e([]),H=(e,a)=>{if(!e||!a)return"";const l="http://video.caimizm.com";if(a.startsWith("http"))return a;if(a.startsWith("/"))return`${l}${a}`;const t=[`${l}/web/image/${e}/${a}`,`${l}/web/dream/image/${e}`,`${l}/api/image/${e}`,`${l}/images/${e}/${a}`,`${l}/static/images/${a}`],s=t[0];return console.log("构建图片URL:",{id:e,imgName:a,url:s,allPaths:t}),s},W=()=>!!z(),G=()=>new Promise((e=>{o({success:a=>e("none"!==a.networkType),fail:()=>e(!0)})})),N=async(e,a="1",l="10",s=!1)=>{try{if(s?V.value=!0:U.value=!0,!W())return void t({title:"请先登录",icon:"none"});if(!(await G()))return void t({title:"网络连接不可用",icon:"none"});const c=await P({content:e,page:a,limit:l}),n=c.data.records||[];s?S.value=[...S.value,...n]:(S.value=n,T.value=1),R.value=c.data.total||0,O.value=Math.ceil(R.value/F.value),T.value=parseInt(a),q.value=T.value<O.value,A.value=!0,console.log("API返回的数据:",c.data),console.log("梦境解析结果:",S.value),console.log("分页信息:",{currentPage:T.value,totalPages:O.value,totalRecords:R.value}),s||t({title:"查询成功",icon:"success"})}catch(c){t({title:c.errMsg||c.msg||"查询失败，请重试",icon:"none"})}finally{s?V.value=!1:U.value=!1}},J=async()=>{E.value.trim()?W()?(M.value=!1,await N(E.value,"1",F.value.toString(),!1),X(E.value)):t({title:"请先登录",icon:"none"}):t({title:"请输入梦境关键词",icon:"none"})},K=async()=>{if(!q.value||V.value)return;const e=T.value+1;await N(E.value,e.toString(),F.value.toString(),!0)},Q=()=>{M.value=!0},X=e=>{const a=new Date,l=`${a.getMonth()+1}-${a.getDate()} ${a.getHours()}:${a.getMinutes().toString().padStart(2,"0")}`,t={keyword:e,time:l},s=L.value.findIndex((a=>a.keyword===e));s>-1&&L.value.splice(s,1),L.value.unshift(t),L.value.length>10&&(L.value=L.value.slice(0,10)),y("dream_history",L.value)},Y=()=>{p({title:"提示",content:"确定要清除所有历史记录吗？",success:e=>{e.confirm&&(L.value=[],h("dream_history"),t({title:"已清除历史记录",icon:"success"}))}})},Z=()=>{k()};a((async()=>{const e=l("dream_history");e&&(L.value=e),await ee()}));const ee=async()=>{try{if(U.value=!0,!W())return void t({title:"请先登录",icon:"none"});if(!(await G()))return void t({title:"网络连接不可用",icon:"none"});const e=await P({content:"",page:"1",limit:"4"});S.value=e.data.records||[],A.value=!0,console.log("默认加载的数据:",e.data),console.log("梦境解析结果:",S.value)}catch(e){console.log("默认数据加载失败:",e)}finally{U.value=!1}};return(e,a)=>{const l=$,t=u,o=I(s("uni-icons"),C),y=b,p=w,h=x;return i(),c(t,{class:"dream-container"},{default:n((()=>[r(t,{class:"navbar"},{default:n((()=>[r(t,{class:"nav-content"},{default:n((()=>[r(t,{class:"nav-left",onClick:Z},{default:n((()=>[r(l,{class:"back-arrow"},{default:n((()=>[d("‹")])),_:1})])),_:1}),r(l,{class:"nav-title"},{default:n((()=>[d("解梦")])),_:1}),r(t,{class:"nav-right"})])),_:1})])),_:1}),r(t,{class:"main-content"},{default:n((()=>[r(t,{class:"search-section"},{default:n((()=>[r(t,{class:"search-input-wrapper",onClick:Q},{default:n((()=>[r(o,{type:"search",size:"16",color:"#999"}),r(y,{type:"text",placeholder:"梦境关键词或者号码",class:"search-input",modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),onConfirm:J,onFocus:Q},null,8,["modelValue"])])),_:1}),r(p,{class:"search-btn",onClick:J},{default:n((()=>[d("搜索")])),_:1})])),_:1}),M.value?(i(),c(t,{key:0,class:"search-overlay"},{default:n((()=>[L.value.length>0?(i(),c(t,{key:0,class:"history-search-section"},{default:n((()=>[r(t,{class:"section-header"},{default:n((()=>[r(l,{class:"section-title"},{default:n((()=>[d("历史搜索")])),_:1}),r(t,{class:"clear-btn",onClick:Y},{default:n((()=>[r(o,{type:"trash",size:"16",color:"#999"})])),_:1})])),_:1}),r(t,{class:"history-tags"},{default:n((()=>[(i(!0),v(g,null,m(L.value,((e,a)=>(i(),c(t,{class:"history-tag",key:a,onClick:a=>{return l=e.keyword,E.value=l,M.value=!1,void J();var l}},{default:n((()=>[d(f(e.keyword),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):_("",!0),r(t,{class:"popular-dreams-section"},{default:n((()=>[r(l,{class:"section-title"},{default:n((()=>[d("热门梦境")])),_:1}),r(t,{class:"popular-tags"},{default:n((()=>[(i(!0),v(g,null,m(B.value,((e,a)=>(i(),c(t,{class:"popular-tag",key:a,onClick:a=>{return l=e,E.value=l,M.value=!1,void J();var l}},{default:n((()=>[d(f(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),r(t,{class:"tip-section"},{default:n((()=>[r(l,{class:"tip-title"},{default:n((()=>[d("【温馨提示】")])),_:1}),r(l,{class:"tip-content"},{default:n((()=>[d("解梦仅提供参考,切勿深信!")])),_:1})])),_:1})])),_:1})):_("",!0),M.value?_("",!0):(i(),c(t,{key:1,class:"category-section"},{default:n((()=>[r(l,{class:"section-title"}),r(t,{class:"category-grid"},{default:n((()=>[(i(!0),v(g,null,m(D.value,((e,a)=>(i(),c(t,{class:"category-card",key:a,onClick:a=>(e=>{E.value=e.keyword,J()})(e)},{default:n((()=>[r(t,{class:"card-icon"},{default:n((()=>[r(l,{class:"icon-text"},{default:n((()=>[d(f(e.icon),1)])),_:2},1024)])),_:2},1024),r(l,{class:"card-title"},{default:n((()=>[d(f(e.name),1)])),_:2},1024),r(t,{class:"card-numbers"},{default:n((()=>[r(l,{class:"number-text"},{default:n((()=>[d(f(e.numbers[0]),1)])),_:2},1024),r(l,{class:"number-text"},{default:n((()=>[d(f(e.numbers[1]),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})),S.value.length>0?(i(),c(t,{key:2,class:"result-section"},{default:n((()=>[A.value&&E.value?(i(),c(l,{key:0,class:"result-count"},{default:n((()=>[d("为您找到 "+f(S.value.length)+" 个结果",1)])),_:1})):(i(),c(l,{key:1,class:"result-count"},{default:n((()=>[d("推荐梦境解析")])),_:1})),r(t,{class:"result-list"},{default:n((()=>[(i(!0),v(g,null,m(S.value,((e,a)=>(i(),c(t,{class:"result-card",key:a},{default:n((()=>[r(t,{class:"card-image-section"},{default:n((()=>[r(t,{class:"card-image"},{default:n((()=>[!e.imageError&&e.img?(i(),c(h,{key:0,src:e.currentImageUrl||H(e.id,e.img),mode:"aspectFill",class:"dream-image",onError:a=>((e,a)=>{if(console.log("图片加载失败:",e.img),e.imageError=!0,e.currentImageUrl="",!e.triedAlternativePaths){e.triedAlternativePaths=!0;const a="http://video.caimizm.com",l=[`${a}/web/dream/image/${e.id}`,`${a}/api/image/${e.id}`,`${a}/images/${e.id}/${e.img}`,`${a}/static/images/${e.img}`],t=e.currentPathIndex||0;t<l.length&&(e.currentPathIndex=t+1,e.currentImageUrl=l[t],console.log("尝试备用图片路径:",l[t]))}})(e),onLoad:a=>((e,a)=>{e.imageLoaded=!0})(e)},null,8,["src","onError","onLoad"])):(i(),c(t,{key:1,class:"default-icon"},{default:n((()=>[r(l,{class:"icon-text"})])),_:1}))])),_:2},1024)])),_:2},1024),r(t,{class:"card-content-section"},{default:n((()=>[r(l,{class:"card-title"},{default:n((()=>[d(f(e.content),1)])),_:2},1024),e.numberOne||e.numberTwo?(i(),c(t,{key:0,class:"card-numbers-section"},{default:n((()=>[e.numberOne?(i(),c(l,{key:0,class:"number-text"},{default:n((()=>[d(f(e.numberOne),1)])),_:2},1024)):_("",!0),e.numberTwo?(i(),c(l,{key:1,class:"number-text"},{default:n((()=>[d(f(e.numberTwo),1)])),_:2},1024)):_("",!0)])),_:2},1024)):_("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):_("",!0),S.value.length>0&&q.value&&!U.value?(i(),c(t,{key:3,class:"load-more-section"},{default:n((()=>[r(p,{class:"load-more-btn",onClick:K,disabled:V.value},{default:n((()=>[V.value?(i(),c(o,{key:0,type:"spinner-cycle",size:"16",color:"#28B389"})):(i(),c(l,{key:1,class:"load-more-text"},{default:n((()=>[d("加载更多")])),_:1})),r(l,{class:"page-info"},{default:n((()=>[d("("+f(T.value)+"/"+f(O.value)+")",1)])),_:1})])),_:1},8,["disabled"])])),_:1})):_("",!0),S.value.length>0&&!q.value&&!U.value?(i(),c(t,{key:4,class:"no-more-section"},{default:n((()=>[r(l,{class:"no-more-text"},{default:n((()=>[d("已显示全部 "+f(R.value)+" 条结果",1)])),_:1})])),_:1})):_("",!0),U.value?(i(),c(t,{key:5,class:"loading-section"},{default:n((()=>[r(o,{type:"spinner-cycle",size:"24",color:"#28B389"}),r(l,{class:"loading-text"},{default:n((()=>[d("正在解析梦境...")])),_:1})])),_:1})):_("",!0),!U.value&&0===S.value.length&&A.value&&E.value?(i(),c(t,{key:6,class:"empty-section"},{default:n((()=>[r(o,{type:"info",size:"48",color:"#ccc"}),r(l,{class:"empty-text"},{default:n((()=>[d("暂无相关梦境解析")])),_:1})])),_:1})):_("",!0)])),_:1})])),_:1})}}},[["__scopeId","data-v-5be869dd"]]);export{S as default};
