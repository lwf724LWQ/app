import{r as e,C as a,R as l,s as t,p as s,c as u,b as n,u as c,o,e as i,f as r,x as v,g as d,y as f,z as _,n as g,F as m,H as p,q as k,t as y,ao as h}from"./index-D0AdlXYI.js";import{f as w}from"./uni-app.es.DeTReHEE.js";import{K as D,g as T,f as x}from"./apis.BsLnrVmb.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=b({__name:"transaction",setup(b){const C=e("all"),M=e("");e(!1);const F=e(!1),Y=e(!0),$=e(1),S=e(20),E=e(0),V=e(!1),j=e(!1),I=e("all");e("all");const L=e(!1),R=e("month"),H=e(2025),O=e(9),X=e(null),q=e(null),z=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],K=e(2023),A=e(10),B=e(0),G=e(0),J=e(0),N=e(0),P=e(!0),Q=e([]),U=a((()=>{let e=Q.value;if(e=X.value&&q.value?e.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()),s=new Date(X.value.getFullYear(),X.value.getMonth(),X.value.getDate()),u=new Date(q.value.getFullYear(),q.value.getMonth(),q.value.getDate());return t.getTime()>=s.getTime()&&t.getTime()<=u.getTime()})):e.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a);return l.getFullYear()===H.value&&l.getMonth()+1===O.value})),"all"!==C.value){const a={income:0,expense:1};e=e.filter((e=>e.type===a[C.value]))}if(M.value.trim()){const a=M.value.trim().toLowerCase();e=e.filter((e=>e.remark&&e.remark.toLowerCase().includes(a)||e.account&&e.account.toLowerCase().includes(a)))}return e})),W=a((()=>{const e=H.value,a=O.value,l=new Date(e,a-1,1),t=new Date(e,a,0),s=l.getDay(),u=t.getDate(),n=[];for(let c=0;c<s;c++)n.push({date:"",isEmpty:!0});for(let c=1;c<=u;c++){const l=new Date(e,a-1,c),t=new Date,s=l.getFullYear()===t.getFullYear()&&l.getMonth()===t.getMonth()&&l.getDate()===t.getDate(),u=X.value&&l.getTime()===X.value.getTime(),o=q.value&&l.getTime()===q.value.getTime(),i=X.value&&q.value&&l.getTime()>=X.value.getTime()&&l.getTime()<=q.value.getTime();n.push({date:c,fullDate:l,isStart:u,isEnd:o,isInRange:i,isToday:s,isEmpty:!1})}return n})),Z=a((()=>{const e=(new Date).getFullYear(),a=[];for(let l=e-5;l<=e+2;l++)a.push(l);return a})),ee=a((()=>[1,2,3,4,5,6,7,8,9,10,11,12])),ae=a((()=>{if("range"===R.value&&X.value&&q.value){const e=ge(X.value),a=ge(q.value);return e===a?e:`${e} - ${a}`}return"range"===R.value&&X.value?ge(X.value):`${H.value}å¹´${O.value}æœˆ`})),le=a((()=>"range"===R.value&&(X.value||q.value))),te=a((()=>{let e=[];e=X.value&&q.value?Q.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()),s=new Date(X.value.getFullYear(),X.value.getMonth(),X.value.getDate()),u=new Date(q.value.getFullYear(),q.value.getMonth(),q.value.getDate());return t.getTime()>=s.getTime()&&t.getTime()<=u.getTime()&&1===e.type})):Q.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a);return l.getFullYear()===H.value&&l.getMonth()+1===O.value&&1===e.type}));return e.reduce(((e,a)=>e+(a.amount||0)),0).toFixed(2)})),se=a((()=>{let e=[];e=X.value&&q.value?Q.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()),s=new Date(X.value.getFullYear(),X.value.getMonth(),X.value.getDate()),u=new Date(q.value.getFullYear(),q.value.getMonth(),q.value.getDate());return t.getTime()>=s.getTime()&&t.getTime()<=u.getTime()&&0===e.type})):Q.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a);return l.getFullYear()===H.value&&l.getMonth()+1===O.value&&0===e.type}));return e.reduce(((e,a)=>e+(a.amount||0)),0).toFixed(2)})),ue=()=>{k()},ne=()=>{j.value=!0},ce=()=>{console.log("è·³è½¬åˆ°ç»Ÿè®¡é¡µé¢")},oe=()=>{L.value=!0,K.value=H.value,A.value=O.value,"range"===R.value&&(X.value||(X.value=new Date(2025,8,3)),q.value||(q.value=new Date(2025,9,2)))},ie=()=>{j.value=!1},re=e=>{I.value=e},ve=()=>{C.value=I.value,ie(),$.value=1,Ce(!0)},de=()=>{L.value=!1},fe=e=>{R.value=e},_e=e=>e.isEmpty?"empty":e.isStart?"start-date":e.isEnd?"end-date":e.isInRange?"in-range":"normal",ge=e=>e?`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥`:"",me=async()=>{"month"===R.value?(H.value=K.value,O.value=A.value,X.value=null,q.value=null):"range"===R.value&&(X.value&&!q.value&&(q.value=new Date(X.value)),X.value&&(H.value=X.value.getFullYear(),O.value=X.value.getMonth()+1)),de(),$.value=1,await Ce(!0)},pe=()=>{1===O.value?(O.value=12,H.value-=1):O.value-=1},ke=()=>{12===O.value?(O.value=1,H.value+=1):O.value+=1},ye=()=>{R.value="month",K.value=H.value,A.value=O.value},he=e=>{if(!P.value)return;const a=e.touches[0];J.value=a.clientY,N.value=a.clientX},we=e=>{},De=e=>{if(!P.value)return;const a=e.changedTouches[0],l=a.clientY-J.value,t=a.clientX-N.value;Math.abs(l)>Math.abs(t)&&Math.abs(l)>50&&(l>0?pe():ke())},Te=e=>{if(!e)return"";const a=new Date(e);return`${a.getMonth()+1}-${a.getDate()} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},xe=e=>0===e?"recharge":"consume",be=()=>{const e=T(),a=x();return e&&""!==e.trim()?e.includes(".")?e.length<50?{isValid:!1,reason:"token_too_short"}:{isValid:!0,token:e,account:a}:{isValid:!1,reason:"token_format_invalid"}:{isValid:!1,reason:"token_missing"}},Ce=async(e=!1)=>{var a,l,u;if(V.value)console.log("æ­£åœ¨åŠ è½½è´¦å•æ•°æ®ï¼Œè·³è¿‡é‡å¤è¯·æ±‚");else try{V.value=!0,F.value=!0;const n=be();if(!n.isValid){let e="è¯·å…ˆç™»å½•";return"token_format_invalid"===n.reason?e="ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡æ–°ç™»å½•":"token_too_short"===n.reason&&(e="ç™»å½•ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¯·é‡æ–°ç™»å½•"),t({title:e,icon:"none"}),void setTimeout((()=>{s({url:"/pages/login/login"})}),1500)}const{token:c,account:o}=n,i={account:o||c,page:$.value.toString(),limit:S.value.toString()},r=await D(i);if(200===r.code){const s=(null==(a=r.data)?void 0:a.records)||[];e?(Q.value=s,$.value=1):1===$.value?Q.value=s:Q.value=[...Q.value,...s];const n=(null==(l=r.data)?void 0:l.pages)||1;Y.value=$.value<n,E.value=(null==(u=r.data)?void 0:u.total)||0,0===s.length&&1===$.value&&t({title:"æš‚æ— è´¦å•æ•°æ®",icon:"none",duration:2e3})}else t({title:r.msg||"èŽ·å–è´¦å•å¤±è´¥",icon:"none"})}catch(n){t({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•",icon:"none"})}finally{F.value=!1,V.value=!1}},Me=()=>{!F.value&&Y.value&&($.value++,Ce(!1))},Fe=()=>be().isValid;return l((async()=>{Fe()?await Ce(!0):(t({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout((()=>{s({url:"/pages/login/login"})}),1500))})),w((async()=>{Fe()?0!==Q.value.length||F.value||await Ce(!0):(t({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout((()=>{s({url:"/pages/login/login"})}),1500))})),(e,a)=>{const l=y,t=c,s=h;return o(),u(t,{class:"transaction-container"},{default:n((()=>[i(t,{class:"navbar"},{default:n((()=>[i(t,{class:"nav-content"},{default:n((()=>[i(t,{class:"nav-left",onClick:ue},{default:n((()=>[i(l,{class:"back-arrow"},{default:n((()=>[r("Ã—")])),_:1})])),_:1}),i(l,{class:"nav-title"},{default:n((()=>[r("è´¦å•")])),_:1}),i(t,{class:"nav-right"},{default:n((()=>[i(l,{class:"more-icon"},{default:n((()=>[r("â‹¯")])),_:1})])),_:1})])),_:1})])),_:1}),i(t,{class:"main-content"},{default:n((()=>[i(t,{class:"filter-section"},{default:n((()=>[i(t,{class:"filter-bar"},{default:n((()=>[i(t,{class:"filter-dropdown",onClick:ne},{default:n((()=>[i(l,{class:"filter-text"},{default:n((()=>[r("å…¨éƒ¨è´¦å•")])),_:1}),i(l,{class:"dropdown-arrow"},{default:n((()=>[r("â–¼")])),_:1})])),_:1}),i(t,{class:"statistics-link",onClick:ce},{default:n((()=>[i(l,{class:"statistics-text"},{default:n((()=>[r("æ”¶æ”¯ç»Ÿè®¡")])),_:1}),i(l,{class:"chevron"},{default:n((()=>[r(">")])),_:1})])),_:1})])),_:1}),i(t,{class:"monthly-summary"},{default:n((()=>[i(t,{class:"month-selector",onClick:oe},{default:n((()=>[i(l,{class:"month-text"},{default:n((()=>[r(v(ae.value),1)])),_:1}),i(l,{class:"dropdown-arrow"},{default:n((()=>[r("â–¼")])),_:1})])),_:1}),le.value?X.value&&q.value&&ge(X.value)===ge(q.value)?(o(),u(t,{key:1,class:"summary-amounts"},{default:n((()=>[i(l,{class:"expense-amount"},{default:n((()=>[r("æ”¯å‡ºÂ¥"+v(te.value),1)])),_:1}),i(l,{class:"income-amount"},{default:n((()=>[r("æ”¶å…¥Â¥"+v(se.value),1)])),_:1})])),_:1})):d("",!0):(o(),u(t,{key:0,class:"summary-amounts"},{default:n((()=>[i(l,{class:"expense-amount"},{default:n((()=>[r("æ”¯å‡ºÂ¥"+v(te.value),1)])),_:1}),i(l,{class:"income-amount"},{default:n((()=>[r("æ”¶å…¥Â¥"+v(se.value),1)])),_:1})])),_:1}))])),_:1})])),_:1}),i(t,{class:"transaction-list"},{default:n((()=>[(o(!0),f(m,null,_(U.value,((e,a)=>(o(),u(t,{class:"transaction-item",key:e.id||a},{default:n((()=>[i(t,{class:"transaction-icon"},{default:n((()=>[i(t,{class:g(["icon-wrapper",xe(e.type)])},{default:n((()=>[i(l,{class:"icon-text"},{default:n((()=>{return[r(v((a=e.type,0===a?"ðŸ’°":"ðŸ’¸")),1)];var a})),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),i(t,{class:"transaction-content"},{default:n((()=>[i(l,{class:"transaction-title"},{default:n((()=>[r(v(e.remark||"è´¦å•è®°å½•"),1)])),_:2},1024),i(l,{class:"transaction-desc"},{default:n((()=>[r(v(e.account||"è´¦å•è¯¦æƒ…"),1)])),_:2},1024),i(l,{class:"transaction-time"},{default:n((()=>[r(v(Te(e.createTime)),1)])),_:2},1024)])),_:2},1024),i(t,{class:g(["transaction-amount",xe(e.type)])},{default:n((()=>[i(l,{class:"amount-text"},{default:n((()=>[r(v(0===e.type?"+":"-")+v(e.amount||0),1)])),_:2},1024),i(l,{class:"amount-unit"},{default:n((()=>[r("é‡‘å¸")])),_:1})])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1}),U.value.length>0?(o(),u(t,{key:0,class:"load-more"},{default:n((()=>[F.value?(o(),u(l,{key:0,class:"load-more-text"},{default:n((()=>[r("åŠ è½½ä¸­...")])),_:1})):Y.value?(o(),u(l,{key:2,class:"load-more-text",onClick:Me},{default:n((()=>[r("ç‚¹å‡»åŠ è½½æ›´å¤š")])),_:1})):(o(),u(l,{key:1,class:"load-more-text"},{default:n((()=>[r("å·²æ˜¾ç¤ºå…¨éƒ¨è®°å½•")])),_:1}))])),_:1})):d("",!0),F.value&&0===Q.value.length?(o(),u(t,{key:1,class:"loading-state"},{default:n((()=>[i(l,{class:"loading-text"},{default:n((()=>[r("åŠ è½½ä¸­...")])),_:1})])),_:1})):d("",!0)])),_:1}),j.value?(o(),u(t,{key:0,class:"filter-modal",onClick:ie},{default:n((()=>[i(t,{class:"filter-content",onClick:a[3]||(a[3]=p((()=>{}),["stop"]))},{default:n((()=>[i(t,{class:"filter-header"},{default:n((()=>[i(l,{class:"filter-title"},{default:n((()=>[r("é€‰æ‹©ç­›é€‰é¡¹")])),_:1})])),_:1}),i(t,{class:"filter-body"},{default:n((()=>[i(t,{class:"filter-group"},{default:n((()=>[i(l,{class:"filter-group-title"},{default:n((()=>[r("æ”¶æ”¯ç±»åž‹")])),_:1}),i(t,{class:"filter-options"},{default:n((()=>[i(t,{class:g(["filter-option",{active:"all"===I.value}]),onClick:a[0]||(a[0]=e=>re("all"))},{default:n((()=>[i(l,{class:"option-text"},{default:n((()=>[r("å…¨éƒ¨")])),_:1})])),_:1},8,["class"]),i(t,{class:g(["filter-option",{active:"expense"===I.value}]),onClick:a[1]||(a[1]=e=>re("expense"))},{default:n((()=>[i(l,{class:"option-text"},{default:n((()=>[r("æ”¯å‡º")])),_:1})])),_:1},8,["class"]),i(t,{class:g(["filter-option",{active:"income"===I.value}]),onClick:a[2]||(a[2]=e=>re("income"))},{default:n((()=>[i(l,{class:"option-text"},{default:n((()=>[r("æ”¶å…¥")])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),i(t,{class:"filter-group"})])),_:1}),i(t,{class:"filter-footer"},{default:n((()=>[i(t,{class:"btn cancel-btn",onClick:ie},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("å–æ¶ˆ")])),_:1})])),_:1}),i(t,{class:"btn confirm-btn",onClick:ve},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("ç¡®å®š")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0),L.value?(o(),u(t,{key:1,class:"calendar-modal",onClick:de},{default:n((()=>[i(t,{class:"calendar-content",onClick:a[6]||(a[6]=p((()=>{}),["stop"]))},{default:n((()=>[i(t,{class:"calendar-header"},{default:n((()=>[i(t,{class:"calendar-nav"},{default:n((()=>[i(l,{class:"close-btn",onClick:de},{default:n((()=>[r("Ã—")])),_:1}),i(l,{class:"calendar-title"},{default:n((()=>[r("é€‰æ‹©æ—¥æœŸ")])),_:1}),i(t,{class:"nav-spacer"})])),_:1}),i(t,{class:"selection-tabs"},{default:n((()=>[i(t,{class:g(["tab-item",{active:"month"===R.value}]),onClick:a[4]||(a[4]=e=>fe("month"))},{default:n((()=>[i(l,{class:"tab-text"},{default:n((()=>[r("é€‰æ‹©æœˆä»½")])),_:1})])),_:1},8,["class"]),i(t,{class:g(["tab-item",{active:"range"===R.value}]),onClick:a[5]||(a[5]=e=>fe("range"))},{default:n((()=>[i(l,{class:"tab-text"},{default:n((()=>[r("é€‰æ‹©æ—¶é—´æ®µ")])),_:1})])),_:1},8,["class"])])),_:1}),"range"===R.value?(o(),u(t,{key:0,class:"current-selection"},{default:n((()=>[i(t,{class:"date-range-display"},{default:n((()=>[i(t,{class:"date-item"},{default:n((()=>[i(l,{class:"date-label"},{default:n((()=>[r("å¼€å§‹æ—¥æœŸ")])),_:1}),i(l,{class:"date-value"},{default:n((()=>[r(v(X.value?ge(X.value):"è¯·é€‰æ‹©"),1)])),_:1})])),_:1}),i(l,{class:"date-separator"},{default:n((()=>[r("è‡³")])),_:1}),i(t,{class:"date-item"},{default:n((()=>[i(l,{class:"date-label"},{default:n((()=>[r("ç»“æŸæ—¥æœŸ")])),_:1}),i(l,{class:"date-value"},{default:n((()=>[r(v(q.value?ge(q.value):"è¯·é€‰æ‹©"),1)])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)])),_:1}),i(t,{class:"calendar-body"},{default:n((()=>["month"===R.value?(o(),u(t,{key:0,class:"month-picker"},{default:n((()=>[i(t,{class:"picker-container"},{default:n((()=>[i(t,{class:"year-picker"},{default:n((()=>[i(s,{class:"picker-scroll","scroll-y":"true","scroll-top":B.value},{default:n((()=>[(o(!0),f(m,null,_(Z.value,(e=>(o(),u(t,{class:g(["picker-item",{active:K.value===e}]),key:e,onClick:a=>(e=>{K.value=e;const a=Z.value.indexOf(e);B.value=60*a})(e)},{default:n((()=>[i(l,{class:"picker-text"},{default:n((()=>[r(v(e)+"å¹´",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["scroll-top"])])),_:1}),i(t,{class:"month-picker-list"},{default:n((()=>[i(s,{class:"picker-scroll","scroll-y":"true","scroll-top":G.value},{default:n((()=>[(o(!0),f(m,null,_(ee.value,(e=>(o(),u(t,{class:g(["picker-item",{active:A.value===e}]),key:e,onClick:a=>(e=>{A.value=e;const a=ee.value.indexOf(e);G.value=60*a})(e)},{default:n((()=>[i(l,{class:"picker-text"},{default:n((()=>[r(v(e)+"æœˆ",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["scroll-top"])])),_:1})])),_:1})])),_:1})):(o(),u(t,{key:1,class:"date-range-picker"},{default:n((()=>[i(t,{class:"month-navigation"},{default:n((()=>[i(t,{class:"nav-arrow",onClick:pe},{default:n((()=>[i(l,{class:"arrow-icon"},{default:n((()=>[r("â€¹")])),_:1})])),_:1}),i(t,{class:"month-year",onClick:ye},{default:n((()=>[i(l,{class:"month-year-text"},{default:n((()=>[r(v(H.value)+"å¹´ "+v(O.value)+"æœˆ",1)])),_:1}),i(l,{class:"month-dropdown"},{default:n((()=>[r("â–¼")])),_:1})])),_:1}),i(t,{class:"nav-arrow",onClick:ke},{default:n((()=>[i(l,{class:"arrow-icon"},{default:n((()=>[r("â€º")])),_:1})])),_:1})])),_:1}),i(t,{class:"calendar-grid",onTouchstart:he,onTouchmove:we,onTouchend:De},{default:n((()=>[i(t,{class:"weekdays"},{default:n((()=>[(o(),f(m,null,_(z,(e=>i(l,{class:"weekday",key:e},{default:n((()=>[r(v(e),1)])),_:2},1024))),64))])),_:1}),i(t,{class:"days-grid"},{default:n((()=>[(o(!0),f(m,null,_(W.value,((e,a)=>(o(),u(t,{class:g(["day-item",_e(e)]),key:a,onClick:a=>(e=>{e.isEmpty||"range"===R.value&&(!X.value||X.value&&q.value?(X.value=e.fullDate,q.value=null):X.value&&!q.value&&(e.fullDate.getTime()>=X.value.getTime()?q.value=e.fullDate:(q.value=X.value,X.value=e.fullDate)))})(e)},{default:n((()=>[i(l,{class:"day-number"},{default:n((()=>[r(v(e.date),1)])),_:2},1024),e.isStart?(o(),u(l,{key:0,class:"day-label"},{default:n((()=>[r("å¼€å§‹")])),_:1})):d("",!0),e.isToday?(o(),u(l,{key:1,class:"day-label"},{default:n((()=>[r("ä»Šå¤©")])),_:1})):d("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}))])),_:1}),i(t,{class:"calendar-footer"},{default:n((()=>[i(t,{class:"btn cancel-btn",onClick:de},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("å–æ¶ˆ")])),_:1})])),_:1}),i(t,{class:"btn confirm-btn",onClick:me},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("ç¡®å®š")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)])),_:1})}}},[["__scopeId","data-v-b0d0a0d3"]]);export{C as default};
