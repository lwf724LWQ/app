import{r as a,C as e,R as s,o as t,c as l,K as i,N as o,u as c,E as r,s as n,G as u,y as d,e as p,b as f,g as v,F as m,p as g,f as y,x as _,z as h,J as k,n as w,j as x,A as C,t as b,am as j}from"./index-D0AdlXYI.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{a as $,r as A}from"./uni-app.es.DeTReHEE.js";import{_ as P}from"./uni-icons.E5IxVglq.js";import{B as z,g as I,j as B,f as L}from"./apis.BsLnrVmb.js";import{u as S}from"./video.xuvhOoAH.js";const q=T({__name:"StatusBarPlaceholder",setup(r){const n=a("0px"),u=a({top:0}),d=e((()=>({height:n.value,paddingTop:`${u.value.top||0}px`,backgroundColor:"#ffffff"})));return s((()=>{(()=>{try{const a=o();n.value=`${a.statusBarHeight||0}px`,a.safeArea&&(u.value=a.safeArea)}catch(a){console.error("获取系统信息失败:",a),n.value="20px"}})()})),(a,e)=>{const s=c;return t(),l(s,{class:"status-bar-white",style:i(d.value)},null,8,["style"])}}},[["__scopeId","data-v-14dbda63"]]),D=T({__name:"video",setup(e){$((async()=>{console.log("下拉刷新触发"),await i(),r()}));const i=async()=>{try{const a={page:1,limit:10},e=await z(a);console.log("API 返回数据:",e),e.data&&e.data.records&&Array.isArray(e.data.records)?(F.value=e.data.records.map((a=>({title:a.title,src:"http://video.caimizm.com/"+a.url,id:a.id,account:a.account,likeCount:a.likeCount,createTime:a.createTime,flag:a.price>0&&a.flag,price:a.price,updateTime:a.updateTime,imgurl:"http://video.caimizm.com/"+a.vimg}))),console.log("更新后的 videoList:",F.value)):console.warn("API 返回数据格式不符合预期:",e)}catch(a){console.error("获取视频失败:",a),n({title:"获取视频失败",icon:"none"})}},o=S(),T=a(["排列五","排列三","七星彩","福彩3D"]),D=a(0),E=a("plw");a("plw"),a("home"),a(["8","6","8","5","7"]),a(["2","0","4","9","3","8","8"]),a("25214期"),a("3225期"),a("follow");const F=a([]);a([]);const G=a=>{const e=a.detail.value;switch(D.value=e,e){case 0:E.value="plw";break;case 1:E.value="pls";break;case 2:E.value="qxc";break;case 3:E.value="fc"}},H=async a=>{try{a.hasPaid=!0,n({title:"支付成功，开始播放",icon:"success"}),g({url:`/pages/video/play?id=${a.id}`})}catch(e){n({title:"支付失败",icon:"none"})}};return s((async()=>{i()})),(a,e)=>{const s=A(u("StatusBarPlaceholder"),q),i=C,r=b,$=A(u("uni-icons"),P),z=c,S=j;return t(),d(m,null,[p(s),p(i,{class:"photo",src:"/assets/swiper-Cfj1pMYL.png",mode:""}),p(z,{class:"header-container"},{default:f((()=>[p(z,{class:"picker-container"},{default:f((()=>[p(S,{onChange:G,value:D.value,range:T.value},{default:f((()=>[p(z,{class:"picker"},{default:f((()=>[p(r,{class:"picker-text"},{default:f((()=>[y(_(T.value[D.value]),1)])),_:1}),p($,{type:"down",size:"16",color:"#333"})])),_:1})])),_:1},8,["value","range"])])),_:1}),p(z,{class:"review-text"},{default:f((()=>[p(r,null,{default:f((()=>[y("精彩回顾")])),_:1})])),_:1})])),_:1}),"plw"===E.value?(t(),l(z,{key:0,class:"area"},{default:f((()=>[(t(!0),d(m,null,h(F.value,((a,e)=>(t(),l(z,{class:"title",key:e},{default:f((()=>[p(z,{class:"video-title"},{default:f((()=>[y(_(a.title),1)])),_:2},1024),k("img",{src:a.imgurl,class:w(["video-image",{"paid-video":a.hasPaid,"free-video":!a.flag}]),onClick:e=>(async a=>{if(!I())return n({title:"请先登录",icon:"none"}),void setTimeout((()=>{g({url:"/pages/login/login"})}),1500);if(o.setCurrentVideo(a),a.flag&&0!==a.price)try{const e=await B({videoId:a.id,account:L()});e.data?e.data?g({url:`/pages/video/play?id=${a.id}`}):x({title:"付费视频",content:`观看此视频需要支付${a.price}金币`,confirmText:"立即支付",cancelText:"取消",success:async e=>{e.confirm&&await H(a)}}):g({url:`/pages/video/play?id=${a.id}`})}catch(e){n({title:e.message||"查询失败",icon:"none"})}else g({url:`/pages/video/play?id=${a.id}`})})(a)},null,10,["src","onClick"]),p(z,{class:"video-info"},{default:f((()=>[a.flag&&a.price>0?(t(),l(r,{key:0,class:"video-price"},{default:f((()=>[y(_(a.hasPaid?"已付费":`付费视频 ${a.price}金币`),1)])),_:2},1024)):(t(),l(r,{key:1,class:"video-free"},{default:f((()=>[y("免费视频")])),_:1}))])),_:2},1024)])),_:2},1024)))),128))])),_:1})):v("",!0),p(z,{class:"publish-btn",onClick:e[0]||(e[0]=a=>{g({url:"/pages/video/oss"})})},{default:f((()=>[p($,{type:"plus",size:"20",color:"#fff"})])),_:1})],64)}}},[["__scopeId","data-v-8d7f354d"]]);export{D as default};
