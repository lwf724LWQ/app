import{r as e,C as a,R as l,s as t,p as u,c as s,b as n,l as c,u as o,o as r,e as v,f as d,H as i,g as f,y as g,z as _,x as m,F as y,n as k,q as p,j as h,k as w,t as T,I as D,v as b,ao as C}from"./index-D0AdlXYI.js";import{g as S,f as x,L as $}from"./apis.BsLnrVmb.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";const Y=M({__name:"orders",setup(M){const Y=e(""),F=e(!1),E=e([]),N=e(!1),I=e(1),j=e(20),H=e(!0),O=e(0),R=e([]),V=e(!1),A=e("month"),X=e(2025),q=e(9),z=e(null),B=e(null),L=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],U=e(2023),G=e(10),J=e(0),K=e(0),P=e(0),Q=e(0),W=e(!0),Z=a((()=>{let e=E.value;return e=z.value&&B.value?e.filter((e=>{const a=e.updateTime||e.createTime;if(!a)return!1;const l=new Date(a),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()),u=new Date(z.value.getFullYear(),z.value.getMonth(),z.value.getDate()),s=new Date(B.value.getFullYear(),B.value.getMonth(),B.value.getDate());return t.getTime()>=u.getTime()&&t.getTime()<=s.getTime()})):e.filter((e=>{const a=e.updateTime||e.createTime;if(!a)return!1;const l=new Date(a);return l.getFullYear()===X.value&&l.getMonth()+1===q.value})),Y.value.trim()&&(e=e.filter((e=>e.orderNo.includes(Y.value)||e.info&&e.info.includes(Y.value)))),e})),ee=a((()=>{const e=X.value,a=q.value,l=new Date(e,a-1,1),t=new Date(e,a,0),u=l.getDay(),s=t.getDate(),n=[];for(let c=0;c<u;c++)n.push({date:"",isEmpty:!0});for(let c=1;c<=s;c++){const l=new Date(e,a-1,c),t=new Date,u=l.getFullYear()===t.getFullYear()&&l.getMonth()===t.getMonth()&&l.getDate()===t.getDate(),s=z.value&&l.getTime()===z.value.getTime(),o=B.value&&l.getTime()===B.value.getTime(),r=z.value&&B.value&&l.getTime()>=z.value.getTime()&&l.getTime()<=B.value.getTime();n.push({date:c,fullDate:l,isStart:s,isEnd:o,isInRange:r,isToday:u,isEmpty:!1})}return n})),ae=a((()=>{const e=(new Date).getFullYear(),a=[];for(let l=e-5;l<=e+2;l++)a.push(l);return a})),le=a((()=>[1,2,3,4,5,6,7,8,9,10,11,12])),te=a((()=>{if("range"===A.value&&z.value&&B.value){const e=re(z.value),a=re(B.value);return e===a?e:`${e} - ${a}`}return"range"===A.value&&z.value?re(z.value):`${X.value}å¹´${q.value}æœˆ`}));a((()=>"range"===A.value&&(z.value||B.value)));const ue=()=>{p()},se=()=>{V.value=!0,U.value=X.value,G.value=q.value,"range"===A.value&&(z.value||(z.value=new Date(2025,8,3)),B.value||(B.value=new Date(2025,9,2)))},ne=()=>{V.value=!1},ce=e=>{A.value=e},oe=e=>e.isEmpty?"empty":e.isStart?"start-date":e.isEnd?"end-date":e.isInRange?"in-range":"normal",re=e=>e?`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥`:"",ve=e=>{if(!e)return"";return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`},de=async()=>{"month"===A.value?(X.value=U.value,q.value=G.value,z.value=null,B.value=null):"range"===A.value&&(z.value&&!B.value&&(B.value=new Date(z.value)),z.value&&(X.value=z.value.getFullYear(),q.value=z.value.getMonth()+1)),ne(),I.value=1,await ke(!0)},ie=()=>{1===q.value?(q.value=12,X.value-=1):q.value-=1},fe=()=>{12===q.value?(q.value=1,X.value+=1):q.value+=1},ge=()=>{A.value="month",U.value=X.value,G.value=q.value},_e=e=>{if(!W.value)return;const a=e.touches[0];P.value=a.clientY,Q.value=a.clientX},me=e=>{},ye=e=>{if(!W.value)return;const a=e.changedTouches[0],l=a.clientY-P.value,t=a.clientX-Q.value;Math.abs(l)>Math.abs(t)&&Math.abs(l)>50&&(l>0?ie():fe())},ke=async(e=!1)=>{var a,l,s,n,c,o;try{N.value=!0;const r=S(),v=x();if(!r)return t({title:"è¯·å…ˆç™»å½•",icon:"none"}),void setTimeout((()=>{u({url:"/pages/login/login"})}),1500);if(!v){const u={account:r||"default_user",page:I.value.toString(),limit:j.value.toString()};Y.value.trim()&&(u.orderNo=Y.value.trim()),z.value&&B.value?(u.startDate=ve(z.value),u.endDate=ve(B.value)):(u.year=X.value.toString(),u.month=q.value.toString());const n=await $(u);if(200===n.code){const t=(null==(a=n.data)?void 0:a.records)||[];e?(E.value=t,I.value=1):1===I.value?E.value=t:E.value=[...E.value,...t];const u=(null==(l=n.data)?void 0:l.pages)||1;H.value=I.value<u,O.value=(null==(s=n.data)?void 0:s.total)||0}else t({title:n.msg||"èŽ·å–è®¢å•å¤±è´¥",icon:"none"});return void(N.value=!1)}const d={account:v,page:I.value.toString(),limit:j.value.toString()};Y.value.trim()&&(d.orderNo=Y.value.trim());const i=await $(d);if(200===i.code){const a=(null==(n=i.data)?void 0:n.records)||[];e?(E.value=a,I.value=1):1===I.value?E.value=a:E.value=[...E.value,...a];const l=(null==(c=i.data)?void 0:c.pages)||1;H.value=I.value<l,O.value=(null==(o=i.data)?void 0:o.total)||0}else t({title:i.msg||"èŽ·å–è®¢å•å¤±è´¥",icon:"none"})}catch(r){t({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•",icon:"none"})}finally{N.value=!1}},pe=e=>{if(!e)return"";const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},he=e=>({0:"å¾…æ”¯ä»˜",1:"å·²æ”¯ä»˜",2:"å·²å–æ¶ˆ",3:"å·²å®Œæˆ"}[e]||"æœªçŸ¥çŠ¶æ€"),we=()=>{F.value=!0},Te=()=>{setTimeout((()=>{Y.value.trim()||(F.value=!1)}),200)},De=()=>{console.log("æœç´¢å…³é”®è¯:",Y.value),Y.value.trim()||(I.value=1,ke(!0))},be=()=>{Y.value="",F.value=!1,I.value=1,ke(!0)},Ce=async()=>{Y.value.trim()?(Se(Y.value.trim()),console.log("æ‰§è¡Œè®¢å•æœç´¢:",Y.value.trim()),I.value=1,await ke(!0)):t({title:"è¯·è¾“å…¥è®¢å•å·",icon:"none"})},Se=e=>{if(!e||e.length<3)return;const a=R.value.indexOf(e);a>-1&&R.value.splice(a,1),R.value.unshift(e),R.value.length>5&&(R.value=R.value.slice(0,5)),w("orderSearchHistory",R.value)},xe=async()=>{H.value&&!N.value&&(I.value++,await ke(!1))};return l((async()=>{const e=S(),a=x();e?a?((()=>{try{const e=c("orderSearchHistory");e&&Array.isArray(e)&&(R.value=e)}catch(e){console.error("åŠ è½½æœç´¢åŽ†å²å¤±è´¥:",e)}})(),await ke()):(t({title:"ç”¨æˆ·ä¿¡æ¯å¼‚å¸¸ï¼Œè¯·é‡æ–°ç™»å½•",icon:"none"}),setTimeout((()=>{u({url:"/pages/login/login"})}),1500)):(t({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout((()=>{u({url:"/pages/login/login"})}),1500))})),(e,a)=>{const l=T,t=o,u=D,c=b,p=C;return r(),s(t,{class:"orders-container"},{default:n((()=>[v(t,{class:"navbar"},{default:n((()=>[v(t,{class:"nav-content"},{default:n((()=>[v(t,{class:"nav-left",onClick:ue},{default:n((()=>[v(l,{class:"back-arrow"},{default:n((()=>[d("Ã—")])),_:1})])),_:1}),v(l,{class:"nav-title"},{default:n((()=>[d("æˆ‘çš„è®¢å•")])),_:1}),v(t,{class:"nav-right"},{default:n((()=>[v(l,{class:"more-icon"},{default:n((()=>[d("â‹¯")])),_:1})])),_:1})])),_:1})])),_:1}),v(t,{class:"main-content"},{default:n((()=>[v(t,{class:"search-section"},{default:n((()=>[v(t,{class:"search-bar",onClick:we},{default:n((()=>[v(l,{class:"search-icon"},{default:n((()=>[d("ðŸ”")])),_:1}),F.value?(r(),s(u,{key:0,modelValue:Y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value=e),class:"search-input",placeholder:"è¾“å…¥è®¢å•å·æœç´¢",onBlur:Te,onInput:De,onConfirm:Ce,focus:F.value},null,8,["modelValue","focus"])):(r(),s(l,{key:1,class:"search-text"},{default:n((()=>[d("è¾“å…¥è®¢å•å·æœç´¢")])),_:1})),F.value&&Y.value?(r(),s(l,{key:2,class:"clear-icon",onClick:i(be,["stop"])},{default:n((()=>[d("Ã—")])),_:1})):f("",!0),F.value?(r(),s(c,{key:3,class:"search-btn",onClick:i(Ce,["stop"])},{default:n((()=>[d("æœç´¢")])),_:1})):f("",!0)])),_:1}),F.value&&R.value.length>0&&!Y.value?(r(),s(t,{key:0,class:"search-suggestions"},{default:n((()=>[v(t,{class:"suggestions-title"},{default:n((()=>[d("æœ€è¿‘æœç´¢")])),_:1}),(r(!0),g(y,null,_(R.value,((e,a)=>(r(),s(t,{class:"suggestion-item",key:a,onClick:a=>{return l=e,Y.value=l,void Ce();var l}},{default:n((()=>[v(l,{class:"suggestion-text"},{default:n((()=>[d(m(e),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):f("",!0),v(t,{class:"month-selector",onClick:se},{default:n((()=>[v(l,{class:"month-text"},{default:n((()=>[d(m(te.value),1)])),_:1}),v(l,{class:"dropdown-arrow"},{default:n((()=>[d("â–¼")])),_:1})])),_:1})])),_:1}),E.value.length>0?(r(),s(t,{key:0,class:"orders-stats"},{default:n((()=>[v(l,{class:"stats-text"},{default:n((()=>[Y.value.trim()?(r(),s(l,{key:0},{default:n((()=>[d('æœç´¢"'+m(Y.value)+'"ç»“æžœï¼š'+m(Z.value.length)+" ä¸ªè®¢å•",1)])),_:1})):z.value&&B.value?(r(),s(l,{key:1},{default:n((()=>[re(z.value)===re(B.value)?(r(),s(l,{key:0},{default:n((()=>[d(m(re(z.value))+"ï¼š"+m(Z.value.length)+" ä¸ªè®¢å• ",1)])),_:1})):(r(),s(l,{key:1},{default:n((()=>[d(" æ—¶é—´æ®µ "+m(re(z.value))+" è‡³ "+m(re(B.value))+"ï¼š"+m(Z.value.length)+" ä¸ªè®¢å• ",1)])),_:1}))])),_:1})):(r(),s(l,{key:2},{default:n((()=>[d(m(X.value)+"å¹´"+m(q.value)+"æœˆï¼š"+m(Z.value.length)+" ä¸ªè®¢å•",1)])),_:1}))])),_:1})])),_:1})):f("",!0),E.value.length>0?(r(),s(t,{key:1,class:"orders-list"},{default:n((()=>[(r(!0),g(y,null,_(Z.value,(e=>(r(),s(t,{class:"order-card",key:e.orderNo,onClick:a=>(e=>{h({title:"è®¢å•è¯¦æƒ…",content:`è®¢å•å·ï¼š${e.orderNo}\né‡‘é¢ï¼šÂ¥${e.amount}\nçŠ¶æ€ï¼š${he(e.status)}\næ—¶é—´ï¼š${pe(e.updateTime||e.createTime)}`,showCancel:!1})})(e)},{default:n((()=>[v(t,{class:"order-header"},{default:n((()=>{return[v(t,{class:"order-info"},{default:n((()=>[v(l,{class:"order-no"},{default:n((()=>[d("è®¢å•å·ï¼š"+m(e.orderNo),1)])),_:2},1024),v(l,{class:"order-time"},{default:n((()=>[d(m(pe(e.updateTime||e.createTime)),1)])),_:2},1024)])),_:2},1024),v(t,{class:k(["order-status",(a=e.status,{0:"status-pending",1:"status-paid",2:"status-cancelled",3:"status-completed"}[a]||"status-unknown")])},{default:n((()=>[d(m(he(e.status)),1)])),_:2},1032,["class"])];var a})),_:2},1024),v(t,{class:"order-content"},{default:n((()=>[v(t,{class:"order-desc"},{default:n((()=>[v(l,{class:"order-title"},{default:n((()=>[d(m(e.info||"è®¢å•è¯¦æƒ…"),1)])),_:2},1024),v(l,{class:"order-amount"},{default:n((()=>[d("Â¥"+m(e.amount),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):N.value?f("",!0):(r(),s(t,{key:2,class:"empty-state"},{default:n((()=>[v(l,{class:"empty-icon"},{default:n((()=>[d("ðŸ“‹")])),_:1}),Y.value.trim()?(r(),s(l,{key:0,class:"empty-text"},{default:n((()=>[d("æœªæ‰¾åˆ°ç›¸å…³è®¢å•")])),_:1})):z.value&&B.value?(r(),s(l,{key:1,class:"empty-text"},{default:n((()=>[re(z.value)===re(B.value)?(r(),s(l,{key:0},{default:n((()=>[d("è¯¥æ—¥æœŸæš‚æ— è®¢å•")])),_:1})):(r(),s(l,{key:1},{default:n((()=>[d("è¯¥æ—¶é—´æ®µæš‚æ— è®¢å•")])),_:1}))])),_:1})):(r(),s(l,{key:2,class:"empty-text"},{default:n((()=>[d("è¯¥æœˆä»½æš‚æ— è®¢å•")])),_:1})),Y.value.trim()?(r(),s(l,{key:3,class:"empty-desc"},{default:n((()=>[d("è¯·å°è¯•å…¶ä»–è®¢å•å·æˆ–æ¸…ç©ºæœç´¢")])),_:1})):z.value&&B.value?(r(),s(l,{key:4,class:"empty-desc"},{default:n((()=>[re(z.value)===re(B.value)?(r(),s(l,{key:0},{default:n((()=>[d("è¯·å°è¯•é€‰æ‹©å…¶ä»–æ—¥æœŸ")])),_:1})):(r(),s(l,{key:1},{default:n((()=>[d("è¯·å°è¯•é€‰æ‹©å…¶ä»–æ—¶é—´æ®µ")])),_:1}))])),_:1})):(r(),s(l,{key:5,class:"empty-desc"},{default:n((()=>[d("è¯·å°è¯•é€‰æ‹©å…¶ä»–æœˆä»½")])),_:1}))])),_:1})),E.value.length>0&&H.value?(r(),s(t,{key:3,class:"load-more-section"},{default:n((()=>[v(c,{class:"load-more-btn",onClick:xe,disabled:N.value},{default:n((()=>[d(m(N.value?"åŠ è½½ä¸­...":"åŠ è½½æ›´å¤š"),1)])),_:1},8,["disabled"])])),_:1})):f("",!0),N.value&&0===E.value.length?(r(),s(t,{key:4,class:"loading-state"},{default:n((()=>[v(l,{class:"loading-text"},{default:n((()=>[d("åŠ è½½ä¸­...")])),_:1})])),_:1})):f("",!0)])),_:1}),V.value?(r(),s(t,{key:0,class:"calendar-modal",onClick:ne},{default:n((()=>[v(t,{class:"calendar-content",onClick:a[3]||(a[3]=i((()=>{}),["stop"]))},{default:n((()=>[v(t,{class:"calendar-header"},{default:n((()=>[v(t,{class:"calendar-nav"},{default:n((()=>[v(l,{class:"close-btn",onClick:ne},{default:n((()=>[d("Ã—")])),_:1}),v(l,{class:"calendar-title"},{default:n((()=>[d("é€‰æ‹©æ—¥æœŸ")])),_:1}),v(t,{class:"nav-spacer"})])),_:1}),v(t,{class:"selection-tabs"},{default:n((()=>[v(t,{class:k(["tab-item",{active:"month"===A.value}]),onClick:a[1]||(a[1]=e=>ce("month"))},{default:n((()=>[v(l,{class:"tab-text"},{default:n((()=>[d("é€‰æ‹©æœˆä»½")])),_:1})])),_:1},8,["class"]),v(t,{class:k(["tab-item",{active:"range"===A.value}]),onClick:a[2]||(a[2]=e=>ce("range"))},{default:n((()=>[v(l,{class:"tab-text"},{default:n((()=>[d("é€‰æ‹©æ—¶é—´æ®µ")])),_:1})])),_:1},8,["class"])])),_:1}),"range"===A.value?(r(),s(t,{key:0,class:"current-selection"},{default:n((()=>[v(t,{class:"date-range-display"},{default:n((()=>[v(t,{class:"date-item"},{default:n((()=>[v(l,{class:"date-label"},{default:n((()=>[d("å¼€å§‹æ—¥æœŸ")])),_:1}),v(l,{class:"date-value"},{default:n((()=>[d(m(z.value?re(z.value):"è¯·é€‰æ‹©"),1)])),_:1})])),_:1}),v(l,{class:"date-separator"},{default:n((()=>[d("è‡³")])),_:1}),v(t,{class:"date-item"},{default:n((()=>[v(l,{class:"date-label"},{default:n((()=>[d("ç»“æŸæ—¥æœŸ")])),_:1}),v(l,{class:"date-value"},{default:n((()=>[d(m(B.value?re(B.value):"è¯·é€‰æ‹©"),1)])),_:1})])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1}),v(t,{class:"calendar-body"},{default:n((()=>["month"===A.value?(r(),s(t,{key:0,class:"month-picker"},{default:n((()=>[v(t,{class:"picker-container"},{default:n((()=>[v(t,{class:"year-picker"},{default:n((()=>[v(p,{class:"picker-scroll","scroll-y":"true","scroll-top":J.value},{default:n((()=>[(r(!0),g(y,null,_(ae.value,(e=>(r(),s(t,{class:k(["picker-item",{active:U.value===e}]),key:e,onClick:a=>(e=>{U.value=e;const a=ae.value.indexOf(e);J.value=60*a})(e)},{default:n((()=>[v(l,{class:"picker-text"},{default:n((()=>[d(m(e)+"å¹´",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["scroll-top"])])),_:1}),v(t,{class:"month-picker-list"},{default:n((()=>[v(p,{class:"picker-scroll","scroll-y":"true","scroll-top":K.value},{default:n((()=>[(r(!0),g(y,null,_(le.value,(e=>(r(),s(t,{class:k(["picker-item",{active:G.value===e}]),key:e,onClick:a=>(e=>{G.value=e;const a=le.value.indexOf(e);K.value=60*a})(e)},{default:n((()=>[v(l,{class:"picker-text"},{default:n((()=>[d(m(e)+"æœˆ",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["scroll-top"])])),_:1})])),_:1})])),_:1})):(r(),s(t,{key:1,class:"date-range-picker"},{default:n((()=>[v(t,{class:"month-navigation"},{default:n((()=>[v(t,{class:"nav-arrow",onClick:ie},{default:n((()=>[v(l,{class:"arrow-icon"},{default:n((()=>[d("â€¹")])),_:1})])),_:1}),v(t,{class:"month-year",onClick:ge},{default:n((()=>[v(l,{class:"month-year-text"},{default:n((()=>[d(m(X.value)+"å¹´ "+m(q.value)+"æœˆ",1)])),_:1}),v(l,{class:"month-dropdown"},{default:n((()=>[d("â–¼")])),_:1})])),_:1}),v(t,{class:"nav-arrow",onClick:fe},{default:n((()=>[v(l,{class:"arrow-icon"},{default:n((()=>[d("â€º")])),_:1})])),_:1})])),_:1}),v(t,{class:"calendar-grid",onTouchstart:_e,onTouchmove:me,onTouchend:ye},{default:n((()=>[v(t,{class:"weekdays"},{default:n((()=>[(r(),g(y,null,_(L,(e=>v(l,{class:"weekday",key:e},{default:n((()=>[d(m(e),1)])),_:2},1024))),64))])),_:1}),v(t,{class:"days-grid"},{default:n((()=>[(r(!0),g(y,null,_(ee.value,((e,a)=>(r(),s(t,{class:k(["day-item",oe(e)]),key:a,onClick:a=>(e=>{e.isEmpty||"range"===A.value&&(!z.value||z.value&&B.value?(z.value=e.fullDate,B.value=null):z.value&&!B.value&&(e.fullDate.getTime()>=z.value.getTime()?B.value=e.fullDate:(B.value=z.value,z.value=e.fullDate)))})(e)},{default:n((()=>[v(l,{class:"day-number"},{default:n((()=>[d(m(e.date),1)])),_:2},1024),e.isStart?(r(),s(l,{key:0,class:"day-label"},{default:n((()=>[d("å¼€å§‹")])),_:1})):f("",!0),e.isToday?(r(),s(l,{key:1,class:"day-label"},{default:n((()=>[d("ä»Šå¤©")])),_:1})):f("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}))])),_:1}),v(t,{class:"calendar-footer"},{default:n((()=>[v(t,{class:"btn cancel-btn",onClick:ne},{default:n((()=>[v(l,{class:"btn-text"},{default:n((()=>[d("å–æ¶ˆ")])),_:1})])),_:1}),v(t,{class:"btn confirm-btn",onClick:de},{default:n((()=>[v(l,{class:"btn-text"},{default:n((()=>[d("ç¡®å®š")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):f("",!0)])),_:1})}}},[["__scopeId","data-v-04949608"]]);export{Y as default};
