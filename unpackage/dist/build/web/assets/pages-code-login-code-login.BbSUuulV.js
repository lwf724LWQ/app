import{d as e,r as a,o as s,c as l,b as t,e as o,f as n,g as c,z as i,q as u,p as r,s as d,h as m,i as p,k as g,m as f,j as h,u as v,t as _,I as k,v as y}from"./index-BgH6xnyV.js";import{V as C}from"./VerificationCode.0k4L7yRt.js";import{o as b}from"./uni-app.es.wmAOsoD-.js";import{y as w,a as j,s as I,b as z}from"./apis.BPdXt_sA.js";import{_ as V}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=V(e({__name:"code-login",setup(e){const V=a(!1),x=()=>{u()},D=()=>{r({url:"/pages/reg/reg"})},P=()=>{r({url:"/pages/login/login"})};b((e=>{"forgetPwd"===e.type?V.value=!0:V.value=!1}));const q=a(""),A=a(""),G=a(null),M=e=>{A.value=e},R=async()=>{if(q.value)try{const e=await w({phone:q.value});200===e.code?(G.value.startCountdown(),d({title:"验证码已发送",icon:"success"})):d({title:e.errMsg||"发送失败",icon:"none"})}catch(e){d({title:"发送验证码失败",icon:"none"})}else d({title:"请输入手机号",icon:"none"})},T=async()=>{var e;if(q.value)if(A.value){m({title:"登录中..."});try{const s={type:"1",account:q.value,code:A.value},l=await j(s);if(p(),l){console.log("验证码登录API返回的完整数据:",l),(null==(e=l.data)?void 0:e.token)&&I(l.data.token),q.value&&z(q.value);try{const e=l.data||{};let a="http://video.caimizm.com/himg/user.png";e.himg&&(a=e.himg.startsWith("http")?e.himg:`http://video.caimizm.com/himg/${e.himg}`);const s={nickname:e.uname||"用户",avatar:a,phone:q.value};g("userInfo",s),g("loginData",{uname:e.uname,himg:e.himg,account:q.value}),console.log("验证码登录成功，用户信息已保存:",s),console.log("登录数据已保存:",{uname:e.uname,himg:e.himg,account:q.value})}catch(a){console.error("保存用户信息失败:",a);const e={nickname:"用户",avatar:"http://video.caimizm.com/himg/user.png",phone:q.value};g("userInfo",e),g("loginData",{uname:"用户",himg:"http://video.caimizm.com/himg/user.png",account:q.value})}d({title:"登录成功",icon:"success"}),setTimeout((()=>{f({url:"/pages/user/user"})}),1500)}else h({title:"登录失败",content:"验证码错误或已过期，请重试",showCancel:!1})}catch(a){p(),h({title:"登录失败",content:"网络错误，请检查网络连接后重试",showCancel:!1})}}else d({title:"请输入验证码",icon:"none"});else d({title:"请输入手机号",icon:"none"})};return(e,a)=>{const u=v,r=_,d=k,m=y;return s(),l(u,{class:"code-login-container"},{default:t((()=>[o(u,{class:"status-bar"}),o(u,{class:"header"},{default:t((()=>[o(u,{class:"back-btn",onClick:x},{default:t((()=>[o(u,{class:"back-icon"},{default:t((()=>[o(r,{class:"back-arrow"},{default:t((()=>[n("←")])),_:1}),o(u,{class:"logo-lines"},{default:t((()=>[o(u,{class:"line line-1"}),o(u,{class:"line line-2"})])),_:1})])),_:1})])),_:1})])),_:1}),o(u,{class:"title-section"},{default:t((()=>[V.value?c("",!0):(s(),l(r,{key:0,class:"main-title"},{default:t((()=>[n("验证码登录")])),_:1})),V.value?(s(),l(r,{key:1,class:"main-title"},{default:t((()=>[n("重置密码")])),_:1})):c("",!0)])),_:1}),o(u,{class:"code-login-form"},{default:t((()=>[o(u,{class:"input-group"},{default:t((()=>[o(u,{class:"input-container"},{default:t((()=>[o(u,{class:"input-icon phone-icon"},{default:t((()=>[o(u,{class:"phone-icon-svg"})])),_:1}),o(r,{class:"country-code"},{default:t((()=>[n("+86")])),_:1}),o(u,{class:"separator"}),o(d,{type:"text",placeholder:"请输入手机号","placeholder-class":"input-placeholder",modelValue:q.value,"onUpdate:modelValue":a[0]||(a[0]=e=>q.value=e),class:"phone-input"},null,8,["modelValue"])])),_:1})])),_:1}),o(u,{class:"input-group"},{default:t((()=>[o(u,{class:"input-container"},{default:t((()=>[o(u,{class:"input-icon code-icon"},{default:t((()=>[o(u,{class:"code-icon-svg"})])),_:1}),o(u,{class:"code-container"},{default:t((()=>[o(C,{ref_key:"codeRef",ref:G,placeholder:"请输入验证码",onGetCode:R,onInput:M},null,512)])),_:1})])),_:1})])),_:1}),V.value?c("",!0):(s(),l(u,{key:0,class:"links-section"},{default:t((()=>[o(r,{class:"user-login",onClick:P},{default:t((()=>[n("账号登录")])),_:1}),o(r,{class:"register-link",onClick:D},{default:t((()=>[n("注册")])),_:1})])),_:1})),o(u,{class:"login-btn-container"},{default:t((()=>[o(m,{class:"login-btn",onClick:T},{default:t((()=>[n(i(V.value?"重置密码":"登录"),1)])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-8f2ca410"]]);export{x as default};
