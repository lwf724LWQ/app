import{r as e,C as a,R as l,s as t,p as s,c as u,b as n,u as c,o,e as i,f as r,z as v,g as d,x as f,y as _,n as g,F as m,H as p,q as k,t as y,an as h}from"./index-BgH6xnyV.js";import{f as w}from"./uni-app.es.wmAOsoD-.js";import{J as D,f as T,g as x}from"./apis.BPdXt_sA.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=b({__name:"transaction",setup(b){const C=e("all"),M=e("");e(!1);const F=e(!1),Y=e(!0),$=e(1),S=e(20),E=e(0),V=e(!1),j=e("all");e("all");const I=e(!1),L=e("month"),R=e(2025),H=e(9),O=e(null),X=e(null),q=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],z=e(2023),J=e(10),A=e(0),B=e(0),G=e(0),K=e(0),N=e(!0),P=e([]),Q=a((()=>{let e=P.value;if(e=O.value&&X.value?e.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()),s=new Date(O.value.getFullYear(),O.value.getMonth(),O.value.getDate()),u=new Date(X.value.getFullYear(),X.value.getMonth(),X.value.getDate());return t.getTime()>=s.getTime()&&t.getTime()<=u.getTime()})):e.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a);return l.getFullYear()===R.value&&l.getMonth()+1===H.value})),"all"!==C.value){const a={income:0,expense:1};e=e.filter((e=>e.type===a[C.value]))}if(M.value.trim()){const a=M.value.trim().toLowerCase();e=e.filter((e=>e.remark&&e.remark.toLowerCase().includes(a)||e.account&&e.account.toLowerCase().includes(a)))}return e})),U=a((()=>{const e=R.value,a=H.value,l=new Date(e,a-1,1),t=new Date(e,a,0),s=l.getDay(),u=t.getDate(),n=[];for(let c=0;c<s;c++)n.push({date:"",isEmpty:!0});for(let c=1;c<=u;c++){const l=new Date(e,a-1,c),t=new Date,s=l.getFullYear()===t.getFullYear()&&l.getMonth()===t.getMonth()&&l.getDate()===t.getDate(),u=O.value&&l.getTime()===O.value.getTime(),o=X.value&&l.getTime()===X.value.getTime(),i=O.value&&X.value&&l.getTime()>=O.value.getTime()&&l.getTime()<=X.value.getTime();n.push({date:c,fullDate:l,isStart:u,isEnd:o,isInRange:i,isToday:s,isEmpty:!1})}return n})),W=a((()=>{const e=(new Date).getFullYear(),a=[];for(let l=e-5;l<=e+2;l++)a.push(l);return a})),Z=a((()=>[1,2,3,4,5,6,7,8,9,10,11,12])),ee=a((()=>{if("range"===L.value&&O.value&&X.value){const e=_e(O.value),a=_e(X.value);return e===a?e:`${e} - ${a}`}return"range"===L.value&&O.value?_e(O.value):`${R.value}å¹´${H.value}æœˆ`})),ae=a((()=>"range"===L.value&&(O.value||X.value))),le=a((()=>{let e=[];e=O.value&&X.value?P.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()),s=new Date(O.value.getFullYear(),O.value.getMonth(),O.value.getDate()),u=new Date(X.value.getFullYear(),X.value.getMonth(),X.value.getDate());return t.getTime()>=s.getTime()&&t.getTime()<=u.getTime()&&1===e.type})):P.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a);return l.getFullYear()===R.value&&l.getMonth()+1===H.value&&1===e.type}));return e.reduce(((e,a)=>e+(a.amount||0)),0).toFixed(2)})),te=a((()=>{let e=[];e=O.value&&X.value?P.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a),t=new Date(l.getFullYear(),l.getMonth(),l.getDate()),s=new Date(O.value.getFullYear(),O.value.getMonth(),O.value.getDate()),u=new Date(X.value.getFullYear(),X.value.getMonth(),X.value.getDate());return t.getTime()>=s.getTime()&&t.getTime()<=u.getTime()&&0===e.type})):P.value.filter((e=>{const a=e.createTime;if(!a)return!1;const l=new Date(a);return l.getFullYear()===R.value&&l.getMonth()+1===H.value&&0===e.type}));return e.reduce(((e,a)=>e+(a.amount||0)),0).toFixed(2)})),se=()=>{k()},ue=()=>{V.value=!0},ne=()=>{console.log("è·³è½¬åˆ°ç»Ÿè®¡é¡µé¢")},ce=()=>{I.value=!0,z.value=R.value,J.value=H.value,"range"===L.value&&(O.value||(O.value=new Date(2025,8,3)),X.value||(X.value=new Date(2025,9,2)))},oe=()=>{V.value=!1},ie=e=>{j.value=e},re=()=>{C.value=j.value,oe(),$.value=1,be(!0)},ve=()=>{I.value=!1},de=e=>{L.value=e},fe=e=>e.isEmpty?"empty":e.isStart?"start-date":e.isEnd?"end-date":e.isInRange?"in-range":"normal",_e=e=>e?`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥`:"",ge=async()=>{"month"===L.value?(R.value=z.value,H.value=J.value,O.value=null,X.value=null):"range"===L.value&&(O.value&&!X.value&&(X.value=new Date(O.value)),O.value&&(R.value=O.value.getFullYear(),H.value=O.value.getMonth()+1)),ve(),$.value=1,await be(!0)},me=()=>{1===H.value?(H.value=12,R.value-=1):H.value-=1},pe=()=>{12===H.value?(H.value=1,R.value+=1):H.value+=1},ke=()=>{L.value="month",z.value=R.value,J.value=H.value},ye=e=>{if(!N.value)return;const a=e.touches[0];G.value=a.clientY,K.value=a.clientX},he=e=>{},we=e=>{if(!N.value)return;const a=e.changedTouches[0],l=a.clientY-G.value,t=a.clientX-K.value;Math.abs(l)>Math.abs(t)&&Math.abs(l)>50&&(l>0?me():pe())},De=e=>{if(!e)return"";const a=new Date(e);return`${a.getMonth()+1}-${a.getDate()} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},Te=e=>0===e?"recharge":"consume",xe=()=>{const e=T(),a=x();return e&&""!==e.trim()?e.includes(".")?e.length<50?{isValid:!1,reason:"token_too_short"}:{isValid:!0,token:e,account:a}:{isValid:!1,reason:"token_format_invalid"}:{isValid:!1,reason:"token_missing"}},be=async(e=!1)=>{var a,l,u;try{F.value=!0;const n=xe();if(!n.isValid){let e="è¯·å…ˆç™»å½•";return"token_format_invalid"===n.reason?e="ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡æ–°ç™»å½•":"token_too_short"===n.reason&&(e="ç™»å½•ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¯·é‡æ–°ç™»å½•"),t({title:e,icon:"none"}),void setTimeout((()=>{s({url:"/pages/login/login"})}),1500)}const{token:c,account:o}=n,i={account:o||c,page:$.value.toString(),limit:S.value.toString()},r=await D(i);if(200===r.code){const s=(null==(a=r.data)?void 0:a.records)||[];e?(P.value=s,$.value=1):1===$.value?P.value=s:P.value=[...P.value,...s];const n=(null==(l=r.data)?void 0:l.pages)||1;Y.value=$.value<n,E.value=(null==(u=r.data)?void 0:u.total)||0,0===s.length&&1===$.value&&t({title:"æš‚æ— è´¦å•æ•°æ®",icon:"none",duration:2e3})}else t({title:r.msg||"èŽ·å–è´¦å•å¤±è´¥",icon:"none"})}catch(n){t({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•",icon:"none"})}finally{F.value=!1}},Ce=()=>{!F.value&&Y.value&&($.value++,be(!1))},Me=()=>xe().isValid;return l((async()=>{Me()?await be(!0):(t({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout((()=>{s({url:"/pages/login/login"})}),1500))})),w((async()=>{Me()?0!==P.value.length||F.value||await be(!0):(t({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout((()=>{s({url:"/pages/login/login"})}),1500))})),(e,a)=>{const l=y,t=c,s=h;return o(),u(t,{class:"transaction-container"},{default:n((()=>[i(t,{class:"navbar"},{default:n((()=>[i(t,{class:"nav-content"},{default:n((()=>[i(t,{class:"nav-left",onClick:se},{default:n((()=>[i(l,{class:"back-arrow"},{default:n((()=>[r("Ã—")])),_:1})])),_:1}),i(l,{class:"nav-title"},{default:n((()=>[r("è´¦å•")])),_:1}),i(t,{class:"nav-right"},{default:n((()=>[i(l,{class:"more-icon"},{default:n((()=>[r("â‹¯")])),_:1})])),_:1})])),_:1})])),_:1}),i(t,{class:"main-content"},{default:n((()=>[i(t,{class:"filter-section"},{default:n((()=>[i(t,{class:"filter-bar"},{default:n((()=>[i(t,{class:"filter-dropdown",onClick:ue},{default:n((()=>[i(l,{class:"filter-text"},{default:n((()=>[r("å…¨éƒ¨è´¦å•")])),_:1}),i(l,{class:"dropdown-arrow"},{default:n((()=>[r("â–¼")])),_:1})])),_:1}),i(t,{class:"statistics-link",onClick:ne},{default:n((()=>[i(l,{class:"statistics-text"},{default:n((()=>[r("æ”¶æ”¯ç»Ÿè®¡")])),_:1}),i(l,{class:"chevron"},{default:n((()=>[r(">")])),_:1})])),_:1})])),_:1}),i(t,{class:"monthly-summary"},{default:n((()=>[i(t,{class:"month-selector",onClick:ce},{default:n((()=>[i(l,{class:"month-text"},{default:n((()=>[r(v(ee.value),1)])),_:1}),i(l,{class:"dropdown-arrow"},{default:n((()=>[r("â–¼")])),_:1})])),_:1}),ae.value?O.value&&X.value&&_e(O.value)===_e(X.value)?(o(),u(t,{key:1,class:"summary-amounts"},{default:n((()=>[i(l,{class:"expense-amount"},{default:n((()=>[r("æ”¯å‡ºÂ¥"+v(le.value),1)])),_:1}),i(l,{class:"income-amount"},{default:n((()=>[r("æ”¶å…¥Â¥"+v(te.value),1)])),_:1})])),_:1})):d("",!0):(o(),u(t,{key:0,class:"summary-amounts"},{default:n((()=>[i(l,{class:"expense-amount"},{default:n((()=>[r("æ”¯å‡ºÂ¥"+v(le.value),1)])),_:1}),i(l,{class:"income-amount"},{default:n((()=>[r("æ”¶å…¥Â¥"+v(te.value),1)])),_:1})])),_:1}))])),_:1})])),_:1}),i(t,{class:"transaction-list"},{default:n((()=>[(o(!0),f(m,null,_(Q.value,((e,a)=>(o(),u(t,{class:"transaction-item",key:e.id||a},{default:n((()=>[i(t,{class:"transaction-icon"},{default:n((()=>[i(t,{class:g(["icon-wrapper",Te(e.type)])},{default:n((()=>[i(l,{class:"icon-text"},{default:n((()=>{return[r(v((a=e.type,0===a?"ðŸ’°":"ðŸ’¸")),1)];var a})),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),i(t,{class:"transaction-content"},{default:n((()=>[i(l,{class:"transaction-title"},{default:n((()=>[r(v(e.remark||"è´¦å•è®°å½•"),1)])),_:2},1024),i(l,{class:"transaction-desc"},{default:n((()=>[r(v(e.account||"è´¦å•è¯¦æƒ…"),1)])),_:2},1024),i(l,{class:"transaction-time"},{default:n((()=>[r(v(De(e.createTime)),1)])),_:2},1024)])),_:2},1024),i(t,{class:g(["transaction-amount",Te(e.type)])},{default:n((()=>[i(l,{class:"amount-text"},{default:n((()=>[r(v(0===e.type?"+":"-")+v(e.amount||0),1)])),_:2},1024),i(l,{class:"amount-unit"},{default:n((()=>[r("é‡‘å¸")])),_:1})])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:1}),Q.value.length>0?(o(),u(t,{key:0,class:"load-more"},{default:n((()=>[F.value?(o(),u(l,{key:0,class:"load-more-text"},{default:n((()=>[r("åŠ è½½ä¸­...")])),_:1})):Y.value?(o(),u(l,{key:2,class:"load-more-text",onClick:Ce},{default:n((()=>[r("ç‚¹å‡»åŠ è½½æ›´å¤š")])),_:1})):(o(),u(l,{key:1,class:"load-more-text"},{default:n((()=>[r("å·²æ˜¾ç¤ºå…¨éƒ¨è®°å½•")])),_:1}))])),_:1})):d("",!0),F.value&&0===P.value.length?(o(),u(t,{key:1,class:"loading-state"},{default:n((()=>[i(l,{class:"loading-text"},{default:n((()=>[r("åŠ è½½ä¸­...")])),_:1})])),_:1})):d("",!0)])),_:1}),V.value?(o(),u(t,{key:0,class:"filter-modal",onClick:oe},{default:n((()=>[i(t,{class:"filter-content",onClick:a[3]||(a[3]=p((()=>{}),["stop"]))},{default:n((()=>[i(t,{class:"filter-header"},{default:n((()=>[i(l,{class:"filter-title"},{default:n((()=>[r("é€‰æ‹©ç­›é€‰é¡¹")])),_:1})])),_:1}),i(t,{class:"filter-body"},{default:n((()=>[i(t,{class:"filter-group"},{default:n((()=>[i(l,{class:"filter-group-title"},{default:n((()=>[r("æ”¶æ”¯ç±»åž‹")])),_:1}),i(t,{class:"filter-options"},{default:n((()=>[i(t,{class:g(["filter-option",{active:"all"===j.value}]),onClick:a[0]||(a[0]=e=>ie("all"))},{default:n((()=>[i(l,{class:"option-text"},{default:n((()=>[r("å…¨éƒ¨")])),_:1})])),_:1},8,["class"]),i(t,{class:g(["filter-option",{active:"expense"===j.value}]),onClick:a[1]||(a[1]=e=>ie("expense"))},{default:n((()=>[i(l,{class:"option-text"},{default:n((()=>[r("æ”¯å‡º")])),_:1})])),_:1},8,["class"]),i(t,{class:g(["filter-option",{active:"income"===j.value}]),onClick:a[2]||(a[2]=e=>ie("income"))},{default:n((()=>[i(l,{class:"option-text"},{default:n((()=>[r("æ”¶å…¥")])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),i(t,{class:"filter-group"})])),_:1}),i(t,{class:"filter-footer"},{default:n((()=>[i(t,{class:"btn cancel-btn",onClick:oe},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("å–æ¶ˆ")])),_:1})])),_:1}),i(t,{class:"btn confirm-btn",onClick:re},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("ç¡®å®š")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0),I.value?(o(),u(t,{key:1,class:"calendar-modal",onClick:ve},{default:n((()=>[i(t,{class:"calendar-content",onClick:a[6]||(a[6]=p((()=>{}),["stop"]))},{default:n((()=>[i(t,{class:"calendar-header"},{default:n((()=>[i(t,{class:"calendar-nav"},{default:n((()=>[i(l,{class:"close-btn",onClick:ve},{default:n((()=>[r("Ã—")])),_:1}),i(l,{class:"calendar-title"},{default:n((()=>[r("é€‰æ‹©æ—¥æœŸ")])),_:1}),i(t,{class:"nav-spacer"})])),_:1}),i(t,{class:"selection-tabs"},{default:n((()=>[i(t,{class:g(["tab-item",{active:"month"===L.value}]),onClick:a[4]||(a[4]=e=>de("month"))},{default:n((()=>[i(l,{class:"tab-text"},{default:n((()=>[r("é€‰æ‹©æœˆä»½")])),_:1})])),_:1},8,["class"]),i(t,{class:g(["tab-item",{active:"range"===L.value}]),onClick:a[5]||(a[5]=e=>de("range"))},{default:n((()=>[i(l,{class:"tab-text"},{default:n((()=>[r("é€‰æ‹©æ—¶é—´æ®µ")])),_:1})])),_:1},8,["class"])])),_:1}),"range"===L.value?(o(),u(t,{key:0,class:"current-selection"},{default:n((()=>[i(t,{class:"date-range-display"},{default:n((()=>[i(t,{class:"date-item"},{default:n((()=>[i(l,{class:"date-label"},{default:n((()=>[r("å¼€å§‹æ—¥æœŸ")])),_:1}),i(l,{class:"date-value"},{default:n((()=>[r(v(O.value?_e(O.value):"è¯·é€‰æ‹©"),1)])),_:1})])),_:1}),i(l,{class:"date-separator"},{default:n((()=>[r("è‡³")])),_:1}),i(t,{class:"date-item"},{default:n((()=>[i(l,{class:"date-label"},{default:n((()=>[r("ç»“æŸæ—¥æœŸ")])),_:1}),i(l,{class:"date-value"},{default:n((()=>[r(v(X.value?_e(X.value):"è¯·é€‰æ‹©"),1)])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)])),_:1}),i(t,{class:"calendar-body"},{default:n((()=>["month"===L.value?(o(),u(t,{key:0,class:"month-picker"},{default:n((()=>[i(t,{class:"picker-container"},{default:n((()=>[i(t,{class:"year-picker"},{default:n((()=>[i(s,{class:"picker-scroll","scroll-y":"true","scroll-top":A.value},{default:n((()=>[(o(!0),f(m,null,_(W.value,(e=>(o(),u(t,{class:g(["picker-item",{active:z.value===e}]),key:e,onClick:a=>(e=>{z.value=e;const a=W.value.indexOf(e);A.value=60*a})(e)},{default:n((()=>[i(l,{class:"picker-text"},{default:n((()=>[r(v(e)+"å¹´",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["scroll-top"])])),_:1}),i(t,{class:"month-picker-list"},{default:n((()=>[i(s,{class:"picker-scroll","scroll-y":"true","scroll-top":B.value},{default:n((()=>[(o(!0),f(m,null,_(Z.value,(e=>(o(),u(t,{class:g(["picker-item",{active:J.value===e}]),key:e,onClick:a=>(e=>{J.value=e;const a=Z.value.indexOf(e);B.value=60*a})(e)},{default:n((()=>[i(l,{class:"picker-text"},{default:n((()=>[r(v(e)+"æœˆ",1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["scroll-top"])])),_:1})])),_:1})])),_:1})):(o(),u(t,{key:1,class:"date-range-picker"},{default:n((()=>[i(t,{class:"month-navigation"},{default:n((()=>[i(t,{class:"nav-arrow",onClick:me},{default:n((()=>[i(l,{class:"arrow-icon"},{default:n((()=>[r("â€¹")])),_:1})])),_:1}),i(t,{class:"month-year",onClick:ke},{default:n((()=>[i(l,{class:"month-year-text"},{default:n((()=>[r(v(R.value)+"å¹´ "+v(H.value)+"æœˆ",1)])),_:1}),i(l,{class:"month-dropdown"},{default:n((()=>[r("â–¼")])),_:1})])),_:1}),i(t,{class:"nav-arrow",onClick:pe},{default:n((()=>[i(l,{class:"arrow-icon"},{default:n((()=>[r("â€º")])),_:1})])),_:1})])),_:1}),i(t,{class:"calendar-grid",onTouchstart:ye,onTouchmove:he,onTouchend:we},{default:n((()=>[i(t,{class:"weekdays"},{default:n((()=>[(o(),f(m,null,_(q,(e=>i(l,{class:"weekday",key:e},{default:n((()=>[r(v(e),1)])),_:2},1024))),64))])),_:1}),i(t,{class:"days-grid"},{default:n((()=>[(o(!0),f(m,null,_(U.value,((e,a)=>(o(),u(t,{class:g(["day-item",fe(e)]),key:a,onClick:a=>(e=>{e.isEmpty||"range"===L.value&&(!O.value||O.value&&X.value?(O.value=e.fullDate,X.value=null):O.value&&!X.value&&(e.fullDate.getTime()>=O.value.getTime()?X.value=e.fullDate:(X.value=O.value,O.value=e.fullDate)))})(e)},{default:n((()=>[i(l,{class:"day-number"},{default:n((()=>[r(v(e.date),1)])),_:2},1024),e.isStart?(o(),u(l,{key:0,class:"day-label"},{default:n((()=>[r("å¼€å§‹")])),_:1})):d("",!0),e.isToday?(o(),u(l,{key:1,class:"day-label"},{default:n((()=>[r("ä»Šå¤©")])),_:1})):d("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})])),_:1}))])),_:1}),i(t,{class:"calendar-footer"},{default:n((()=>[i(t,{class:"btn cancel-btn",onClick:ve},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("å–æ¶ˆ")])),_:1})])),_:1}),i(t,{class:"btn confirm-btn",onClick:ge},{default:n((()=>[i(l,{class:"btn-text"},{default:n((()=>[r("ç¡®å®š")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)])),_:1})}}},[["__scopeId","data-v-c26084a3"]]);export{C as default};
