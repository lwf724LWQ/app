"use strict";const e=require("../../../common/vendor.js"),n=require("../../../common/assets.js"),o=require("./useFunc/useDrawing.js"),t=require("./useFunc/useTableData.js"),s=require("./useFunc/useTextLabels.js"),r=require("./useFunc/useFabActions.js"),a=require("./useFunc/useScreenshot.js"),l=require("../../../stores/twocounter.js"),u=require("../../../stores/counter.js");if(!Array){(e.resolveComponent("custom-juwang-nav-bar")+e.resolveComponent("select-color"))()}Math||((()=>"../../../components/custom-juwang-nav-bar/custom-juwang-nav-bar.js")+(()=>"../../../components/select-color/select-color.js")+c)();const c=()=>"../../../components/NumberSelector/NumberSelector2.js",i={__name:"drawLine",setup(c){const i=e=>{ee(e);const n=W.value.end;se(n)},d=e.ref(!1),g=e.ref(null),f=e.ref(null),m=u.useCounterStore();console.log(m),e.ref([]);const h=e.ref({}),v=(e,n)=>{g.value=e,f.value=n,d.value=!0},p=()=>{d.value=!1},b=e=>{console.log("确认选择:",e),console.log("格子位置:",g.value,f.value);const n=`${e.groupIndex}-${e.numIndex}`;h.value[n]={previewType:e.previewType,content:{selectedCondition:e.selectedCondition,selectedNumbers:e.selectedNumbers,selecteddoubNumber:e.selecteddoubNumber}},console.log(h.value),p(),x(e.groupIndex,e.numIndex)},x=(e,n)=>{const o=`${e}-${n}`,t=h.value[o];if(!t)return;const s=document.querySelector(`[data-group-index="${e}"][data-num-index="${n}"]`);if(!s)return;s.classList.remove("solid","hollow"),"solid"===t.previewType?s.classList.add("solid"):s.classList.add("hollow");const r=s.querySelector(".grid-content");if(console.log(t.content.selectedCondition),r){if(r.innerHTML="",t.content.selectedCondition){const e=document.createElement("div");e.textContent=t.content.selectedCondition,r.appendChild(e)}if(t.content.selectedNumbers&&t.content.selectedNumbers.length>0){const e=document.createElement("div");e.textContent=t.content.selectedNumbers.join(" "),r.appendChild(e)}if(t.content.selecteddoubNumber){const e=document.createElement("div");e.textContent=t.content.selecteddoubNumber,r.appendChild(e)}}};e.ref(!1),e.ref(!0),e.ref(null);const C=l.usetwoCounterStore(),w=e.ref(!0),T=n=>{e.index.showToast({title:`当前为${"none"===n?"滚动":"画规"}模式`,icon:"none",duration:2e3,position:"bottom"}),w.value=!w.value,z.value=n},L=n=>{console.log("子组件调用了父组件的提交方法，数据：",n),qe(),e.index.showModal({title:"确认清除",content:"确定要清除所有绘制内容和样式吗？此操作不可撤销。",success:e=>{e.confirm?(console.log("用户确认清除操作"),qe(),S()):e.cancel&&console.log("用户取消清除操作")}})},S=()=>{h.value={};document.querySelectorAll("[data-group-index][data-num-index]").forEach((e=>{e.classList.remove("solid","hollow");const n=e.querySelector(".grid-content");n&&(n.innerHTML="")}))},j=e=>{switch(console.log("收到子组件事件，参数",e),e.action){case"submit":Ee();break;case"undo":Fe()}},I=()=>{console.log("子组件调用了父组件的分享方法")};e.onLoad((n=>{const o=e.getCurrentInstance().proxy.getOpenerEventChannel();o.emit("acceptDataFromOpenedPage",{data:"data from test page"}),o.emit("someEvent",{data:"data from test page for someEvent"}),o.on("acceptDataFromOpenerPage",(function(e){console.log("acceptDataFromOpenerPage",e)}))}));const q=e.ref(null),{numberGroups:y,highlighted:E,numberRefs:D,getTargetRowIndex:F,isTargetRow:k,handleCellClick:N,isHighlighted:M,toggleHighlight:$,handleMessage:_}=t.useTableData(q,null,v),O=e=>{B.value=e},P=e=>{G.value=e},{currentMode:A,isDrawing:H,isErasing:R,canvasPointerEvents:z,strokeColor:B,lineWidth:G,canvasCtx:J,tempCanvasCtx:K,canvasSize:Q,dpr:V,currentShape:W,shapes:U,eraserSize:X,onCanvasStart:Y,onCanvasMove:Z,onCanvasEnd:ee,redraw:ne,initCanvas:oe,selectedColor:te,checkPointOnNumber:se}=o.useDrawing(y,E,D,v);e.nextTick$1();const{textLabels:re,movingLabel:ae,touchStartTime:le,touchStartPos:ue,touchEndTime:ce,touchCount:ie,touchTimer:de,labelOffset:ge,longPressDetected:fe,handleLabelTouchStart:me,handleLabelTouchMove:he,handleLabelTouchEnd:ve,handleLabelClick:pe,handleLabelDblClick:be,addTextLabel:xe,editLabel:Ce,updateLabelText:we,finishEditLabel:Te,getLabelStyle:Le}=s.useTextLabels(Q),{isFabOpen:Se,toggleFab:je,switchMode:Ie,clearCanvas:qe,clickBlank:ye}=r.useFabActions(A,z,U,re,E,ne),{saveCanvasImage:Ee,domToImage:De}=a.useScreenshot(e.html2canvas),Fe=()=>{if(console.log("执行撤销操作"),U.value.length>0){const n=U.value.pop();if(n.highlights&&Array.isArray(n.highlights)){const e=[...E.value];n.highlights.forEach((n=>{const o=e.findIndex((e=>e.groupIndex===n.groupIndex&&e.numIndex===n.numIndex));o>-1&&e.splice(o,1)})),E.value=e,console.log("撤销高亮样式，剩余高亮数量:",E.value.length)}ne(!1),updateHighlightDisplay(),console.log("撤销完成，剩余形状数量:",U.value.length),e.index.showToast({title:"已撤销上一步操作",icon:"success",duration:1500})}else console.log("没有可撤销的操作"),e.index.showToast({title:"没有可撤销的操作",icon:"none",duration:1500})};e.onMounted((async()=>{await C.getCounterInfo(),console.log("数字元素数量:",D.value.length),await oe(),console.log("初始化后数字元素数量:",D.value.length),setTimeout((()=>{ke()}),0)})),e.watch(U,(()=>ne(!1)),{deep:!0});const ke=()=>{const n=e.index.createSelectorQuery();n.select(".container").boundingClientRect(),n.selectViewport().scrollOffset(),n.exec((n=>{if(n[0]){const o=n[0].height;e.index.pageScrollTo({scrollTop:o,duration:0})}}))};return(o,t)=>e.e({a:e.o(j),b:e.o(I),c:e.p({title:"drawLine",onSubmit:L}),d:e.o(O),e:e.o(P),f:d.value},d.value?{g:e.sr("numberSelector","d5898c39-2"),h:e.o(p),i:e.o(b),j:e.p({groupIndex:g.value,numIndex:f.value}),k:e.o((()=>{})),l:e.o(p)}:{},{m:e.f(e.unref(C).List,((n,o,t)=>({a:e.t(n.qishu),b:e.f(n.numbers,((n,t,s)=>({a:e.t(n),b:e.unref(M)(o,t)?1:"",c:t,d:t,e:e.n("col-"+(2+t)+(e.unref(k)(o)?" clickable":"")),f:e.o((n=>e.unref(N)(o,t)),t)}))),c:o,d:n.qishu,e:n.qishu,f:o,g:e.unref(k)(o)?1:""}))),n:e.o(((...n)=>e.unref(Y)&&e.unref(Y)(...n))),o:e.o(((...n)=>e.unref(Z)&&e.unref(Z)(...n))),p:e.o(i),q:e.o(((...n)=>e.unref(Y)&&e.unref(Y)(...n))),r:e.o(((...n)=>e.unref(Z)&&e.unref(Z)(...n))),s:e.o(i),t:e.unref(z),v:e.f(e.unref(re),((n,o,t)=>({a:e.t(n.text),b:n.editing,c:e.o((n=>e.unref(Te)(o)),n.id),d:e.o((n=>e.unref(we)(o,n)),n.id),e:n.id,f:e.s(e.unref(Le)(n)),g:e.o((n=>e.unref(me)(o,n)),n.id),h:e.o((n=>e.unref(he)(o,n)),n.id),i:e.o((n=>e.unref(ve)(o,n)),n.id),j:e.o((n=>e.unref(pe)(o)),n.id),k:e.o((n=>e.unref(be)(o)),n.id),l:o}))),w:n._imports_0$1,x:e.o((e=>T("none"))),y:w.value,z:n._imports_1$1,A:e.o((e=>T("auto"))),B:!w.value,C:e.t(e.unref(Se)?"✕":"+"),D:e.o(((...n)=>e.unref(je)&&e.unref(je)(...n))),E:e.o((n=>e.unref(Ie)("freeDraw"))),F:e.o((n=>e.unref(Ie)("straightLine"))),G:e.o((n=>e.unref(Ie)("rectangle"))),H:e.o((n=>e.unref(Ie)("circle"))),I:e.o((n=>e.unref(Ie)("smart"))),J:e.o((n=>e.unref(Ie)("eraser"))),K:e.o(((...n)=>e.unref(xe)&&e.unref(xe)(...n))),L:e.o(((...n)=>e.unref(ye)&&e.unref(ye)(...n))),M:e.unref(Se)?1:""})}},d=e._export_sfc(i,[["__scopeId","data-v-d5898c39"]]);wx.createPage(d);
