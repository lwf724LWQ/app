"use strict";const e=require("../../../../common/vendor.js");exports.useTextLabels=function(t){const n=e.ref([]),l=e.ref(-1),o=e.ref(0),a=e.ref({x:0,y:0}),u=e.ref(0),i=e.ref(0),c=e.ref(null),r=e.ref({x:0,y:0}),s=e.ref(!1);function v(t){n.value.forEach(((e,n)=>{e.editing=n===t})),e.nextTick$1((()=>{const e=document.querySelectorAll(".text-label");if(e[t]){const n=e[t].querySelector(".text-content");if(n){n.setAttribute("contenteditable","true"),n.focus();const e=document.createRange();e.selectNodeContents(n),e.collapse(!1);const t=window.getSelection();t.removeAllRanges(),t.addRange(e),/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)&&(n.click(),setTimeout((()=>n.focus()),100))}}}))}return{textLabels:n,movingLabel:l,touchStartTime:o,touchStartPos:a,touchEndTime:u,touchCount:i,touchTimer:c,labelOffset:r,longPressDetected:s,handleLabelTouchStart:function(e,t){if(n.value[e].editing)return void t.stopPropagation();o.value=Date.now();const l=t.touches[0],u=document.querySelector(".numbers-table-container"),d=u?u.getBoundingClientRect():{left:0,top:0},f=d.top+window.scrollY,g=d.left+window.scrollX,h=n.value[e],p=h.x+g,x=h.y+f;a.value={x:l.pageX,y:l.pageY},r.value={x:l.pageX-p,y:l.pageY-x},i.value++,2===i.value?(c.value&&(clearTimeout(c.value),c.value=null),function(e){v(e)}(e),i.value=0):c.value=setTimeout((()=>{i.value=0}),300),setTimeout((()=>{1===i.value&&Date.now()-o.value>500&&!s.value&&(s.value=!0,function(e){v(e)}(e))}),500),t.stopPropagation(),t.preventDefault()},handleLabelTouchMove:function(e,o){if(s.value)return;const u=o.touches[0],i=Math.abs(u.clientX-a.value.x),c=Math.abs(u.clientY-a.value.y);if(i>5||c>5){l.value=e;const o=document.querySelector(".numbers-table-container"),a=o?o.getBoundingClientRect():{left:0,top:0},i=a.top+window.scrollY,c=a.left+window.scrollX;let s=u.pageX-r.value.x-c,v=u.pageY-r.value.y-i;const d=t.value.h;n.value[e].x=Math.max(0,Math.min(s,t.value.w-100)),n.value[e].y=Math.max(0,Math.min(v,d))}o.stopPropagation(),o.preventDefault()},handleLabelTouchEnd:function(e,t){u.value=Date.now(),l.value=-1,s.value=!1,t.stopPropagation(),t.preventDefault()},handleLabelClick:function(e){n.value[e].editing},handleLabelDblClick:function(e){v(e)},addTextLabel:function(){var t;const l=null==(t=document.querySelector(".draw-canvas"))?void 0:t.getBoundingClientRect();let o=100,a=100;if(l){const e=document.querySelector(".numbers-table");if(e){const t=e.querySelector(".col-1"),n=e.querySelector(".col-2");if(t&&n){o=t.getBoundingClientRect().width+n.getBoundingClientRect().width+20}}a=l.height/3}const u={id:Date.now(),x:o,y:a,text:"双击或长按编辑",editing:!1};n.value.push(u),e.nextTick$1((()=>{v(n.value.length-1)}))},editLabel:v,updateLabelText:function(e,t){n.value[e]&&(n.value[e].text=t.target.innerText)},finishEditLabel:function(e){n.value[e]&&(n.value[e].editing=!1,n.value[e].text.trim()||n.value.splice(e,1))},getLabelStyle:function(e){return{left:`${e.x}px`,top:`${e.y}px`,zIndex:25}}}};
