"use strict";const e=require("../../../../common/vendor.js");exports.useScreenshot=function(n){return{saveCanvasImage:async()=>{e.index.showLoading({title:"正在生成截图...",mask:!0});try{const t=document.querySelector(".numbers-table-container");if(!t)throw new Error("未找到表格容器");(await n(t,{scale:window.devicePixelRatio||1,useCORS:!0,logging:!1,backgroundColor:null,ignoreElements:e=>e.classList.contains("fab-wrapper")})).toBlob((async n=>{try{const t=URL.createObjectURL(n),o=`table-canvas-${(new Date).getTime()}.png`,i=document.createElement("a");i.href=t,i.download=o,i.style.display="none",document.body.appendChild(i),i.click(),setTimeout((()=>{document.body.removeChild(i),URL.revokeObjectURL(t)}),100),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"none"})}catch(t){console.error("创建下载链接失败:",t),e.index.hideLoading(),e.index.showToast({title:"保存失败",icon:"none"})}}),"image/png")}catch(t){console.error("截图失败:",t),e.index.hideLoading(),e.index.showToast({title:"截图失败，请重试",icon:"none"})}},domToImage:e=>new Promise(((n,t)=>{const o=document.createElement("canvas"),i=o.getContext("2d"),a=e.getBoundingClientRect();o.width=a.width,o.height=a.height;const r=new Image,s=`\n        <svg width="${a.width}" height="${a.height}" xmlns="http://www.w3.org/2000/svg">\n          <foreignObject width="100%" height="100%">\n            <div xmlns="http://www.w3.org/1999/xhtml">${(new XMLSerializer).serializeToString(e)}</div>\n          </foreignObject>\n        </svg>\n      `,c="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s)));r.crossOrigin="anonymous",r.onload=()=>{try{i.drawImage(r,0,0);const e=document.createElement("canvas"),t=e.getContext("2d");e.width=a.width,e.height=a.height,t.drawImage(o,0,0),n(e)}catch(e){t(e)}finally{URL.revokeObjectURL(c)}},r.onerror=e=>{t(new Error("无法加载图像: "+e.message))},r.src=c}))}};
