"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js");require("../../utils/system.js");const i=require("../../utils/request.js"),a=require("../../api/apis.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const t={__name:"user",setup(t){const r=e.reactive({profile:null}),l=e.ref(!1),n=e.ref(0),s=e.ref(!1),c=e.ref(!1),p=e=>{r.profile&&(r.profile.avatar="http://video.caimizm.com/himg/user.png")},u=async()=>{if(s.value)console.log("正在加载余额，跳过重复请求");else try{s.value=!0;const e=i.getAccount();if(!e)return void(n.value=0);const o=await a.apiGetUserBalance({account:e});200===o.code?n.value=o.data||0:n.value=0}catch(e){console.error("获取余额失败:",e),n.value=0}finally{s.value=!1}},v=async()=>{if(c.value)console.log("正在检查登录状态，跳过重复请求");else try{c.value=!0;if(i.getToken()){try{const o=e.index.getStorageSync("userInfo")||{},i=e.index.getStorageSync("loginData")||{};i.uname||i.account?r.profile={avatar:i.himg||o.avatar||"http://video.caimizm.com/himg/user.png",nickname:i.uname||o.nickname||"欢迎您"}:r.profile={avatar:o.avatar||"http://video.caimizm.com/himg/user.png",nickname:o.nickname||"欢迎您"}}catch(o){const i=e.index.getStorageSync("userInfo")||{};r.profile={avatar:i.avatar||"http://video.caimizm.com/himg/user.png",nickname:i.nickname||"欢迎您"}}u()}else r.profile=null,n.value=0}finally{c.value=!1}},f=()=>{e.index.showModal({title:"确认退出",content:"确定要退出登录吗？",success:o=>{o.confirm&&(i.removeToken(),v(),e.index.showToast({title:"已退出登录",icon:"success"}))}})};e.ref([{icon:"contact",title:"联系客服",subTitle:"",hasArrow:!0},{icon:"paperplane-filled",title:"软件分享",subTitle:"分享给朋友",hasArrow:!0},{icon:"email-filled",title:"建议反馈",subTitle:"",hasArrow:!0},{icon:"upload-filled",title:"版本",subTitle:"已是最新版V3.4.0.2",hasArrow:!0},{icon:"settings",title:"设置",subTitle:"",hasArrow:!0}]);const m=()=>{r.profile&&u(),e.index.navigateTo({url:"/pages/recharge/recharge"})},d=()=>{e.index.navigateTo({url:"/pages/transaction/transaction"})},g=()=>{e.index.navigateTo({url:"/pages/orders/orders"})},h=()=>{e.index.navigateTo({url:"/pages/login/login"})},y=()=>{r.profile?e.index.navigateTo({url:"/pages/user/edit-profile"}):e.index.showToast({title:"请先登录",icon:"none"})},x=e=>{e.stopPropagation(),l.value=!l.value,l.value&&r.profile&&u()};return e.onMounted((()=>{v(),e.index.$on("userProfileUpdated",(o=>{r.profile&&(r.profile.nickname=o.nickname,r.profile.avatar=o.avatar,e.index.showToast({title:"用户信息已更新",icon:"success"}))}))})),e.onShow((()=>{v()})),(i,a)=>{var t,s;return e.e({a:r.profile},r.profile?{b:(null==(t=r.profile)?void 0:t.avatar)||"http://video.caimizm.com/himg/user.png",c:e.o(p),d:e.t((null==(s=r.profile)?void 0:s.nickname)||"欢迎您"),e:e.o(y)}:{},{f:!r.profile},r.profile?{}:{g:o._imports_0$2,h:e.o(h)},{i:e.t(l.value?"0.00":"****"),j:e.p({type:l.value?"eye-filled":"eye-slash-filled",size:"16",color:"#999"}),k:e.o(x),l:e.o(x),m:l.value},l.value?{n:e.t(n.value)}:{},{o:e.p({type:l.value?"eye-filled":"eye-slash-filled",size:"16",color:"#999"}),p:e.o(x),q:e.o(m),r:e.o(g),s:e.o(d),t:e.p({type:"headphones",size:"24",color:"#222"}),v:e.p({type:"compose",size:"24",color:"#222"}),w:e.p({type:"settings",size:"24",color:"#222"}),x:e.o(f),y:e.p({type:"locked",size:"24",color:"#222"}),z:e.p({type:"gift",size:"24",color:"#222"}),A:e.p({type:"help",size:"24",color:"#222"}),B:e.p({type:"link",size:"24",color:"#222"})})}}},r=e._export_sfc(t,[["__scopeId","data-v-6210bc76"]]);wx.createPage(r);
