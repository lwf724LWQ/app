"use strict";const e=require("../../common/vendor.js"),a=require("../../common/assets.js"),o=require("../../api/apis.js"),i=require("../../utils/request.js"),t=require("../../stores/video.js");if(!Array){(e.resolveComponent("StatusBarPlaceholder")+e.resolveComponent("uni-icons"))()}Math||((()=>"../../components/StatusBarPlaceholder/StatusBarPlaceholder.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js"))();const s={__name:"video",setup(s){e.onPullDownRefresh((async()=>{console.log("下拉刷新触发"),await n(),e.index.stopPullDownRefresh()}));const n=async()=>{try{const e={page:1,limit:10},a=await o.apiGetVideo(e);console.log("API 返回数据:",a),a.data&&a.data.records&&Array.isArray(a.data.records)?(u.value=a.data.records.map((e=>({title:e.title,src:"http://video.caimizm.com/"+e.url,id:e.id,account:e.account,likeCount:e.likeCount,createTime:e.createTime,flag:e.price>0&&e.flag,price:e.price,updateTime:e.updateTime,imgurl:"http://video.caimizm.com/"+e.vimg}))),console.log("更新后的 videoList:",u.value)):console.warn("API 返回数据格式不符合预期:",a)}catch(a){console.error("获取视频失败:",a),e.index.showToast({title:"获取视频失败",icon:"none"})}},c=t.useVideoStore(),r=e.ref(["排列五","排列三","七星彩","福彩3D"]),l=e.ref(0),d=e.ref("plw");e.ref("plw"),e.ref("home"),e.ref(["8","6","8","5","7"]),e.ref(["2","0","4","9","3","8","8"]),e.ref("25214期"),e.ref("3225期"),e.ref("follow");const u=e.ref([]);e.ref([]);const p=e=>{const a=e.detail.value;switch(l.value=a,a){case 0:d.value="plw";break;case 1:d.value="pls";break;case 2:d.value="qxc";break;case 3:d.value="fc"}},v=async a=>{try{a.hasPaid=!0,e.index.showToast({title:"支付成功，开始播放",icon:"success"}),e.index.navigateTo({url:`/pages/video/play?id=${a.id}`})}catch(o){e.index.showToast({title:"支付失败",icon:"none"})}};return e.onMounted((async()=>{n()})),(t,s)=>e.e({a:a._imports_0$3,b:e.t(r.value[l.value]),c:e.p({type:"down",size:"16",color:"#333"}),d:e.o(p),e:l.value,f:r.value,g:"plw"===d.value||0},"plw"===d.value?{h:e.f(u.value,((a,t,s)=>e.e({a:e.t(a.title),b:a.imgurl,c:e.o((t=>(async a=>{if(!i.getToken())return e.index.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{e.index.navigateTo({url:"/pages/login/login"})}),1500);if(c.setCurrentVideo(a),a.flag&&0!==a.price)try{const t=await o.apiCheckVideoPayment({videoId:a.id,account:i.getAccount()});t.data?t.data?e.index.navigateTo({url:`/pages/video/play?id=${a.id}`}):e.index.showModal({title:"付费视频",content:`观看此视频需要支付${a.price}金币`,confirmText:"立即支付",cancelText:"取消",success:async e=>{e.confirm&&await v(a)}}):e.index.navigateTo({url:`/pages/video/play?id=${a.id}`})}catch(t){e.index.showToast({title:t.message||"查询失败",icon:"none"})}else e.index.navigateTo({url:`/pages/video/play?id=${a.id}`})})(a)),t),d:a.hasPaid?1:"",e:a.flag?"":1,f:a.flag&&a.price>0},a.flag&&a.price>0?{g:e.t(a.hasPaid?"已付费":`付费视频 ${a.price}金币`)}:{},{h:t})))}:{})}},n=e._export_sfc(s,[["__scopeId","data-v-bdff1f27"]]);wx.createPage(n);
