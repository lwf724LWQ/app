"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/request.js"),t=require("../../api/apis.js"),l={__name:"transaction",setup(l){const u=e.ref("all"),n=e.ref("");e.ref(!1);const v=e.ref(!1),o=e.ref(!0),r=e.ref(1),i=e.ref(20),s=e.ref(0),g=e.ref(!1),c=e.ref(!1),m=e.ref("all");e.ref("all");const d=e.ref(!1),f=e.ref("month"),h=e.ref(2025),T=e.ref(9),D=e.ref(null),p=e.ref(null),w=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],y=e.ref(2023),M=e.ref(10),x=e.ref(0),F=e.ref(0),Y=e.ref(0),_=e.ref(0),k=e.ref(!0),S=e.ref([]),b=e.computed((()=>{let e=S.value;if(e=D.value&&p.value?e.filter((e=>{const a=e.createTime;if(!a)return!1;const t=new Date(a),l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),u=new Date(D.value.getFullYear(),D.value.getMonth(),D.value.getDate()),n=new Date(p.value.getFullYear(),p.value.getMonth(),p.value.getDate());return l.getTime()>=u.getTime()&&l.getTime()<=n.getTime()})):e.filter((e=>{const a=e.createTime;if(!a)return!1;const t=new Date(a);return t.getFullYear()===h.value&&t.getMonth()+1===T.value})),"all"!==u.value){const a={income:0,expense:1};e=e.filter((e=>e.type===a[u.value]))}if(n.value.trim()){const a=n.value.trim().toLowerCase();e=e.filter((e=>e.remark&&e.remark.toLowerCase().includes(a)||e.account&&e.account.toLowerCase().includes(a)))}return e})),$=e.computed((()=>{const e=h.value,a=T.value,t=new Date(e,a-1,1),l=new Date(e,a,0),u=t.getDay(),n=l.getDate(),v=[];for(let o=0;o<u;o++)v.push({date:"",isEmpty:!0});for(let o=1;o<=n;o++){const t=new Date(e,a-1,o),l=new Date,u=t.getFullYear()===l.getFullYear()&&t.getMonth()===l.getMonth()&&t.getDate()===l.getDate(),n=D.value&&t.getTime()===D.value.getTime(),r=p.value&&t.getTime()===p.value.getTime(),i=D.value&&p.value&&t.getTime()>=D.value.getTime()&&t.getTime()<=p.value.getTime();v.push({date:o,fullDate:t,isStart:n,isEnd:r,isInRange:i,isToday:u,isEmpty:!1})}return v})),E=e.computed((()=>{const e=(new Date).getFullYear(),a=[];for(let t=e-5;t<=e+2;t++)a.push(t);return a})),V=e.computed((()=>[1,2,3,4,5,6,7,8,9,10,11,12])),q=e.computed((()=>{if("range"===f.value&&D.value&&p.value){const e=G(D.value),a=G(p.value);return e===a?e:`${e} - ${a}`}return"range"===f.value&&D.value?G(D.value):`${h.value}å¹´${T.value}æœˆ`})),j=e.computed((()=>"range"===f.value&&(D.value||p.value))),C=e.computed((()=>{let e=[];e=D.value&&p.value?S.value.filter((e=>{const a=e.createTime;if(!a)return!1;const t=new Date(a),l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),u=new Date(D.value.getFullYear(),D.value.getMonth(),D.value.getDate()),n=new Date(p.value.getFullYear(),p.value.getMonth(),p.value.getDate());return l.getTime()>=u.getTime()&&l.getTime()<=n.getTime()&&1===e.type})):S.value.filter((e=>{const a=e.createTime;if(!a)return!1;const t=new Date(a);return t.getFullYear()===h.value&&t.getMonth()+1===T.value&&1===e.type}));return e.reduce(((e,a)=>e+(a.amount||0)),0).toFixed(2)})),I=e.computed((()=>{let e=[];e=D.value&&p.value?S.value.filter((e=>{const a=e.createTime;if(!a)return!1;const t=new Date(a),l=new Date(t.getFullYear(),t.getMonth(),t.getDate()),u=new Date(D.value.getFullYear(),D.value.getMonth(),D.value.getDate()),n=new Date(p.value.getFullYear(),p.value.getMonth(),p.value.getDate());return l.getTime()>=u.getTime()&&l.getTime()<=n.getTime()&&0===e.type})):S.value.filter((e=>{const a=e.createTime;if(!a)return!1;const t=new Date(a);return t.getFullYear()===h.value&&t.getMonth()+1===T.value&&0===e.type}));return e.reduce(((e,a)=>e+(a.amount||0)),0).toFixed(2)})),L=()=>{e.index.navigateBack()},B=()=>{c.value=!0},O=()=>{console.log("è·³è½¬åˆ°ç»Ÿè®¡é¡µé¢")},R=()=>{d.value=!0,y.value=h.value,M.value=T.value,"range"===f.value&&(D.value||(D.value=new Date(2025,8,3)),p.value||(p.value=new Date(2025,9,2)))},X=()=>{c.value=!1},A=e=>{m.value=e},H=()=>{u.value=m.value,X(),r.value=1,ue(!0)},P=()=>{d.value=!1},Q=e=>{f.value=e},z=e=>e.isEmpty?"empty":e.isStart?"start-date":e.isEnd?"end-date":e.isInRange?"in-range":"normal",G=e=>e?`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥`:"",J=async()=>{"month"===f.value?(h.value=y.value,T.value=M.value,D.value=null,p.value=null):"range"===f.value&&(D.value&&!p.value&&(p.value=new Date(D.value)),D.value&&(h.value=D.value.getFullYear(),T.value=D.value.getMonth()+1)),P(),r.value=1,await ue(!0)},K=()=>{1===T.value?(T.value=12,h.value-=1):T.value-=1},N=()=>{12===T.value?(T.value=1,h.value+=1):T.value+=1},U=()=>{f.value="month",y.value=h.value,M.value=T.value},W=e=>{if(!k.value)return;const a=e.touches[0];Y.value=a.clientY,_.value=a.clientX},Z=e=>{},ee=e=>{if(!k.value)return;const a=e.changedTouches[0],t=a.clientY-Y.value,l=a.clientX-_.value;Math.abs(t)>Math.abs(l)&&Math.abs(t)>50&&(t>0?K():N())},ae=e=>{if(!e)return"";const a=new Date(e);return`${a.getMonth()+1}-${a.getDate()} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},te=e=>0===e?"recharge":"consume",le=()=>{const e=a.getToken(),t=a.getAccount();return e&&""!==e.trim()?e.includes(".")?e.length<50?{isValid:!1,reason:"token_too_short"}:{isValid:!0,token:e,account:t}:{isValid:!1,reason:"token_format_invalid"}:{isValid:!1,reason:"token_missing"}},ue=async(a=!1)=>{var l,u,n;if(g.value)console.log("æ­£åœ¨åŠ è½½è´¦å•æ•°æ®ï¼Œè·³è¿‡é‡å¤è¯·æ±‚");else try{g.value=!0,v.value=!0;const c=le();if(!c.isValid){let a="è¯·å…ˆç™»å½•";return"token_format_invalid"===c.reason?a="ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡æ–°ç™»å½•":"token_too_short"===c.reason&&(a="ç™»å½•ä¿¡æ¯ä¸å®Œæ•´ï¼Œè¯·é‡æ–°ç™»å½•"),e.index.showToast({title:a,icon:"none"}),void setTimeout((()=>{e.index.navigateTo({url:"/pages/login/login"})}),1500)}const{token:m,account:d}=c,f={account:d||m,page:r.value.toString(),limit:i.value.toString()},h=await t.apiBillQuery(f);if(200===h.code){const t=(null==(l=h.data)?void 0:l.records)||[];a?(S.value=t,r.value=1):1===r.value?S.value=t:S.value=[...S.value,...t];const v=(null==(u=h.data)?void 0:u.pages)||1;o.value=r.value<v,s.value=(null==(n=h.data)?void 0:n.total)||0,0===t.length&&1===r.value&&e.index.showToast({title:"æš‚æ— è´¦å•æ•°æ®",icon:"none",duration:2e3})}else e.index.showToast({title:h.msg||"èŽ·å–è´¦å•å¤±è´¥",icon:"none"})}catch(c){e.index.showToast({title:"ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•",icon:"none"})}finally{v.value=!1,g.value=!1}},ne=()=>{!v.value&&o.value&&(r.value++,ue(!1))},ve=()=>le().isValid;return e.onMounted((async()=>{ve()?await ue(!0):(e.index.showToast({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout((()=>{e.index.navigateTo({url:"/pages/login/login"})}),1500))})),e.onShow((async()=>{ve()?0!==S.value.length||v.value||await ue(!0):(e.index.showToast({title:"è¯·å…ˆç™»å½•",icon:"none"}),setTimeout((()=>{e.index.navigateTo({url:"/pages/login/login"})}),1500))})),(a,t)=>e.e({a:e.o(L),b:e.o(B),c:e.o(O),d:e.t(q.value),e:e.o(R),f:!j.value},j.value?D.value&&p.value&&G(D.value)===G(p.value)?{j:e.t(C.value),k:e.t(I.value)}:{}:{g:e.t(C.value),h:e.t(I.value)},{i:D.value&&p.value&&G(D.value)===G(p.value),l:e.f(b.value,((a,t,l)=>{return{a:e.t((u=a.type,0===u?"ðŸ’°":"ðŸ’¸")),b:e.n(te(a.type)),c:e.t(a.remark||"è´¦å•è®°å½•"),d:e.t(a.account||"è´¦å•è¯¦æƒ…"),e:e.t(ae(a.createTime)),f:e.t(0===a.type?"+":"-"),g:e.t(a.amount||0),h:e.n(te(a.type)),i:a.id||t};var u})),m:b.value.length>0},b.value.length>0?e.e({n:v.value},v.value?{}:o.value?{p:e.o(ne)}:{},{o:!o.value}):{},{q:v.value&&0===S.value.length},(v.value&&S.value.length,{}),{r:c.value},c.value?{s:"all"===m.value?1:"",t:e.o((e=>A("all"))),v:"expense"===m.value?1:"",w:e.o((e=>A("expense"))),x:"income"===m.value?1:"",y:e.o((e=>A("income"))),z:e.o(X),A:e.o(H),B:e.o((()=>{})),C:e.o(X)}:{},{D:d.value},d.value?e.e({E:e.o(P),F:"month"===f.value?1:"",G:e.o((e=>Q("month"))),H:"range"===f.value?1:"",I:e.o((e=>Q("range"))),J:"range"===f.value},"range"===f.value?{K:e.t(D.value?G(D.value):"è¯·é€‰æ‹©"),L:e.t(p.value?G(p.value):"è¯·é€‰æ‹©")}:{},{M:"month"===f.value},"month"===f.value?{N:e.f(E.value,((a,t,l)=>({a:e.t(a),b:a,c:y.value===a?1:"",d:e.o((e=>(e=>{y.value=e;const a=E.value.indexOf(e);x.value=60*a})(a)),a)}))),O:x.value,P:e.f(V.value,((a,t,l)=>({a:e.t(a),b:a,c:M.value===a?1:"",d:e.o((e=>(e=>{M.value=e;const a=V.value.indexOf(e);F.value=60*a})(a)),a)}))),Q:F.value}:{R:e.o(K),S:e.t(h.value),T:e.t(T.value),U:e.o(U),V:e.o(N),W:e.f(w,((a,t,l)=>({a:e.t(a),b:a}))),X:e.f($.value,((a,t,l)=>e.e({a:e.t(a.date),b:a.isStart},(a.isStart,{}),{c:a.isToday},(a.isToday,{}),{d:t,e:e.n(z(a)),f:e.o((e=>(e=>{e.isEmpty||"range"===f.value&&(!D.value||D.value&&p.value?(D.value=e.fullDate,p.value=null):D.value&&!p.value&&(e.fullDate.getTime()>=D.value.getTime()?p.value=e.fullDate:(p.value=D.value,D.value=e.fullDate)))})(a)),t)}))),Y:e.o(W),Z:e.o(Z),aa:e.o(ee)},{ab:e.o(P),ac:e.o(J),ad:e.o((()=>{})),ae:e.o(P)}):{})}},u=e._export_sfc(l,[["__scopeId","data-v-b0d0a0d3"]]);wx.createPage(u);
