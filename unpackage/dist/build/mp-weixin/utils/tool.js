"use strict";const o=require("./alioss.js"),t=require("../common/vendor.js"),r={oss:{async upload(r,e={}){try{let s=o.client;s||(s=await o.initOSS());const n=e.folder||"uploads",a=e.prefix||"";let i="";if(r&&r.name)i=r.name;else{if(!r||!r.path)throw new Error("文件对象格式不正确，缺少 name 或 path 属性");{const o=r.path.split("/");i=o[o.length-1]}}const l=i.lastIndexOf(".");if(-1===l)throw new Error("文件名不包含扩展名");const c=i.substring(l+1),p=`${n}/${a}${t.nanoid()}.${c}`;return console.log("上传文件信息:",{"原始文件名":i,"远程文件名":p}),await s.put(p,r,{progress:e.progress||function(o){console.log("上传进度:",Math.round(100*o)+"%")}})}catch(s){throw console.error("上传文件时发生错误:",s),s}}}};exports.tool=r;
