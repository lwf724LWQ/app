{"version":3,"file":"twocounter.js","sources":["stores/twocounter.js"],"sourcesContent":["// stores/twocounter.js\r\nimport { ref } from 'vue';\r\nimport { apiTicketQuery } from \"@/api/apis.js\"\r\nimport { defineStore } from 'pinia';\r\n\r\nexport const usetwoCounterStore = defineStore('twocounter', () => {\r\n    const List = ref([]);\r\n    const queryParams = ref({\r\n        page: 1,\r\n        limit: 20,\r\n        tname: '排列五'\r\n    });\r\n    const isLoading = ref(false);\r\n    const hasMore = ref(true);\r\n    const error = ref(null);\r\n\r\n    // 请求数据并转换成drawLine需要的数组形式\r\n    const getCounterInfo = async (isLoadMore = false) => {\r\n        if (isLoading.value) return;\r\n        \r\n        isLoading.value = true;\r\n        error.value = null;\r\n        \r\n        try {\r\n            const res = await apiTicketQuery(queryParams.value);\r\n            console.log(\"原始数据:\", res.data.records);\r\n            \r\n            // 转换数据\r\n            let convertedData = convertData(res.data.records);\r\n            \r\n            // 反转数据，使期数为升序排列（最新的在最后）\r\n            convertedData = convertedData.reverse();\r\n            \r\n            // 在末尾添加4行空数据\r\n            addEmptyRows(convertedData);\r\n            \r\n            if (isLoadMore) {\r\n                // 加载更多 - 追加数据\r\n                List.value = [...List.value, ...convertedData];\r\n            } else {\r\n                // 刷新 - 替换数据\r\n                List.value = convertedData;\r\n            }\r\n            \r\n            // 检查是否还有更多数据\r\n            hasMore.value = res.data.records.length >= queryParams.value.limit;\r\n            \r\n            \r\n            \r\n            console.log(\"转换后数据（包含4行空数据）:\", List.value);\r\n        } catch (err) {\r\n            error.value = err;\r\n            console.error(\"获取数据失败:\", err);\r\n        } finally {\r\n            isLoading.value = false;\r\n        }\r\n    }\r\n\r\n    // 转换方法\r\n    const convertData = (originalData) => {\r\n        return originalData.map(item => {\r\n            // 将issueno转换为数字作为qishu\r\n            const qishu = parseInt(item.issueno);\r\n            // 将number字符串分割为数字数组\r\n            const numbers = item.number.split(' ').map(Number);\r\n            // 计算前四个数字之和作为qishu2\r\n            const qishu2 = numbers.slice(0, 4).reduce((sum, num) => sum + num, 0);\r\n            const newNumbers = [qishu2, ...numbers];\r\n            return {\r\n                qishu: qishu,\r\n                numbers: newNumbers\r\n            };\r\n        });\r\n    }\r\n\r\n    // 在数据末尾添加4行空数据\r\n    const addEmptyRows = (data) => {\r\n        if (data.length === 0) return;\r\n        // 获取最后一个元素的期号\r\n        const lastQishu = data[data.length - 1].qishu;\r\n        // 添加4行空数据\r\n        for (let i = 1; i <= 4; i++) {\r\n            // 创建一个长度为6的数组，每个元素都是空字符串\r\n            const emptyNumbers = Array(6).fill(\"\");\r\n            data.push({\r\n                qishu: lastQishu + i,\r\n                numbers: emptyNumbers // 空字符串数组\r\n            });\r\n        }\r\n    }\r\n\r\n    // 加载更多数据\r\n    const loadMoreData = async () => {\r\n        if (!hasMore.value || isLoading.value) return;\r\n        await getCounterInfo(true);\r\n    }\r\n\r\n    // 重置状态\r\n    const reset = () => {\r\n        List.value = [];\r\n        queryParams.value.page = 1;\r\n        hasMore.value = true;\r\n        isLoading.value = false;\r\n        error.value = null;\r\n    }\r\n\r\n    // 以对象的形式返回\r\n    return {\r\n        List,\r\n        isLoading,\r\n        hasMore,\r\n        error,\r\n        getCounterInfo,\r\n        loadMoreData,\r\n        reset\r\n    }\r\n});"],"names":["defineStore","ref","apiTicketQuery","uni"],"mappings":";;;AAKY,MAAC,qBAAqBA,cAAAA,YAAY,cAAc,MAAM;AAC9D,QAAM,OAAOC,kBAAI,CAAA,CAAE;AACnB,QAAM,cAAcA,cAAAA,IAAI;AAAA,IACpB,MAAM;AAAA,IACN,OAAO;AAAA,IACP,OAAO;AAAA,EACf,CAAK;AACD,QAAM,YAAYA,kBAAI,KAAK;AAC3B,QAAM,UAAUA,kBAAI,IAAI;AACxB,QAAM,QAAQA,kBAAI,IAAI;AAGtB,QAAM,iBAAiB,OAAO,aAAa,UAAU;AACjD,QAAI,UAAU;AAAO;AAErB,cAAU,QAAQ;AAClB,UAAM,QAAQ;AAEd,QAAI;AACA,YAAM,MAAM,MAAMC,SAAAA,eAAe,YAAY,KAAK;AAClDC,0BAAY,MAAA,OAAA,8BAAA,SAAS,IAAI,KAAK,OAAO;AAGrC,UAAI,gBAAgB,YAAY,IAAI,KAAK,OAAO;AAGhD,sBAAgB,cAAc;AAG9B,mBAAa,aAAa;AAE1B,UAAI,YAAY;AAEZ,aAAK,QAAQ,CAAC,GAAG,KAAK,OAAO,GAAG,aAAa;AAAA,MAC7D,OAAmB;AAEH,aAAK,QAAQ;AAAA,MAChB;AAGD,cAAQ,QAAQ,IAAI,KAAK,QAAQ,UAAU,YAAY,MAAM;AAI7DA,oBAAA,MAAA,MAAA,OAAA,8BAAY,mBAAmB,KAAK,KAAK;AAAA,IAC5C,SAAQ,KAAK;AACV,YAAM,QAAQ;AACdA,oBAAA,MAAA,MAAA,SAAA,8BAAc,WAAW,GAAG;AAAA,IACxC,UAAkB;AACN,gBAAU,QAAQ;AAAA,IACrB;AAAA,EACJ;AAGD,QAAM,cAAc,CAAC,iBAAiB;AAClC,WAAO,aAAa,IAAI,UAAQ;AAE5B,YAAM,QAAQ,SAAS,KAAK,OAAO;AAEnC,YAAM,UAAU,KAAK,OAAO,MAAM,GAAG,EAAE,IAAI,MAAM;AAEjD,YAAM,SAAS,QAAQ,MAAM,GAAG,CAAC,EAAE,OAAO,CAAC,KAAK,QAAQ,MAAM,KAAK,CAAC;AACpE,YAAM,aAAa,CAAC,QAAQ,GAAG,OAAO;AACtC,aAAO;AAAA,QACH;AAAA,QACA,SAAS;AAAA,MACzB;AAAA,IACA,CAAS;AAAA,EACJ;AAGD,QAAM,eAAe,CAAC,SAAS;AAC3B,QAAI,KAAK,WAAW;AAAG;AAEvB,UAAM,YAAY,KAAK,KAAK,SAAS,CAAC,EAAE;AAExC,aAAS,IAAI,GAAG,KAAK,GAAG,KAAK;AAEzB,YAAM,eAAe,MAAM,CAAC,EAAE,KAAK,EAAE;AACrC,WAAK,KAAK;AAAA,QACN,OAAO,YAAY;AAAA,QACnB,SAAS;AAAA;AAAA,MACzB,CAAa;AAAA,IACJ;AAAA,EACJ;AAGD,QAAM,eAAe,YAAY;AAC7B,QAAI,CAAC,QAAQ,SAAS,UAAU;AAAO;AACvC,UAAM,eAAe,IAAI;AAAA,EAC5B;AAGD,QAAM,QAAQ,MAAM;AAChB,SAAK,QAAQ;AACb,gBAAY,MAAM,OAAO;AACzB,YAAQ,QAAQ;AAChB,cAAU,QAAQ;AAClB,UAAM,QAAQ;AAAA,EACjB;AAGD,SAAO;AAAA,IACH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACH;AACL,CAAC;;"}