{"version":3,"file":"payment.js","sources":["pages/video/payment.vue","D:/uniapp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdmlkZW8vcGF5bWVudC52dWU"],"sourcesContent":["<template>\n  <view class=\"payment-container\">\n    <!-- 导航栏 -->\n    <view class=\"navbar\">\n      <view class=\"nav-content\">\n        <view class=\"nav-left\" @click=\"goBack\">\n          <text class=\"back-arrow\">‹</text>\n        </view>\n        <view class=\"nav-center\">\n          <text class=\"nav-title\">订单支付</text>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 订单信息 -->\n    <view class=\"order-info\">\n      <view class=\"info-item\">\n        <text class=\"info-label\">订单信息:</text>\n        <text class=\"info-value\">{{ orderData.info }}</text>\n      </view>\n      <view class=\"info-item\">\n        <text class=\"info-label\">订单金额:</text>\n        <text class=\"info-value\">{{ orderData.amount }}金币</text>\n      </view>\n      <view class=\"info-item\">\n        <text class=\"info-label\">订单类型:</text>\n        <text class=\"info-value\">{{ getOrderTypeText(orderData.type) }}</text>\n      </view>\n      <view class=\"info-item\">\n        <text class=\"info-label\">下单渠道:</text>\n        <text class=\"info-value\">{{ getChannelText(orderData.channel) }}</text>\n      </view>\n    </view>\n    \n    <!-- 支付方式选择 -->\n    <view class=\"payment-methods\">\n      <text class=\"section-title\">支付方式</text>\n      <radio-group @change=\"selectPaymentMethod\">\n        <label class=\"payment-method\">\n          <radio value=\"0\" :checked=\"orderData.payType === 0\" /> \n          <text class=\"method-text\">微信支付</text>\n        </label>\n        <label class=\"payment-method\">\n          <radio value=\"1\" :checked=\"orderData.payType === 1\" /> \n          <text class=\"method-text\">账户余额</text>\n        </label>\n      </radio-group>\n    </view>\n    \n    <!-- 支付按钮 -->\n    <view class=\"payment-btn-container\">\n      <button class=\"payment-btn\"  \r\n\t  @click=\"handlePayment\"\n    >确认支付</button>\n    </view>\n    \r\n\t<!-- 二维码支付弹出层 -->\r\n\t<view class=\"qr-modal\" v-if=\"showQRModal\" @click=\"closeQRModal\">\r\n\t  <view class=\"qr-content\" @click.stop>\r\n\t    <view class=\"qr-header\">\r\n\t      <text class=\"qr-title\">扫码支付</text>\r\n\t      <text class=\"close-btn\" @click=\"closeQRModal\">×</text>\r\n\t    </view>\r\n\t    <view class=\"qr-body\">\r\n\t      <view class=\"qr-code-container\">\r\n\t        <image \r\n\t          v-if=\"qrCodeUrl\"\r\n\t          :src=\"qrCodeUrl\" \r\n\t          class=\"qr-image\"\r\n\t          :style=\"{ width: qrSize + 'px', height: qrSize + 'px' }\"\r\n\t          mode=\"aspectFit\"\r\n\t        ></image>\r\n\t        <view v-else class=\"qr-loading\">\r\n\t          <text class=\"loading-text\">生成二维码中...</text>\r\n\t        </view>\r\n\t      </view>\r\n\t      <text class=\"qr-tip\">请使用微信扫描二维码完成支付</text>\r\n\t      <text class=\"qr-amount\">支付金额：¥{{ orderData.amount }}元</text>\r\n\t      <text class=\"qr-status\" v-if=\"isCheckingPayment\">正在检查支付状态...</text>\r\n\t      <text class=\"qr-hint\" v-if=\"isCheckingPayment\">如已支付完成，可点击下方\"支付完成\"按钮</text>\r\n\t    </view>\r\n\t   <!-- <view class=\"qr-footer\">\r\n\t      <button class=\"cancel-qr-btn\" @click=\"closeQRModal\">取消支付</button>\r\n\t      <button class=\"refresh-qr-btn\" @click=\"refreshQRCode\">刷新二维码</button>\r\n\t      <button class=\"success-qr-btn\" @click=\"handlePaymentSuccess\">支付完成</button>\r\n\t    </view> -->\r\n\t  </view>\r\n\t</view>\r\n\t\r\n\t\n    <!-- 支付结果提示 -->\n  <!--  <view class=\"payment-result\" v-if=\"paymentResult\">\n      <uni-icons \n        :type=\"paymentResult.success ? 'checkmarkempty' : 'closeempty'\" \n        size=\"60\" \n        :color=\"paymentResult.success ? '#4CAF50' : '#F44336'\"\n      ></uni-icons>\n      <text class=\"result-text\">{{ paymentResult.message }}</text>\n      <button class=\"result-btn\" @click=\"handleResult\">\n        {{ paymentResult.success ? '查看订单' : '重新支付' }}\n      </button>\n    </view> -->\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport { apiRewardVideo,apiWxpay,apiCheckVideoPayment,apiGetUserBalance,apigoldpay, } from '@/api/apis';\nimport { getToken, getAccount } from '@/utils/request.js';\n\r\n\r\n// 二维码相关数据\nconst showQRModal = ref(false)\nconst qrSize = ref(200)\nconst currentPaymentUrl = ref('')\nconst qrCodeUrl = ref('')\nconst paymentCheckTimer = ref(null)\nconst isCheckingPayment = ref(false)\nconst isRefreshing = ref(false)\r\n\n// 订单数据\nconst orderData = ref({\n  info: '',\n  amount: '',\n  type: 2, // 默认打赏类型\n  account: '',\n  payType: 0, // 默认微信支付\n  channel: 1 // 默认微信小程序\n});\n\n// 支付结果\nconst paymentResult = ref(null);\n\n// 获取路由参数\nonLoad((options) => {\n  // 从路由参数中获取订单数据\n  if (options.info) orderData.value.info = decodeURIComponent(options.info);\n  if (options.amount) orderData.value.amount = options.amount;\n  if (options.type) orderData.value.type = parseInt(options.type);\n  if (options.account) orderData.value.account = decodeURIComponent(options.account);\n  if (options.payType) orderData.value.payType = parseInt(options.payType);\n  if (options.channel) orderData.value.channel = parseInt(options.channel);\r\n  if (options.videoId) orderData.value.videoId = options.videoId; // 获取视频ID\n  \n  // 如果没有账号信息，使用当前登录账号\n  if (!orderData.value.account) {\n    orderData.value.account = getAccount();\n  }\n});\n\n// 获取订单类型文本\nconst getOrderTypeText = (type) => {\n  const types = {\n    0: '充值',\n    1: '提现',\n    2: '打赏',\n    3: '视频付费'\n  };\n  return types[type] || '未知类型';\n};\n\n// 获取下单渠道文本\nconst getChannelText = (channel) => {\n  const channels = {\n    0: '电脑端',\n    1: '微信小程序',\n    2: 'APP'\n  };\n  return channels[channel] || '未知渠道';\n};\n\n// 选择支付方式\nconst selectPaymentMethod = (e) => {\n  orderData.value.payType = parseInt(e.detail.value);\n};\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack();\n};\n\r\n//---------------------------------------------------------------------------\r\n\r\n\r\nconst handlePayment = () => {\n  uni.showModal({\n    title: '确认支付',\n    content: `确认支付 ¥${orderData.value.amount}元 购买 ${orderData.value.amount}个金币？`,\n    success: (res) => {\n      if (res.confirm) {\n        // 这里调用支付API\n        processPayment()\n      }\n    }\n  })\n}\r\nconst processPayment = async () => {\n  uni.showLoading({\n    title: '处理中...'\n  })\n  \n  try {\n    // 准备充值数据\n    const rechargeData = {\n      info: `用户充值${orderData.value.amount}元`,\n      amount: orderData.value.amount.toString(),\n      type: orderData.value.type, // 0表示充值\n      account: getAccount() || currentUser.value,\n      payType:orderData.value.payType// 0表示微信支付\n    }\r\n\t\r\n\t\r\n\t// 如果是余额支付\r\n\t    if (orderData.value.payType === 1) {\r\n\t      // 1. 查询用户余额\r\n\t      const balanceResponse = await apiGetUserBalance({\r\n\t        account: getAccount()\r\n\t      })\r\n\t      if (balanceResponse.code !== 200) {\r\n\t        uni.hideLoading()\r\n\t        uni.showToast({\r\n\t          title: balanceResponse.msg || '查询余额失败',\r\n\t          icon: 'none'\r\n\t        })\r\n\t        return\r\n\t      }\r\n\t      \r\n\t      const userBalance = parseFloat(balanceResponse.data || 0)\r\n\t      const paymentAmount = parseFloat(orderData.value.amount)\r\n\t      \r\n\t      // 2. 检查余额是否足够\r\n\t      if (userBalance < paymentAmount) {\r\n\t\t\t  console.log(userBalance,paymentAmount)\r\n\t        uni.hideLoading()\r\n\t        uni.showToast({\r\n\t          title: '余额不足，请充值',\r\n\t          icon: 'none'\r\n\t        })\r\n\t        \r\n\t        // 跳转到充值页面\r\n\t        setTimeout(() => {\r\n\t          uni.navigateTo({\r\n\t            url: '/pages/recharge/recharge'\r\n\t          })\r\n\t        }, 1500)\r\n\t        return\r\n\t      }\r\n\t\t  //  创建订单\r\n\t\t   const orderResponse = await apiRewardVideo(rechargeData)\r\n\t       if (orderResponse.code !== 200) {\r\n\t              uni.hideLoading()\r\n\t              uni.showToast({\r\n\t                title: orderResponse.msg || '创建订单失败',\r\n\t                icon: 'none'\r\n\t              })\r\n\t              return\r\n\t            }\r\n\t        // 获取订单号\r\n\t        const orderNo = orderResponse.data\r\n\t      // 3. 调用余额支付接口\r\n\t      const goldPayResponse = await apigoldpay({\r\n\t        account: getAccount(),\r\n\t        orderNo: orderNo,\r\n\t        remark: orderData.value.videoId \r\n\t      })\r\n\t      \r\n\t      uni.hideLoading()\r\n\t      \r\n\t      if (goldPayResponse.code === 200) {\r\n\t        // 余额支付成功\r\n\t        uni.showModal({\r\n\t          title: '支付成功',\r\n\t          content: `成功支付${orderData.value.amount}金币`,\r\n\t          showCancel: false,\r\n\t          success: () => {\r\n\t            // 返回上一页\r\n\t            goBack()\r\n\t          }\r\n\t        })\r\n\t      } else {\r\n\t        uni.showToast({\r\n\t          title: goldPayResponse.msg || '余额支付失败',\r\n\t          icon: 'none'\r\n\t        })\r\n\t      }\r\n\t      return\r\n\t    }\n    \n    \n    // 调用充值接口\n    const response = await apiRewardVideo(rechargeData)\r\n\t // 如果充值接口返回订单号，调用微信支付接口\r\n\t    if (response.code === 200 && response.data) {\r\n\t      // 调用微信支付接口\r\n\t      const wxPayResponse = await callWxPayApi(response.data)\r\n\t      \r\n\t      if (wxPayResponse.code === 200) {\r\n\t        // 处理微信支付返回的数据\r\n\t        handleWxPayResponse(wxPayResponse.data)\r\n\t      } else {\r\n\t        uni.showToast({\r\n\t          title: wxPayResponse.msg || '微信支付请求失败',\r\n\t          icon: 'none'\r\n\t        })\r\n\t      }\r\n\t    } else {\r\n\t      uni.showToast({\r\n\t        title: response.msg || '充值失败',\r\n\t        icon: 'none'\r\n\t      })\r\n\t    }\n    uni.hideLoading()\n    \n    if (response.code === 200) {\n      // 充值成功，处理微信支付\n      if (response.data && response.data.includes('weixin://wxpay')) {\n        // 显示二维码支付\n        currentPaymentUrl.value = response.data\n        showQRModal.value = true\n        \n        // 生成二维码\n        setTimeout(() => {\n          generateQRCode(response.data)\n          // 开始检查支付状态\n          startPaymentCheck()\n        }, 100)\n      } \n    } else {\n      // 充值失败\n      uni.showToast({\n        title: response.msg || '充值失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    uni.hideLoading()\n    console.error('充值接口调用失败:', error)\n    uni.showToast({\n      title: '网络错误，请重试',\n      icon: 'none'\n    })\n  }\n}\r\n\r\n// 调用微信支付API\nconst callWxPayApi = async (orderNo) => {\r\n\t\n  try {\n    // 准备微信支付数据\n    const wxPayData = {\n      account: getAccount(),\n      orderNo: orderNo,\n      remark: orderData.value.videoId \n    }\n    // 调用微信支付API\n    return await apiWxpay(wxPayData)\n  } catch (error) {\n    console.error('微信支付接口调用失败:', error)\n    return {\n      code: 500,\n      msg: '微信支付接口调用失败'\n    }\n  }\n}\r\n\r\n// 处理微信支付返回的数据\nconst handleWxPayResponse = (wxPayData) => {\n  if (wxPayData && wxPayData.includes('weixin://wxpay')) {\n    // 显示二维码支付\n    currentPaymentUrl.value = wxPayData\n    showQRModal.value = true\n    \n    // 生成二维码\n    setTimeout(() => {\n      generateQRCode(wxPayData)\n      // 开始检查支付状态\n      startPaymentCheck()\n    }, 100)\n  } \n}\r\n// 二维码相关方法\nconst generateQRCode = (url) => {\n  try {\n    // 首先尝试使用qrcode库\n    import('qrcode').then(QRCode => {\n      // 生成二维码数据URL\n      QRCode.toDataURL(url, {\n        width: qrSize.value,\n        height: qrSize.value,\n        margin: 2,\n        color: {\n          dark: '#000000',\n          light: '#FFFFFF'\n        }\n      }, (error, dataUrl) => {\n        if (error) {\n          console.error('二维码生成失败:', error)\n          // 使用在线服务作为备选\n          generateQRCodeOnline(url)\n        } else {\n          // 直接设置二维码URL\n          qrCodeUrl.value = dataUrl\n        }\n      })\n    }).catch(error => {\n      console.error('导入qrcode库失败:', error)\n      // 使用在线服务作为备选\n      generateQRCodeOnline(url)\n    })\n  } catch (error) {\n    console.error('生成二维码失败:', error)\n    // 使用在线服务作为备选\n    generateQRCodeOnline(url)\n  }\n}\n\n// 使用在线服务生成二维码\nconst generateQRCodeOnline = (url) => {\n  try {\n    // 使用qrcode.js在线服务\n    const encodedUrl = encodeURIComponent(url)\n    const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize.value}x${qrSize.value}&data=${encodedUrl}`\n    qrCodeUrl.value = qrApiUrl\n  } catch (error) {\n    console.error('在线二维码生成失败:', error)\n    uni.showToast({\n      title: '二维码生成失败',\n      icon: 'none'\n    })\n  }\n}\r\n\r\n\r\n\n// 开始检查支付状态\nconst startPaymentCheck = () => {\n  // 清除之前的定时器\n  if (paymentCheckTimer.value) {\n    clearInterval(paymentCheckTimer.value)\n  }\n  \n  isCheckingPayment.value = true\n  let checkCount = 0\n  const maxChecks = 20 // 最多检查20次（100秒）\n \n  \n  \n  // 每3秒检查一次支付状态\n  paymentCheckTimer.value = setInterval(async () => {\n    try {\n      checkCount++\n       // 调用真实API检查支付状态\r\n            const paymentStatus = await checkRealPaymentStatus()\r\n            \r\n            if (paymentStatus === true) {\r\n              // 支付成功\r\n              await handlePaymentSuccess()\r\n              return\r\n            } else if (paymentStatus === false) {\r\n              // 支付失败或仍在处理中，继续检查\r\n              console.log('支付状态检查中...')\r\n            }\n      // 如果检查次数达到上限，停止检查\n      if (checkCount >= maxChecks) {\n        console.log('支付检查超时，停止检查')\n        stopPaymentCheck()\n        uni.showToast({\n          title: '支付检查超时，请手动确认',\n          icon: 'none',\n          duration: 3000\n        })\n      }\n      \n      // 实际项目中，这里应该调用后端接口检查支付状态\n      // const paymentStatus = await checkPaymentStatus(currentPaymentUrl.value)\n      // if (paymentStatus === 'success') {\n      //   await handlePaymentSuccess()\n      // }\n    } catch (error) {\n      console.error('检查支付状态失败:', error)\n    }\n  }, 3000)\n}\r\n// 检查真实支付状态\nconst checkRealPaymentStatus = async () => {\n  try {\n    // 调用支付状态检查API\n    const response = await apiCheckVideoPayment({\n      videoId: orderData.value.videoId,\n      account: getAccount()\n    })\n    \n    if (response.code === 200) {\n      // 根据API返回的data字段判断支付状态\n      return response.data // true表示已支付，false表示未支付\n    }\n    \n    return false\n  } catch (error) {\n    console.error('支付状态检查API调用失败:', error)\n    return false\n  }\n}\r\n\nconst closeQRModal = () => {\n  // 停止检查支付状态\n  stopPaymentCheck()\n  goBack();\n  // showQRModal.value = false\n  // currentPaymentUrl.value = ''\n  // qrCodeUrl.value = ''\n}\r\n//刷新二维码\r\nconst refreshQRCode = () => {\r\n  if (currentPaymentUrl.value) {\r\n    qrCodeUrl.value = '' // 清空当前二维码\r\n    generateQRCode(currentPaymentUrl.value)\r\n  }\r\n}\r\n\r\n//---------------------------------------------------------------------------\r\n\n// 确认支付\nconst confirmPayment = async () => {\n  try {\n    // 检查是否登录\n    const token = getToken();\n    if (!token) {\n      uni.showToast({\n        title: '请先登录',\n        icon: 'none'\n      });\n      setTimeout(() => {\n        uni.navigateTo({\n          url: '/pages/login/login'\n        });\n      }, 1500);\n      return;\n    }\n    \n    // 调用支付API\n    const response = await apiRewardVideo(orderData);\n    \n    if (response.success) {\n      // 支付成功\n      paymentResult.value = {\n        success: true,\n        message: '支付成功！'\n      };\n    } else {\n      // 支付失败\n      paymentResult.value = {\n        success: false,\n        message: response.message || '支付失败，请重试'\n      };\n    }\n  } catch (error) {\n    console.error('支付失败:', error);\n    paymentResult.value = {\n      success: false,\n      message: error.message || '支付失败，请重试'\n    };\n  }\n};\n\r\n// 处理支付成功\r\nconst handlePaymentSuccess = async () => {\r\n  try {\r\n\t  // 关闭二维码弹窗\r\n\t  closeQRModal()\r\n    // 停止检查支付状态\r\n    stopPaymentCheck()\r\n    // 显示支付成功提示\r\n    uni.showModal({\r\n      title: '支付成功',\r\n      content: `恭喜您！成功充值${orderData.value.amount}个金币`,\r\n      showCancel: false,\r\n      success: () => {\r\n      }\r\n    })\r\n    \r\n  } catch (error) {\r\n    console.error('处理支付成功失败:', error)\r\n  }\r\n}\r\n\r\n\r\n// 页面刷新方法（保留用于支付成功后调用）\r\nconst refreshPage = async () => {\r\n  try {\r\n    uni.navigateTo({\r\n      url: '/pages/video/play'\r\n    });\r\n  } catch (error) {\r\n    console.error('页面刷新失败:', error)\r\n  }\r\n}\n// 处理支付结果\nconst handleResult = () => {\n  if (paymentResult.value.success) {\n    // 支付成功，跳转到订单页面\n    uni.navigateTo({\n      url: '/pages/video/play'\n    });\n  } else {\n    // 支付失败，重置支付结果\n    paymentResult.value = null;\n  }\n};\r\n// 停止检查支付状态\nconst stopPaymentCheck = () => {\n  if (paymentCheckTimer.value) {\n    clearInterval(paymentCheckTimer.value)\n    paymentCheckTimer.value = null\n  }\n  isCheckingPayment.value = false\n  console.log('停止检查支付状态')\n}\n</script>\n\n<style scoped>\n.payment-container {\n  padding: 20rpx;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n}\n\n/* 导航栏 */\n.navbar {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  height: 88rpx;\n  background-color: #fff;\n  z-index: 999;\n  border-bottom: 1rpx solid #e8e8e8;\n}\n\n.nav-content {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  height: 100%;\n  padding: 0 30rpx;\n}\n\n.nav-left, .nav-right {\n  width: 80rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.back-arrow {\n  font-size: 40rpx;\n  color: #333;\n  font-weight: bold;\n}\n\n.nav-center {\n  flex: 1; \n  display: flex;\n  justify-content: center; \n  align-items: center; \n}\n\n.nav-title {\n  font-size: 36rpx;\n  font-weight: 600;\n  color: #333;\n  text-align: center;\n}\n\n/* 订单信息 */\n.order-info {\n  margin-top: 100rpx;\n  padding: 30rpx;\n  background-color: #fff;\n  border-radius: 16rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n}\n\n.info-item {\n  display: flex;\n  margin-bottom: 25rpx;\n  padding-bottom: 25rpx;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.info-item:last-child {\n  margin-bottom: 0;\n  padding-bottom: 0;\n  border-bottom: none;\n}\n\n.info-label {\n  width: 180rpx;\n  font-size: 30rpx;\n  color: #666;\n}\n\n.info-value {\n  flex: 1;\n  font-size: 30rpx;\n  color: #333;\n  font-weight: 500;\n}\n\n/* 支付方式选择 */\n.payment-methods {\n  margin-top: 30rpx;\n  padding: 20rpx;\n  background-color: #fff;\n  border-radius: 16rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 20rpx;\n  display: block;\n}\n\n.payment-method {\n  display: flex;\n  align-items: center;\n  margin-bottom: 15rpx;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.method-text {\n  margin-left: 15rpx;\n}\n\n/* 支付按钮 */\n.payment-btn-container {\n  margin-top: 40rpx;\n  padding: 0 30rpx;\n}\n\n.payment-btn {\n  background-color: #3498db;\n  color: white;\n  border-radius: 50rpx;\n  padding: 25rpx;\n  font-size: 34rpx;\n  font-weight: 500;\n}\n\n/* 支付结果 */\n.payment-result {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(255, 255, 255, 0.95);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  padding: 40rpx;\n  text-align: center;\n}\n\n.result-text {\n  font-size: 36rpx;\n  color: #333;\n  margin: 30rpx 0;\n  font-weight: 500;\n}\n\n.result-btn {\n  background-color: #3498db;\n  color: white;\n  border-radius: 50rpx;\n  padding: 20rpx 40rpx;\n  font-size: 32rpx;\n  margin-top: 20rpx;\n}\r\n\r\n\r\n/* 二维码弹出层样式 */\n.qr-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 40rpx;\n}\n\n.qr-content {\n  width: 100%;\n  max-width: 500rpx;\n  background-color: #fff;\n  border-radius: 20rpx;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 10rpx 40rpx rgba(0, 0, 0, 0.2);\n}\n\n.qr-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 30rpx;\n  border-bottom: 1rpx solid #f0f0f0;\n}\n\n.qr-title {\n  font-size: 36rpx;\n  font-weight: 600;\n  color: #333;\n}\n\n.close-btn {\n  font-size: 40rpx;\n  color: #999;\n  font-weight: bold;\n  width: 60rpx;\n  text-align: center;\n}\n\n.qr-body {\n  padding: 40rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.qr-code-container {\n  margin-bottom: 30rpx;\n  padding: 20rpx;\n  background-color: #f8f9fa;\n  border-radius: 15rpx;\n}\n\n.qr-image {\n  display: block;\n  border-radius: 10rpx;\n}\n\n.qr-loading {\n  width: 200px;\n  height: 200px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #f8f9fa;\n  border-radius: 10rpx;\n}\n\n.loading-text {\n  font-size: 28rpx;\n  color: #666;\n}\n\n.qr-tip {\n  font-size: 28rpx;\n  color: #666;\n  text-align: center;\n  margin-bottom: 15rpx;\n}\n\n.qr-amount {\n  font-size: 32rpx;\n  color: #ff4757;\n  font-weight: 600;\n  text-align: center;\n}\n\n.qr-status {\n  font-size: 24rpx;\n  color: #28B389;\n  text-align: center;\n  margin-top: 10rpx;\n  animation: pulse 1.5s infinite;\n}\n\n.qr-hint {\n  font-size: 22rpx;\n  color: #999;\n  text-align: center;\n  margin-top: 8rpx;\n  line-height: 1.4;\n}\n\n@keyframes pulse {\n  0% { opacity: 1; }\n  50% { opacity: 0.5; }\n  100% { opacity: 1; }\n}\n\n.qr-footer {\n  display: flex;\n  gap: 20rpx;\n  padding: 30rpx;\n  border-top: 1rpx solid #f0f0f0;\n}\n\n.cancel-qr-btn, .refresh-qr-btn, .success-qr-btn {\n  flex: 1;\n  height: 80rpx;\n  border: none;\n  border-radius: 40rpx;\n  font-size: 28rpx;\n  font-weight: 500;\n}\n\n.cancel-qr-btn {\n  background-color: #f5f5f5;\n  color: #666;\n}\n\n.refresh-qr-btn {\n  background-color: #28B389;\n  color: #fff;\n}\n\n.success-qr-btn {\n  background-color: #ff4757;\n  color: #fff;\n}\n</style>","import MiniProgramPage from 'C:/Users/Administrator/Desktop/my-painting-rules-project/pages/video/payment.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","getAccount","uni","apiGetUserBalance","apiRewardVideo","apigoldpay","apiWxpay","apiCheckVideoPayment"],"mappings":"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"}