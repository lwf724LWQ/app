{"version":3,"file":"payment.js","sources":["pages/video/payment.vue","D:/uniapp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdmlkZW8vcGF5bWVudC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"payment-container\">\r\n    <!-- 导航栏 -->\r\n    <view class=\"navbar\">\r\n      <view class=\"nav-content\">\r\n        <view class=\"nav-left\" @click=\"goBack\">\r\n          <text class=\"back-arrow\">‹</text>\r\n        </view>\r\n        <view class=\"nav-center\">\r\n          <text class=\"nav-title\">订单支付</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 订单信息 -->\r\n    <view class=\"order-info\">\r\n      <view class=\"info-item\">\r\n        <text class=\"info-label\">订单信息:</text>\r\n        <text class=\"info-value\">{{ orderData.info }}</text>\r\n      </view>\r\n      <view class=\"info-item\">\r\n        <text class=\"info-label\">订单金额:</text>\r\n        <text class=\"info-value\">{{ orderData.amount }}金币</text>\r\n      </view>\r\n      <view class=\"info-item\">\r\n        <text class=\"info-label\">订单类型:</text>\r\n        <text class=\"info-value\">{{ getOrderTypeText(orderData.type) }}</text>\r\n      </view>\r\n      <view class=\"info-item\">\r\n        <text class=\"info-label\">下单渠道:</text>\r\n        <text class=\"info-value\">{{ getChannelText(orderData.channel) }}</text>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 支付方式选择 -->\r\n    <view class=\"payment-methods\">\r\n      <text class=\"section-title\">支付方式</text>\r\n      <radio-group @change=\"selectPaymentMethod\">\r\n        <label class=\"payment-method\">\r\n          <radio value=\"0\" :checked=\"orderData.payType === 0\" /> \r\n          <text class=\"method-text\">微信支付</text>\r\n        </label>\r\n        <label class=\"payment-method\">\r\n          <radio value=\"1\" :checked=\"orderData.payType === 1\" /> \r\n          <text class=\"method-text\">账户余额</text>\r\n        </label>\r\n      </radio-group>\r\n    </view>\r\n    \r\n    <!-- 支付按钮 -->\r\n    <view class=\"payment-btn-container\">\r\n      <button class=\"payment-btn\"  \r\n\t  @click=\"handlePayment\"\r\n    >确认支付</button>\r\n    </view>\r\n    \r\n\t<!-- 二维码支付弹出层 -->\r\n\t<view class=\"qr-modal\" v-if=\"showQRModal\" @click=\"closeQRModal\">\r\n\t  <view class=\"qr-content\" @click.stop>\r\n\t    <view class=\"qr-header\">\r\n\t      <text class=\"qr-title\">扫码支付</text>\r\n\t      <text class=\"close-btn\" @click=\"closeQRModal\">×</text>\r\n\t    </view>\r\n\t    <view class=\"qr-body\">\r\n\t      <view class=\"qr-code-container\">\r\n\t        <image \r\n\t          v-if=\"qrCodeUrl\"\r\n\t          :src=\"qrCodeUrl\" \r\n\t          class=\"qr-image\"\r\n\t          :style=\"{ width: qrSize + 'px', height: qrSize + 'px' }\"\r\n\t          mode=\"aspectFit\"\r\n\t        ></image>\r\n\t        <view v-else class=\"qr-loading\">\r\n\t          <text class=\"loading-text\">生成二维码中...</text>\r\n\t        </view>\r\n\t      </view>\r\n\t      <text class=\"qr-tip\">请使用微信扫描二维码完成支付</text>\r\n\t      <text class=\"qr-amount\">支付金额：¥{{ orderData.amount }}元</text>\r\n\t      <text class=\"qr-status\" v-if=\"isCheckingPayment\">正在检查支付状态...</text>\r\n\t      <text class=\"qr-hint\" v-if=\"isCheckingPayment\">如已支付完成，可点击下方\"支付完成\"按钮</text>\r\n\t    </view>\r\n\t   <!-- <view class=\"qr-footer\">\r\n\t      <button class=\"cancel-qr-btn\" @click=\"closeQRModal\">取消支付</button>\r\n\t      <button class=\"refresh-qr-btn\" @click=\"refreshQRCode\">刷新二维码</button>\r\n\t      <button class=\"success-qr-btn\" @click=\"handlePaymentSuccess\">支付完成</button>\r\n\t    </view> -->\r\n\t  </view>\r\n\t</view>\r\n\t\r\n\t\r\n    <!-- 支付结果提示 -->\r\n  <!--  <view class=\"payment-result\" v-if=\"paymentResult\">\r\n      <uni-icons \r\n        :type=\"paymentResult.success ? 'checkmarkempty' : 'closeempty'\" \r\n        size=\"60\" \r\n        :color=\"paymentResult.success ? '#4CAF50' : '#F44336'\"\r\n      ></uni-icons>\r\n      <text class=\"result-text\">{{ paymentResult.message }}</text>\r\n      <button class=\"result-btn\" @click=\"handleResult\">\r\n        {{ paymentResult.success ? '查看订单' : '重新支付' }}\r\n      </button>\r\n    </view> -->\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport { onLoad } from '@dcloudio/uni-app';\r\nimport { apiRewardVideo,apiWxpay,apiCheckVideoPayment,apiGetUserBalance,apigoldpay, } from '@/api/apis';\r\nimport { getToken, getAccount } from '@/utils/request.js';\r\n\r\n\r\n// 二维码相关数据\r\nconst showQRModal = ref(false)\r\nconst qrSize = ref(200)\r\nconst currentPaymentUrl = ref('')\r\nconst qrCodeUrl = ref('')\r\nconst paymentCheckTimer = ref(null)\r\nconst isCheckingPayment = ref(false)\r\nconst isRefreshing = ref(false)\r\n\r\n// 订单数据\r\nconst orderData = ref({\r\n  info: '',\r\n  amount: '',\r\n  type: 2, // 默认打赏类型\r\n  account: '',\r\n  payType: 0, // 默认微信支付\r\n  channel: 1 // 默认微信小程序\r\n});\r\n\r\n// 支付结果\r\nconst paymentResult = ref(null);\r\n\r\n// 获取路由参数\r\nonLoad((options) => {\r\n  // 从路由参数中获取订单数据\r\n  if (options.info) orderData.value.info = decodeURIComponent(options.info);\r\n  if (options.amount) orderData.value.amount = options.amount;\r\n  if (options.type) orderData.value.type = parseInt(options.type);\r\n  if (options.account) orderData.value.account = decodeURIComponent(options.account);\r\n  if (options.payType) orderData.value.payType = parseInt(options.payType);\r\n  if (options.channel) orderData.value.channel = parseInt(options.channel);\r\n  if (options.videoId) orderData.value.videoId = options.videoId; // 获取视频ID\r\n  \r\n  // 如果没有账号信息，使用当前登录账号\r\n  if (!orderData.value.account) {\r\n    orderData.value.account = getAccount();\r\n  }\r\n});\r\n\r\n// 获取订单类型文本\r\nconst getOrderTypeText = (type) => {\r\n  const types = {\r\n    0: '充值',\r\n    1: '提现',\r\n    2: '打赏',\r\n    3: '视频付费'\r\n  };\r\n  return types[type] || '未知类型';\r\n};\r\n\r\n// 获取下单渠道文本\r\nconst getChannelText = (channel) => {\r\n  const channels = {\r\n    0: '电脑端',\r\n    1: '微信小程序',\r\n    2: 'APP'\r\n  };\r\n  return channels[channel] || '未知渠道';\r\n};\r\n\r\n// 选择支付方式\r\nconst selectPaymentMethod = (e) => {\r\n  orderData.value.payType = parseInt(e.detail.value);\r\n};\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n  uni.navigateBack();\r\n};\r\n\r\n//---------------------------------------------------------------------------\r\n\r\n\r\nconst handlePayment = () => {\r\n  uni.showModal({\r\n    title: '确认支付',\r\n    content: `确认支付 ¥${orderData.value.amount}元 购买 ${orderData.value.amount}个金币？`,\r\n    success: (res) => {\r\n      if (res.confirm) {\r\n        // 这里调用支付API\r\n        processPayment()\r\n      }\r\n    }\r\n  })\r\n}\r\nconst processPayment = async () => {\r\n  uni.showLoading({\r\n    title: '处理中...'\r\n  })\r\n  \r\n  try {\r\n    // 准备充值数据\r\n    const rechargeData = {\r\n      info: `用户充值${orderData.value.amount}元`,\r\n      amount: orderData.value.amount.toString(),\r\n      type: orderData.value.type, // 0表示充值\r\n      account: getAccount() || currentUser.value,\r\n      payType:orderData.value.payType// 0表示微信支付\r\n    }\r\n\t\r\n\t\r\n\t// 如果是余额支付\r\n\t    if (orderData.value.payType === 1) {\r\n\t      // 1. 查询用户余额\r\n\t      const balanceResponse = await apiGetUserBalance({\r\n\t        account: getAccount()\r\n\t      })\r\n\t      if (balanceResponse.code !== 200) {\r\n\t        uni.hideLoading()\r\n\t        uni.showToast({\r\n\t          title: balanceResponse.msg || '查询余额失败',\r\n\t          icon: 'none'\r\n\t        })\r\n\t        return\r\n\t      }\r\n\t      \r\n\t      const userBalance = parseFloat(balanceResponse.data || 0)\r\n\t      const paymentAmount = parseFloat(orderData.value.amount)\r\n\t      \r\n\t      // 2. 检查余额是否足够\r\n\t      if (userBalance < paymentAmount) {\r\n\t\t\t  console.log(userBalance,paymentAmount)\r\n\t        uni.hideLoading()\r\n\t        uni.showToast({\r\n\t          title: '余额不足，请充值',\r\n\t          icon: 'none'\r\n\t        })\r\n\t        \r\n\t        // 跳转到充值页面\r\n\t        setTimeout(() => {\r\n\t          uni.navigateTo({\r\n\t            url: '/pages/recharge/recharge'\r\n\t          })\r\n\t        }, 1500)\r\n\t        return\r\n\t      }\r\n\t\t  //  创建订单\r\n\t\t   const orderResponse = await apiRewardVideo(rechargeData)\r\n\t       if (orderResponse.code !== 200) {\r\n\t              uni.hideLoading()\r\n\t              uni.showToast({\r\n\t                title: orderResponse.msg || '创建订单失败',\r\n\t                icon: 'none'\r\n\t              })\r\n\t              return\r\n\t            }\r\n\t        // 获取订单号\r\n\t        const orderNo = orderResponse.data\r\n\t      // 3. 调用余额支付接口\r\n\t      const goldPayResponse = await apigoldpay({\r\n\t        account: getAccount(),\r\n\t        orderNo: orderNo,\r\n\t        remark: orderData.value.videoId \r\n\t      })\r\n\t      \r\n\t      uni.hideLoading()\r\n\t      \r\n\t      if (goldPayResponse.code === 200) {\r\n\t        // 余额支付成功\r\n\t        uni.showModal({\r\n\t          title: '支付成功',\r\n\t          content: `成功支付${orderData.value.amount}金币`,\r\n\t          showCancel: false,\r\n\t          success: () => {\r\n\t            // 返回上一页\r\n\t            goBack()\r\n\t          }\r\n\t        })\r\n\t      } else {\r\n\t        uni.showToast({\r\n\t          title: goldPayResponse.msg || '余额支付失败',\r\n\t          icon: 'none'\r\n\t        })\r\n\t      }\r\n\t      return\r\n\t    }\r\n    \r\n    \r\n    // 调用充值接口\r\n    const response = await apiRewardVideo(rechargeData)\r\n\t // 如果充值接口返回订单号，调用微信支付接口\r\n\t    if (response.code === 200 && response.data) {\r\n\t      // 调用微信支付接口\r\n\t      const wxPayResponse = await callWxPayApi(response.data)\r\n\t      \r\n\t      if (wxPayResponse.code === 200) {\r\n\t        // 处理微信支付返回的数据\r\n\t        handleWxPayResponse(wxPayResponse.data)\r\n\t      } else {\r\n\t        uni.showToast({\r\n\t          title: wxPayResponse.msg || '微信支付请求失败',\r\n\t          icon: 'none'\r\n\t        })\r\n\t      }\r\n\t    } else {\r\n\t      uni.showToast({\r\n\t        title: response.msg || '充值失败',\r\n\t        icon: 'none'\r\n\t      })\r\n\t    }\r\n    uni.hideLoading()\r\n    \r\n    if (response.code === 200) {\r\n      // 充值成功，处理微信支付\r\n      if (response.data && response.data.includes('weixin://wxpay')) {\r\n        // 显示二维码支付\r\n        currentPaymentUrl.value = response.data\r\n        showQRModal.value = true\r\n        \r\n        // 生成二维码\r\n        setTimeout(() => {\r\n          generateQRCode(response.data)\r\n          // 开始检查支付状态\r\n          startPaymentCheck()\r\n        }, 100)\r\n      } \r\n    } else {\r\n      // 充值失败\r\n      uni.showToast({\r\n        title: response.msg || '充值失败',\r\n        icon: 'none'\r\n      })\r\n    }\r\n  } catch (error) {\r\n    uni.hideLoading()\r\n    console.error('充值接口调用失败:', error)\r\n    uni.showToast({\r\n      title: '网络错误，请重试',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\n// 调用微信支付API\r\nconst callWxPayApi = async (orderNo) => {\r\n\t\r\n  try {\r\n    // 准备微信支付数据\r\n    const wxPayData = {\r\n      account: getAccount(),\r\n      orderNo: orderNo,\r\n      remark: orderData.value.videoId \r\n    }\r\n    // 调用微信支付API\r\n    return await apiWxpay(wxPayData)\r\n  } catch (error) {\r\n    console.error('微信支付接口调用失败:', error)\r\n    return {\r\n      code: 500,\r\n      msg: '微信支付接口调用失败'\r\n    }\r\n  }\r\n}\r\n\r\n// 处理微信支付返回的数据\r\nconst handleWxPayResponse = (wxPayData) => {\r\n  if (wxPayData && wxPayData.includes('weixin://wxpay')) {\r\n    // 显示二维码支付\r\n    currentPaymentUrl.value = wxPayData\r\n    showQRModal.value = true\r\n    \r\n    // 生成二维码\r\n    setTimeout(() => {\r\n      generateQRCode(wxPayData)\r\n      // 开始检查支付状态\r\n      startPaymentCheck()\r\n    }, 100)\r\n  } \r\n}\r\n// 二维码相关方法\r\nconst generateQRCode = (url) => {\r\n  try {\r\n    // 首先尝试使用qrcode库\r\n    import('qrcode').then(QRCode => {\r\n      // 生成二维码数据URL\r\n      QRCode.toDataURL(url, {\r\n        width: qrSize.value,\r\n        height: qrSize.value,\r\n        margin: 2,\r\n        color: {\r\n          dark: '#000000',\r\n          light: '#FFFFFF'\r\n        }\r\n      }, (error, dataUrl) => {\r\n        if (error) {\r\n          console.error('二维码生成失败:', error)\r\n          // 使用在线服务作为备选\r\n          generateQRCodeOnline(url)\r\n        } else {\r\n          // 直接设置二维码URL\r\n          qrCodeUrl.value = dataUrl\r\n        }\r\n      })\r\n    }).catch(error => {\r\n      console.error('导入qrcode库失败:', error)\r\n      // 使用在线服务作为备选\r\n      generateQRCodeOnline(url)\r\n    })\r\n  } catch (error) {\r\n    console.error('生成二维码失败:', error)\r\n    // 使用在线服务作为备选\r\n    generateQRCodeOnline(url)\r\n  }\r\n}\r\n\r\n// 使用在线服务生成二维码\r\nconst generateQRCodeOnline = (url) => {\r\n  try {\r\n    // 使用qrcode.js在线服务\r\n    const encodedUrl = encodeURIComponent(url)\r\n    const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize.value}x${qrSize.value}&data=${encodedUrl}`\r\n    qrCodeUrl.value = qrApiUrl\r\n  } catch (error) {\r\n    console.error('在线二维码生成失败:', error)\r\n    uni.showToast({\r\n      title: '二维码生成失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\n\r\n\r\n// 开始检查支付状态\r\nconst startPaymentCheck = () => {\r\n  // 清除之前的定时器\r\n  if (paymentCheckTimer.value) {\r\n    clearInterval(paymentCheckTimer.value)\r\n  }\r\n  \r\n  isCheckingPayment.value = true\r\n  let checkCount = 0\r\n  const maxChecks = 20 // 最多检查20次（100秒）\r\n \r\n  \r\n  \r\n  // 每3秒检查一次支付状态\r\n  paymentCheckTimer.value = setInterval(async () => {\r\n    try {\r\n      checkCount++\r\n       // 调用真实API检查支付状态\r\n            const paymentStatus = await checkRealPaymentStatus()\r\n            \r\n            if (paymentStatus === true) {\r\n              // 支付成功\r\n              await handlePaymentSuccess()\r\n              return\r\n            } else if (paymentStatus === false) {\r\n              // 支付失败或仍在处理中，继续检查\r\n              console.log('支付状态检查中...')\r\n            }\r\n      // 如果检查次数达到上限，停止检查\r\n      if (checkCount >= maxChecks) {\r\n        console.log('支付检查超时，停止检查')\r\n        stopPaymentCheck()\r\n        uni.showToast({\r\n          title: '支付检查超时，请手动确认',\r\n          icon: 'none',\r\n          duration: 3000\r\n        })\r\n      }\r\n      \r\n      // 实际项目中，这里应该调用后端接口检查支付状态\r\n      // const paymentStatus = await checkPaymentStatus(currentPaymentUrl.value)\r\n      // if (paymentStatus === 'success') {\r\n      //   await handlePaymentSuccess()\r\n      // }\r\n    } catch (error) {\r\n      console.error('检查支付状态失败:', error)\r\n    }\r\n  }, 3000)\r\n}\r\n// 检查真实支付状态\r\nconst checkRealPaymentStatus = async () => {\r\n  try {\r\n    // 调用支付状态检查API\r\n    const response = await apiCheckVideoPayment({\r\n      videoId: orderData.value.videoId,\r\n      account: getAccount()\r\n    })\r\n    \r\n    if (response.code === 200) {\r\n      // 根据API返回的data字段判断支付状态\r\n      return response.data // true表示已支付，false表示未支付\r\n    }\r\n    \r\n    return false\r\n  } catch (error) {\r\n    console.error('支付状态检查API调用失败:', error)\r\n    return false\r\n  }\r\n}\r\n\r\nconst closeQRModal = () => {\r\n  // 停止检查支付状态\r\n  stopPaymentCheck()\r\n  goBack();\r\n  // showQRModal.value = false\r\n  // currentPaymentUrl.value = ''\r\n  // qrCodeUrl.value = ''\r\n}\r\n//刷新二维码\r\nconst refreshQRCode = () => {\r\n  if (currentPaymentUrl.value) {\r\n    qrCodeUrl.value = '' // 清空当前二维码\r\n    generateQRCode(currentPaymentUrl.value)\r\n  }\r\n}\r\n\r\n//---------------------------------------------------------------------------\r\n\r\n// 确认支付\r\nconst confirmPayment = async () => {\r\n  try {\r\n    // 检查是否登录\r\n    const token = getToken();\r\n    if (!token) {\r\n      uni.showToast({\r\n        title: '请先登录',\r\n        icon: 'none'\r\n      });\r\n      setTimeout(() => {\r\n        uni.navigateTo({\r\n          url: '/pages/login/login'\r\n        });\r\n      }, 1500);\r\n      return;\r\n    }\r\n    \r\n    // 调用支付API\r\n    const response = await apiRewardVideo(orderData);\r\n    \r\n    if (response.success) {\r\n      // 支付成功\r\n      paymentResult.value = {\r\n        success: true,\r\n        message: '支付成功！'\r\n      };\r\n    } else {\r\n      // 支付失败\r\n      paymentResult.value = {\r\n        success: false,\r\n        message: response.message || '支付失败，请重试'\r\n      };\r\n    }\r\n  } catch (error) {\r\n    console.error('支付失败:', error);\r\n    paymentResult.value = {\r\n      success: false,\r\n      message: error.message || '支付失败，请重试'\r\n    };\r\n  }\r\n};\r\n\r\n// 处理支付成功\r\nconst handlePaymentSuccess = async () => {\r\n  try {\r\n\t  // 关闭二维码弹窗\r\n\t  closeQRModal()\r\n    // 停止检查支付状态\r\n    stopPaymentCheck()\r\n    // 显示支付成功提示\r\n    uni.showModal({\r\n      title: '支付成功',\r\n      content: `恭喜您！成功充值${orderData.value.amount}个金币`,\r\n      showCancel: false,\r\n      success: () => {\r\n      }\r\n    })\r\n    \r\n  } catch (error) {\r\n    console.error('处理支付成功失败:', error)\r\n  }\r\n}\r\n\r\n\r\n// 页面刷新方法（保留用于支付成功后调用）\r\nconst refreshPage = async () => {\r\n  try {\r\n    uni.navigateTo({\r\n      url: '/pages/video/play'\r\n    });\r\n  } catch (error) {\r\n    console.error('页面刷新失败:', error)\r\n  }\r\n}\r\n// 处理支付结果\r\nconst handleResult = () => {\r\n  if (paymentResult.value.success) {\r\n    // 支付成功，跳转到订单页面\r\n    uni.navigateTo({\r\n      url: '/pages/video/play'\r\n    });\r\n  } else {\r\n    // 支付失败，重置支付结果\r\n    paymentResult.value = null;\r\n  }\r\n};\r\n// 停止检查支付状态\r\nconst stopPaymentCheck = () => {\r\n  if (paymentCheckTimer.value) {\r\n    clearInterval(paymentCheckTimer.value)\r\n    paymentCheckTimer.value = null\r\n  }\r\n  isCheckingPayment.value = false\r\n  console.log('停止检查支付状态')\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.payment-container {\r\n  padding: 20rpx;\r\n  background-color: #f5f5f5;\r\n  min-height: 100vh;\r\n}\r\n\r\n/* 导航栏 */\r\n.navbar {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 88rpx;\r\n  background-color: #fff;\r\n  z-index: 999;\r\n  border-bottom: 1rpx solid #e8e8e8;\r\n}\r\n\r\n.nav-content {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  height: 100%;\r\n  padding: 0 30rpx;\r\n}\r\n\r\n.nav-left, .nav-right {\r\n  width: 80rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.back-arrow {\r\n  font-size: 40rpx;\r\n  color: #333;\r\n  font-weight: bold;\r\n}\r\n\r\n.nav-center {\r\n  flex: 1; \r\n  display: flex;\r\n  justify-content: center; \r\n  align-items: center; \r\n}\r\n\r\n.nav-title {\r\n  font-size: 36rpx;\r\n  font-weight: 600;\r\n  color: #333;\r\n  text-align: center;\r\n}\r\n\r\n/* 订单信息 */\r\n.order-info {\r\n  margin-top: 100rpx;\r\n  padding: 30rpx;\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.info-item {\r\n  display: flex;\r\n  margin-bottom: 25rpx;\r\n  padding-bottom: 25rpx;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.info-item:last-child {\r\n  margin-bottom: 0;\r\n  padding-bottom: 0;\r\n  border-bottom: none;\r\n}\r\n\r\n.info-label {\r\n  width: 180rpx;\r\n  font-size: 30rpx;\r\n  color: #666;\r\n}\r\n\r\n.info-value {\r\n  flex: 1;\r\n  font-size: 30rpx;\r\n  color: #333;\r\n  font-weight: 500;\r\n}\r\n\r\n/* 支付方式选择 */\r\n.payment-methods {\r\n  margin-top: 30rpx;\r\n  padding: 20rpx;\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n  display: block;\r\n}\r\n\r\n.payment-method {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 15rpx;\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.method-text {\r\n  margin-left: 15rpx;\r\n}\r\n\r\n/* 支付按钮 */\r\n.payment-btn-container {\r\n  margin-top: 40rpx;\r\n  padding: 0 30rpx;\r\n}\r\n\r\n.payment-btn {\r\n  background-color: #3498db;\r\n  color: white;\r\n  border-radius: 50rpx;\r\n  padding: 25rpx;\r\n  font-size: 34rpx;\r\n  font-weight: 500;\r\n}\r\n\r\n/* 支付结果 */\r\n.payment-result {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(255, 255, 255, 0.95);\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n  padding: 40rpx;\r\n  text-align: center;\r\n}\r\n\r\n.result-text {\r\n  font-size: 36rpx;\r\n  color: #333;\r\n  margin: 30rpx 0;\r\n  font-weight: 500;\r\n}\r\n\r\n.result-btn {\r\n  background-color: #3498db;\r\n  color: white;\r\n  border-radius: 50rpx;\r\n  padding: 20rpx 40rpx;\r\n  font-size: 32rpx;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n\r\n/* 二维码弹出层样式 */\r\n.qr-modal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  z-index: 1000;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 40rpx;\r\n}\r\n\r\n.qr-content {\r\n  width: 100%;\r\n  max-width: 500rpx;\r\n  background-color: #fff;\r\n  border-radius: 20rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  box-shadow: 0 10rpx 40rpx rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.qr-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 30rpx;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.qr-title {\r\n  font-size: 36rpx;\r\n  font-weight: 600;\r\n  color: #333;\r\n}\r\n\r\n.close-btn {\r\n  font-size: 40rpx;\r\n  color: #999;\r\n  font-weight: bold;\r\n  width: 60rpx;\r\n  text-align: center;\r\n}\r\n\r\n.qr-body {\r\n  padding: 40rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n.qr-code-container {\r\n  margin-bottom: 30rpx;\r\n  padding: 20rpx;\r\n  background-color: #f8f9fa;\r\n  border-radius: 15rpx;\r\n}\r\n\r\n.qr-image {\r\n  display: block;\r\n  border-radius: 10rpx;\r\n}\r\n\r\n.qr-loading {\r\n  width: 200px;\r\n  height: 200px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: #f8f9fa;\r\n  border-radius: 10rpx;\r\n}\r\n\r\n.loading-text {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n}\r\n\r\n.qr-tip {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  text-align: center;\r\n  margin-bottom: 15rpx;\r\n}\r\n\r\n.qr-amount {\r\n  font-size: 32rpx;\r\n  color: #ff4757;\r\n  font-weight: 600;\r\n  text-align: center;\r\n}\r\n\r\n.qr-status {\r\n  font-size: 24rpx;\r\n  color: #28B389;\r\n  text-align: center;\r\n  margin-top: 10rpx;\r\n  animation: pulse 1.5s infinite;\r\n}\r\n\r\n.qr-hint {\r\n  font-size: 22rpx;\r\n  color: #999;\r\n  text-align: center;\r\n  margin-top: 8rpx;\r\n  line-height: 1.4;\r\n}\r\n\r\n@keyframes pulse {\r\n  0% { opacity: 1; }\r\n  50% { opacity: 0.5; }\r\n  100% { opacity: 1; }\r\n}\r\n\r\n.qr-footer {\r\n  display: flex;\r\n  gap: 20rpx;\r\n  padding: 30rpx;\r\n  border-top: 1rpx solid #f0f0f0;\r\n}\r\n\r\n.cancel-qr-btn, .refresh-qr-btn, .success-qr-btn {\r\n  flex: 1;\r\n  height: 80rpx;\r\n  border: none;\r\n  border-radius: 40rpx;\r\n  font-size: 28rpx;\r\n  font-weight: 500;\r\n}\r\n\r\n.cancel-qr-btn {\r\n  background-color: #f5f5f5;\r\n  color: #666;\r\n}\r\n\r\n.refresh-qr-btn {\r\n  background-color: #28B389;\r\n  color: #fff;\r\n}\r\n\r\n.success-qr-btn {\r\n  background-color: #ff4757;\r\n  color: #fff;\r\n}\r\n</style>","import MiniProgramPage from 'C:/梓梅2.0/梓梅xcx/my-painting-rules-project/pages/video/payment.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","getAccount","uni","apiGetUserBalance","apiRewardVideo","apigoldpay","apiWxpay","apiCheckVideoPayment"],"mappings":"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"}