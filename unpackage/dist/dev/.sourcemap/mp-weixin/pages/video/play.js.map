{"version":3,"file":"play.js","sources":["pages/video/play.vue","D:/uniapp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdmlkZW8vcGxheS52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"wrapper\">\r\n\t\t\t<view class=\"navbar\">\r\n\t\t\t\t<!-- 返回按钮 -->\r\n\t\t\t\t<view class=\"navbar-left\" @click=\"goBack\">\r\n\t\t\t\t   <uni-icons type=\"left\" size=\"30\"></uni-icons>\r\n\t\t\t\t </view>\r\n\t\t\t\t <!-- 标题 -->\r\n\t\t\t\t <view class=\"navbar-title\">{{ videoData.title }}</view>\r\n\t\t\t</view>\r\n\t\t<!-- 视频播放器容器 -->\r\n\t\t<view class=\"video-container\">\r\n\t\t\t<video v-if=\"videoData.src\" :src=\"videoData.src\" :controls=\"isPlaying\" :autoplay=\"false\" object-fit=\"cover\" class=\"video-player\"\r\n\t\t\t\tid=\"videoPlayer\" @play=\"onVideoPlay\" @pause=\"onVideoPause\" @ended=\"onVideoEnded\"></video>\r\n\t\t\t<view v-else class=\"video-placeholder\">\r\n\t\t\t\t<text class=\"placeholder-text\">视频加载中...</text>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 播放按钮遮罩层 -->\r\n\t\t\t<view class=\"play-overlay\" v-if=\"videoData.src && showPlayButton\" @click=\"playVideo\">\r\n\t\t\t\t<view class=\"play-button\">\r\n\t\t\t\t\t<uni-icons type=\"play-filled\" size=\"60\" color=\"#fff\"></uni-icons>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 购买按钮（如果有价格） -->\r\n\t\t\t<view class=\"buy-overlay\" v-if=\"videoData.src && videoData.price && videoData.price > 0\" @click=\"handleBuyClick\">\r\n\t\t\t\t<view class=\"buy-button\">\r\n\t\t\t\t\t<text class=\"buy-text\">¥{{ videoData.price }}购买</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<!-- 表单图片显示遮罩层（独立层级） -->\r\n\t\t<view class=\"form-image-overlay\" v-if=\"showFormImage\" @click=\"closeFormImage\">\r\n\t\t\t<view class=\"form-image-container\" @click.stop>\r\n\t\t\t\t<view class=\"form-image-header\">\r\n\t\t\t\t\t<text class=\"form-image-title\">开奖号码记录</text>\r\n\t\t\t\t\t<view class=\"form-image-close\" @click=\"closeFormImage\">\r\n\t\t\t\t\t\t<uni-icons type=\"close\" size=\"24\" color=\"#666\"></uni-icons>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<image v-if=\"formImageUrl\" :src=\"formImageUrl\" class=\"form-image\" mode=\"aspectFit\" @error=\"handleFormImageError\" @load=\"handleFormImageLoad\"></image>\r\n\t\t\t\t<view v-if=\"showFormImage && !formImageUrl\" class=\"form-image-loading\">\r\n\t\t\t\t\t<text>图片加载中...</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 打赏和点赞区域 -->\r\n\t\t<view class=\"interaction-bar\">\r\n\t\t\t<view class=\"reward-interaction\" @click=\"goToRewardPage\">\r\n\t\t\t\t<uni-icons type=\"gift-filled\" size=\"20\" color=\"#FF9500\"></uni-icons>\r\n\t\t\t\t<text class=\"interaction-text\">打赏 0</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"like-interaction\" :class=\"{ 'liked': videoData.isLiked }\" @click=\"toggleLike\">\r\n\t\t\t\t<uni-icons :type=\"videoData.isLiked ? 'heart-filled' : 'heart'\" size=\"20\"\r\n\t\t\t\t\t:color=\"videoData.isLiked ? '#ff4757' : '#FF9500'\"></uni-icons>\r\n\t\t\t\t<text class=\"interaction-text\">点赞 {{ videoData.likeCount }}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 作者和视频信息 -->\r\n\t\t<view class=\"video-info-card\">\r\n\t\t<view class=\"info-header\">\r\n\t\t\t<image v-if=\"userInfo.himg || userInfo.uname\" :src=\"getAvatarUrl(userInfo.himg)\" class=\"author-avatar\"></image>\r\n\t\t\t\t<view class=\"author-info\">\r\n\t\t\t\t\t<text class=\"author-name\">{{ userInfo.uname }}出品</text>\r\n\t\t\t\t\t<text class=\"video-count\">视频</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"header-actions\">\r\n\t\t\t\t\t<button class=\"teacher-btn\">讲师主页</button>\r\n\t\t\t\t\t<button class=\"follow-btn\">+ 关注</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"video-title-section\">\r\n\t\t\t\t<view class=\"price-tag\" v-if=\"videoData.price && videoData.price > 0\">\r\n\t\t\t\t\t<text>¥{{ videoData.price }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<text class=\"video-title-text\">{{ videoData.title }}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 底部按钮 -->\r\n\t\t<view class=\"bottom-bar\">\r\n\t\t\t<view class=\"bottom-left\">\r\n\t\t\t\t<view class=\"icon-item\">\r\n\t\t\t\t\t<uni-icons type=\"home\" size=\"24\" color=\"#FFD700\"></uni-icons>\r\n\t\t\t\t\t<text class=\"icon-label\">首页</text>\r\n\t\t\t\t</view>\r\n\r\n\t\t\t</view>\r\n\t\t\t<button class=\"bottom-buy-btn\" @click=\"handleBuyClick\">\r\n\t\t\t\t{{ buttonText }}\r\n\t\t\t</button>\r\n\t\t</view>\r\n\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tcomputed,\r\n\t\tonMounted\r\n\t} from 'vue';\r\n\timport {\r\n\t\tonLoad,\r\n\t\tonShow\r\n\t} from '@dcloudio/uni-app';\r\n\timport {\r\n\t\tapiGetLikelist,\r\n\t\tapiGetIsLike,\r\n\t\tapiCheckVideoPayment,\r\n\t\tapiUserimg,\r\n\t\tapiGetVideo,\r\n\t\tapiWordQuery\r\n\t} from '@/api/apis';\r\n\timport {\r\n\t\tgetToken,\r\n\t\tgetAccount\r\n\t} from '@/utils/request.js';\r\n\timport {\r\n\t\tuseVideoStore\r\n\t} from '@/stores/video.js'\r\n\r\n\t// 初始化仓库\r\n\tconst videoStore = useVideoStore()\r\n\r\n\t// 视频数据\r\n\tconst videoData = ref({\r\n\t\tid: '',\r\n\t\ttitle: '',\r\n\t\tsrc: '',\r\n\t\taccount: '',\r\n\t\tlikeCount: 0,\r\n\t\tisLiked: false\r\n\t});\r\n\r\n\t// 添加响应式数据\r\n\tconst showPlayButton = ref(true) // 控制播放按钮显示\r\n\tconst isPlaying = ref(false) // 视频播放状态\r\n\tconst videoContext = ref(null) // 视频上下文\r\n\tconst hasPaid = ref(false) // 是否已付费\r\n\r\n\t// 计算是否为免费视频\r\n\tconst isFreeVideo = computed(() => {\r\n\t\treturn !videoData.value.flag || videoData.value.price === 0\r\n\t})\r\n\r\n\t// 计算按钮显示文本\r\n\tconst buttonText = computed(() => {\r\n\t\tif (isFreeVideo.value || hasPaid.value) {\r\n\t\t\treturn '开始学习'\r\n\t\t}\r\n\t\treturn '点击购买'\r\n\t})\r\n\t//用户头像，名字接口数据接收\r\n\tconst userInfo = ref({\r\n\t\tuname: '',\r\n\t\thimg: ''\r\n\t});\r\n\r\n\t// 表单图片相关数据\r\n\tconst showFormImage = ref(false) // 控制表单图片显示\r\n\tconst formImageUrl = ref('') // 表单图片URL\r\n\r\n\t// 获取头像的方法\r\n\tconst getAvatarUrl = (himg) => {\r\n\t\tif (!himg) return '/static/images/defaultAvatar.png'; // 如果没有头像，返回默认头像\r\n\t\treturn `http://video.caimizm.com/himg/${himg}`;\r\n\t};\r\n\r\n\t// 加载视频数据的统一方法\r\n\tconst loadVideoData = async (videoId) => {\r\n\t\tif (!videoId) return\r\n\t\t\r\n\t\ttry {\r\n\t\t\t// 优先从 store 获取\r\n\t\t\tlet currentVideo = videoStore.getCurrentVideo\r\n\t\t\t\r\n\t\t\t// 如果 store 中没有数据，尝试从本地存储恢复\r\n\t\t\tif (!currentVideo || currentVideo.id !== videoId) {\r\n\t\t\t\tconst storedVideo = uni.getStorageSync(`video_${videoId}`)\r\n\t\t\t\tif (storedVideo && storedVideo.id === videoId) {\r\n\t\t\t\t\tcurrentVideo = storedVideo\r\n\t\t\t\t\t// 恢复到 store\r\n\t\t\t\t\tvideoStore.setCurrentVideo(currentVideo)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 如果仍然没有数据，尝试通过 API 获取\r\n\t\t\tif (!currentVideo || currentVideo.id !== videoId) {\r\n\t\t\t\tuni.showLoading({ title: '加载中...' })\r\n\t\t\t\tconst response = await apiGetVideo({ id: videoId, limit: 1 })\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\r\n\t\t\t\tif (response.code === 200 && response.data && response.data.records && response.data.records.length > 0) {\r\n\t\t\t\t\tconst item = response.data.records[0]\r\n\t\t\t\t\tcurrentVideo = {\r\n\t\t\t\t\t\tid: item.id,\r\n\t\t\t\t\t\ttitle: item.title,\r\n\t\t\t\t\t\tsrc: `http://video.caimizm.com/${item.url}`,\r\n\t\t\t\t\t\taccount: item.account,\r\n\t\t\t\t\t\tlikeCount: item.likeCount || 0,\r\n\t\t\t\t\t\tisLiked: item.isLiked || false,\r\n\t\t\t\t\t\tflag: item.price > 0 ? item.flag : false,\r\n\t\t\t\t\t\tprice: item.price,\r\n\t\t\t\t\t\timgurl: `http://video.caimizm.com/${item.vimg}`\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 保存到 store 和本地存储\r\n\t\t\t\t\tvideoStore.setCurrentVideo(currentVideo)\r\n\t\t\t\t\tuni.setStorageSync(`video_${videoId}`, currentVideo)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '视频不存在',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// 使用获取到的视频数据\r\n\t\t\tif (currentVideo && currentVideo.id === videoId) {\r\n\t\t\t\tvideoData.value = {\r\n\t\t\t\t\tid: currentVideo.id,\r\n\t\t\t\t\ttitle: currentVideo.title,\r\n\t\t\t\t\tsrc: currentVideo.src,\r\n\t\t\t\t\taccount: currentVideo.account,\r\n\t\t\t\t\tlikeCount: currentVideo.likeCount || 0,\r\n\t\t\t\t\tisLiked: currentVideo.isLiked || false,\r\n\t\t\t\t\tflag: currentVideo.flag,\r\n\t\t\t\t\tprice: currentVideo.price,\r\n\t\t\t\t}\r\n\t\t\t\t// 调用apiUserimg获取用户信息\r\n\t\t\t\tif (currentVideo.account) {\r\n\t\t\t\t\tawait getUserInfo(currentVideo.account)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 初始化视频上下文（如果视频数据已加载）\r\n\t\t\t\tif (videoData.value.src && !videoContext.value) {\r\n\t\t\t\t\tvideoContext.value = uni.createVideoContext('videoPlayer')\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 检查付费状态（仅对付费视频）\r\n\t\t\t\tif (!isFreeVideo.value) {\r\n\t\t\t\t\tawait checkPaymentStatus()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tuni.hideLoading()\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '加载视频失败',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t\r\n\t// 检查付费状态\r\n\tconst checkPaymentStatus = async () => {\r\n\t\t// 如果是免费视频，不需要检查\r\n\t\tif (isFreeVideo.value) {\r\n\t\t\thasPaid.value = false\r\n\t\t\treturn\r\n\t\t}\r\n\t\t\r\n\t\t// 检查是否登录\r\n\t\tconst token = getToken()\r\n\t\tif (!token) {\r\n\t\t\thasPaid.value = false\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst paymentCheck = await apiCheckVideoPayment({\r\n\t\t\t\tvideoId: videoData.value.id,\r\n\t\t\t\taccount: getAccount()\r\n\t\t\t})\r\n\r\n\t\t\tif (paymentCheck.data) {\r\n\t\t\t\thasPaid.value = true\r\n\t\t\t} else {\r\n\t\t\t\thasPaid.value = false\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\thasPaid.value = false\r\n\t\t}\r\n\t}\r\n\r\n\t// 获取路由参数\r\n\tonLoad(async (options) => {\r\n\t\tif (options.id) {\r\n\t\t\tawait loadVideoData(options.id)\r\n\t\t}\r\n\t})\r\n\t\r\n\t// 页面显示时重新加载数据（刷新时触发）\r\n\tonShow(async () => {\r\n\t\t// 重置表单图片状态\r\n\t\tshowFormImage.value = false\r\n\t\tformImageUrl.value = ''\r\n\t\t\r\n\t\t// 如果 videoData 中没有 id，尝试从 store 或 URL 参数获取\r\n\t\tif (!videoData.value.id) {\r\n\t\t\tconst pages = getCurrentPages()\r\n\t\t\tconst currentPage = pages[pages.length - 1]\r\n\t\t\tconst options = currentPage.options || {}\r\n\t\t\tif (options.id) {\r\n\t\t\t\tawait loadVideoData(options.id)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// 重新加载当前视频数据\r\n\t\t\tawait loadVideoData(videoData.value.id)\r\n\t\t}\r\n\t\t\r\n\t\t// 重新检查付费状态\r\n\t\tif (videoData.value.id && !isFreeVideo.value) {\r\n\t\t\tawait checkPaymentStatus()\r\n\t\t}\r\n\t})\r\n\r\n\t// 在onMounted中初始化视频上下文\r\n\tonMounted(() => {\r\n\t\t// 延迟初始化，确保视频元素已渲染\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (videoData.value.src && !videoContext.value) {\r\n\t\t\t\tvideoContext.value = uni.createVideoContext('videoPlayer')\r\n\t\t\t}\r\n\t\t}, 100)\r\n\t})\r\n\r\n\t//导航栏\r\n\tconst goBack = () => {\r\n\t\tuni.navigateBack({\r\n\t\t\tdelta: 1\r\n\t\t});\r\n\t};\r\n\r\n\t// 获取用户信息\r\n\tconst getUserInfo = async (account) => {\r\n\t\ttry {\r\n\t\t\t// 准备请求参数\r\n\t\t\tconst params = {\r\n\t\t\t\taccount: account\r\n\t\t\t};\r\n\r\n\t\t\tconst headers = {};\r\n\t\t\tconst token = getToken();\r\n\t\t\tif (token) {\r\n\t\t\t\theaders['Authorization'] = token;\r\n\t\t\t}\r\n\r\n\t\t\t// 调用apiUserimg接口\r\n\t\t\tconst response = await apiUserimg(params, headers);\r\n\r\n\t\t\tif (response.code === 200) {\r\n\t\t\t\t// 更新用户信息\r\n\t\t\t\tuserInfo.value = {\r\n\t\t\t\t\tuname: response.data.uname,\r\n\t\t\t\t\thimg: response.data.himg\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\t// 使用默认信息\r\n\t\t\t\tuserInfo.value = {\r\n\t\t\t\t\tuname: account,\r\n\t\t\t\t\thimg: ''\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\t// 使用默认信息\r\n\t\t\tuserInfo.value = {\r\n\t\t\t\tuname: account,\r\n\t\t\t\thimg: ''\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\r\n\t// 播放视频方法\r\n\tconst playVideo = async () => {\r\n\t\t// 检查是否登录\r\n\t\tconst token = getToken();\r\n\t\tif (!token) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请先登录',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t});\r\n\t\t\t}, 1500);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// 免费视频或已付费视频，直接播放\r\n\t\tif (isFreeVideo.value || hasPaid.value) {\r\n\t\t\tif (!videoContext.value && videoData.value.src) {\r\n\t\t\t\tvideoContext.value = uni.createVideoContext('videoPlayer')\r\n\t\t\t}\r\n\t\t\tif (videoContext.value) {\r\n\t\t\t\tvideoContext.value.play()\r\n\t\t\t\tisPlaying.value = true\r\n\t\t\t\tshowPlayButton.value = false\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// 付费视频且未付费，需要检查或支付\r\n\t\t// 如果 hasPaid 还未确定，先检查一次\r\n\t\tif (!hasPaid.value) {\r\n\t\t\tawait checkPaymentStatus()\r\n\t\t\t// 如果检查后发现已付费，直接播放\r\n\t\t\tif (hasPaid.value) {\r\n\t\t\t\tif (!videoContext.value && videoData.value.src) {\r\n\t\t\t\t\tvideoContext.value = uni.createVideoContext('videoPlayer')\r\n\t\t\t\t}\r\n\t\t\t\tif (videoContext.value) {\r\n\t\t\t\t\tvideoContext.value.play()\r\n\t\t\t\t\tisPlaying.value = true\r\n\t\t\t\t\tshowPlayButton.value = false\r\n\t\t\t\t}\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// 用户未付费，显示付费提示\r\n\t\tuni.showModal({\r\n\t\t\ttitle: '付费视频',\r\n\t\t\tcontent: `观看此视频需要支付${videoData.value.price}金币`,\r\n\t\t\tconfirmText: '立即支付',\r\n\t\t\tcancelText: '取消',\r\n\t\t\tsuccess: async (res) => {\r\n\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t// 跳转到支付页面\r\n\t\t\t\t\tawait payForVideo();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst payForVideo = async () => {\r\n\t\t// 准备支付数据\r\n\t\tconst paymentData = {\r\n\t\t\tinfo: `视频: ${videoData.value.title}`,\r\n\t\t\tamount: videoData.value.price,\r\n\t\t\ttype: 3, // 视频付费类型\r\n\t\t\taccount: getAccount(),\r\n\t\t\tpayType: 0, // 默认微信支付\r\n\t\t\tchannel: 0, // 微信小程序\r\n\t\t\tvideoId: videoData.value.id // 添加视频ID参数\r\n\t\t};\r\n\r\n\t\t// 跳转到支付页面\r\n\t\tuni.navigateTo({\r\n\t\t\turl: `/pages/video/payment?${objectToQueryString(paymentData)}`\r\n\t\t});\r\n\t};\r\n\r\n\t// 将对象转换为查询字符串\r\n\tconst objectToQueryString = (obj) => {\r\n\t\treturn Object.keys(obj).map(key => {\r\n\t\t\treturn `${encodeURIComponent(key)}=${encodeURIComponent(obj[key])}`;\r\n\t\t}).join('&');\r\n\t};\r\n\r\n\t// 视频开始播放事件\r\n\tconst onVideoPlay = () => {\r\n\t\tisPlaying.value = true\r\n\t\tshowPlayButton.value = false\r\n\t}\r\n\r\n\t// 视频暂停事件\r\n\tconst onVideoPause = () => {\r\n\t\tisPlaying.value = false\r\n\t\tshowPlayButton.value = true\r\n\t}\r\n\r\n\t// 视频播放结束事件\r\n\tconst onVideoEnded = async () => {\r\n\t\tconsole.log('视频播放结束，开始获取表单图片')\r\n\t\tisPlaying.value = false\r\n\t\tshowPlayButton.value = false\r\n\t\t\r\n\t\t// 获取表单图片\r\n\t\tawait fetchFormImage()\r\n\t\t\r\n\t\t// 检查最终状态\r\n\t\tconsole.log('获取表单图片完成，showFormImage:', showFormImage.value, 'formImageUrl:', formImageUrl.value)\r\n\t}\r\n\r\n\t// 获取表单图片\r\n\tconst fetchFormImage = async () => {\r\n\t\tif (!videoData.value.id) {\r\n\t\t\tconsole.log('获取表单图片失败：视频ID为空')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst videoId = videoData.value.id\r\n\t\t\r\n\t\t// 首先尝试从本地存储获取\r\n\t\tlet hasLocalImage = false\r\n\t\ttry {\r\n\t\t\tconst storageKey = `formImage_${videoId}`\r\n\t\t\tconsole.log('检查本地存储，key:', storageKey)\r\n\t\t\tconst storedFormImage = uni.getStorageSync(storageKey)\r\n\t\t\tconsole.log('本地存储数据:', storedFormImage)\r\n\t\t\t\r\n\t\t\tif (storedFormImage && storedFormImage.wimgUrl) {\r\n\t\t\t\tconsole.log('从本地存储获取表单图片:', storedFormImage.wimgUrl)\r\n\t\t\t\tformImageUrl.value = storedFormImage.wimgUrl\r\n\t\t\t\tshowFormImage.value = true\r\n\t\t\t\thasLocalImage = true\r\n\t\t\t\tconsole.log('表单图片已从本地存储设置, formImageUrl:', formImageUrl.value, 'showFormImage:', showFormImage.value)\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('本地存储中没有表单图片数据')\r\n\t\t\t\t// 尝试检查所有相关的本地存储\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst allKeys = uni.getStorageInfoSync().keys\r\n\t\t\t\t\tconsole.log('所有本地存储keys:', allKeys)\r\n\t\t\t\t\tconst relatedKeys = allKeys.filter(key => key.includes('formImage') || key.includes('wimg'))\r\n\t\t\t\t\tconsole.log('相关的本地存储keys:', relatedKeys)\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.log('无法获取本地存储keys:', e)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('本地存储获取失败:', e)\r\n\t\t}\r\n\r\n\t\t// 尝试从 API 获取最新数据（后台更新）\r\n\t\t// 如果在 H5 环境且本地存储已有数据，跳过 API 调用以避免 CORS 错误\r\n\t\tlet shouldSkipApi = false\r\n\t\t// #ifdef H5\r\n\t\tif (hasLocalImage) {\r\n\t\t\tconsole.log('H5环境且有本地图片，跳过API调用以避免CORS错误')\r\n\t\t\tshouldSkipApi = true\r\n\t\t}\r\n\t\t// #endif\r\n\t\t\r\n\t\tif (!shouldSkipApi) {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('开始获取表单图片，视频ID:', videoId)\r\n\t\t\t\tconst response = await apiWordQuery({ videoId: videoId })\r\n\t\t\t\tconsole.log('表单图片API响应:', response)\r\n\t\t\t\t\r\n\t\t\t\tif (response && response.code === 200 && response.data) {\r\n\t\t\t\t\t// 尝试多种可能的数据结构\r\n\t\t\t\t\tlet imageUrl = response.data.wimg || response.data.url || response.data.image || response.data.img || ''\r\n\t\t\t\t\tconsole.log('解析到的图片URL:', imageUrl)\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (imageUrl) {\r\n\t\t\t\t\t\t// 处理图片 URL：如果是完整 URL 直接使用，否则拼接完整路径\r\n\t\t\t\t\t\tif (!imageUrl.startsWith('http')) {\r\n\t\t\t\t\t\t\t// 如果不是完整 URL，拼接为完整路径（wimg 文件夹）\r\n\t\t\t\t\t\t\timageUrl = `http://video.caimizm.com/wimg/${imageUrl}`\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconsole.log('处理后的图片URL:', imageUrl)\r\n\t\t\t\t\t\tformImageUrl.value = imageUrl\r\n\t\t\t\t\t\tshowFormImage.value = true\r\n\t\t\t\t\t\tconsole.log('表单图片已从API设置，showFormImage:', showFormImage.value)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('未找到图片URL，响应数据:', response.data)\r\n\t\t\t\t\t\t// 如果API没有图片，但本地存储有，继续显示本地的\r\n\t\t\t\t\t\tif (!hasLocalImage) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '暂无表单记录',\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('API响应异常:', response)\r\n\t\t\t\t\tif (response && response.code !== 200) {\r\n\t\t\t\t\t\tconsole.log('API返回错误码:', response.code, '错误信息:', response.message || response.msg)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// API 返回异常，但本地存储有数据，继续显示本地的\r\n\t\t\t\t\tif (!hasLocalImage) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '暂无表单记录',\r\n\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('获取表单图片异常:', error)\r\n\t\t\t\t// 检测是否为 CORS 错误（H5 环境）\r\n\t\t\t\tconst errorMessage = error.message || error.errMsg || ''\r\n\t\t\t\tconst isCorsError = errorMessage.includes('CORS') || errorMessage.includes('Access-Control') || errorMessage.includes('ERR_FAILED') || errorMessage.includes('net::ERR_FAILED')\r\n\t\t\t\t\r\n\t\t\t\t// 如果本地存储有数据，不需要显示错误提示\r\n\t\t\t\tif (hasLocalImage) {\r\n\t\t\t\t\tconsole.log('API调用失败，但本地存储有数据，继续显示本地图片')\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 如果本地存储也没有数据，显示错误提示\r\n\t\t\t\tif (isCorsError) {\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: 'H5环境请在小程序中查看',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '获取表单图片失败',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 其他错误显示提示\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '获取表单图片失败',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 2000\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// 关闭表单图片\r\n\tconst closeFormImage = () => {\r\n\t\tshowFormImage.value = false\r\n\t\tshowPlayButton.value = true\r\n\t}\r\n\r\n\t// 处理表单图片加载错误\r\n\tconst handleFormImageError = (e) => {\r\n\t\tconsole.error('表单图片加载失败:', e)\r\n\t\tconsole.error('图片URL:', formImageUrl.value)\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '图片加载失败',\r\n\t\t\ticon: 'none',\r\n\t\t\tduration: 2000\r\n\t\t})\r\n\t}\r\n\r\n\t// 处理表单图片加载成功\r\n\tconst handleFormImageLoad = (e) => {\r\n\t\tconsole.log('表单图片加载成功:', formImageUrl.value)\r\n\t}\r\n\r\n\t// 处理购买按钮点击\r\n\tconst handleBuyClick = async () => {\r\n\t\t// 免费视频或已付费视频，直接播放\r\n\t\tif (isFreeVideo.value || hasPaid.value) {\r\n\t\t\tif (!videoContext.value && videoData.value.src) {\r\n\t\t\t\tvideoContext.value = uni.createVideoContext('videoPlayer')\r\n\t\t\t}\r\n\t\t\tif (videoContext.value) {\r\n\t\t\t\tvideoContext.value.play()\r\n\t\t\t\tisPlaying.value = true\r\n\t\t\t\tshowPlayButton.value = false\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// 付费视频且未付费，跳转到支付\r\n\t\t\tawait payForVideo()\r\n\t\t}\r\n\t}\r\n\r\n\t// 跳转到打赏页面\r\n\tconst goToRewardPage = () => {\r\n\t\t// 检查登录状态\r\n\t\tconst token = getToken();\r\n\t\tif (!token) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请先登录',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t});\r\n\t\t\t}, 1500);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 跳转到打赏页面，传递视频信息\r\n\t\tuni.navigateTo({\r\n\t\t\turl: `/pages/video/reward?videoId=${videoData.value.id}&author=${encodeURIComponent(videoData.value.account)}&title=${encodeURIComponent(videoData.value.title)}&authorAvatar=${encodeURIComponent(userInfo.value.himg)}&authorName=${encodeURIComponent(userInfo.value.uname)}`\r\n\t\t});\r\n\t};\r\n\r\n\t// 点赞功能\r\n\tconst toggleLike = async () => {\r\n\t\ttry {\r\n\t\t\t// 保存原始状态，以便在请求失败时恢复\r\n\t\t\tconst originalIsLiked = videoData.value.isLiked;\r\n\t\t\tconst originalLikeCount = videoData.value.likeCount;\r\n\r\n\t\t\t// 立即更新UI，提供更好的用户体验\r\n\t\t\tvideoData.value.isLiked = !videoData.value.isLiked;\r\n\t\t\tvideoData.value.likeCount = videoData.value.isLiked ?\r\n\t\t\t\tvideoData.value.likeCount + 1 :\r\n\t\t\t\tvideoData.value.likeCount - 1;\r\n\r\n\t\t\t// 调用点赞API\r\n\t\t\tconst response = await apiGetIsLike({\r\n\t\t\t\tid: videoData.value.id,\r\n\t\t\t\taccount: getAccount(),\r\n\t\t\t\tisLiked: videoData.value.isLiked\r\n\t\t\t});\r\n\r\n\t\t\t// 获取点赞列表（可选）\r\n\t\t\tconst likeList = await apiGetLikelist(getAccount());\r\n\t\t} catch (error) {\r\n\t\t\t// 恢复原始状态\r\n\t\t\tvideoData.value.isLiked = originalIsLiked;\r\n\t\t\tvideoData.value.likeCount = originalLikeCount;\r\n\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '操作失败，请重试',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.wrapper {\r\n\t\tmin-height: 100vh;\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\r\n\t.navbar {\r\n\t\theight: 44px;\r\n\t\tbackground-color: #1677ff;\r\n\t\tcolor: white;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t\tpadding: 0 16px;\r\n\t\tmargin-bottom: 3rpx;\r\n\t\tposition: relative;\r\n\t\tz-index: 10;\r\n\t}\r\n\r\n\t.navbar-left {\r\n\t\twidth: 44px;\r\n\t\theight: 44px;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: flex-start;\r\n\t\tz-index: 11;\r\n\t}\r\n\r\n\t.navbar-left .uni-icons {\r\n\t\tcolor: #fff !important;\r\n\t\tfont-size: 22px !important;\r\n\t}\r\n\r\n\t.navbar-title {\r\n\t\tfont-size: 18px;\r\n\t\tfont-weight: 500;\r\n\t\ttext-align: center;\r\n\t\tposition: absolute;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\t.container {\r\n\t\tpadding: 20rpx;\r\n\t\tpadding-bottom: 120rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\r\n\t/* 视频容器样式 */\r\n\t.video-container {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\theight: 600rpx;\r\n\t\tborder-radius: 0;\r\n\t\toverflow: hidden;\r\n\t\tbackground-color: #000;\r\n\t}\r\n\r\n\t.video-player {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t/* 播放按钮遮罩层 */\r\n\t.play-overlay {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.3);\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tz-index: 10;\r\n\t}\r\n\r\n\t.play-button {\r\n\t\twidth: 80rpx;\r\n\t\theight: 80rpx;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\t\tborder-radius: 50%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\ttransition: transform 0.3s ease;\r\n\t}\r\n\r\n\t.play-button:active {\r\n\t\ttransform: scale(0.9);\r\n\t}\r\n\r\n\t/* 购买按钮遮罩 */\r\n\t.buy-overlay {\r\n\t\tposition: absolute;\r\n\t\tbottom: 30rpx;\r\n\t\tright: 30rpx;\r\n\t\tz-index: 11;\r\n\t}\r\n\r\n\t.buy-button {\r\n\t\tbackground-color: #FF9500;\r\n\t\tpadding: 12rpx 24rpx;\r\n\t\tborder-radius: 8rpx;\r\n\t}\r\n\r\n\t.buy-text {\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 26rpx;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t/* 打赏和点赞交互栏 */\r\n\t.interaction-bar {\r\n\t\tdisplay: flex;\r\n\t\tpadding: 20rpx 0;\r\n\t\tbackground-color: #fff;\r\n\t\tgap: 40rpx;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.reward-interaction,\r\n\t.like-interaction {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tgap: 8rpx;\r\n\t}\r\n\r\n\t.interaction-text {\r\n\t\tcolor: #FF9500;\r\n\t\tfont-size: 26rpx;\r\n\t}\r\n\r\n\t.like-interaction.liked .interaction-text {\r\n\t\tcolor: #ff4757;\r\n\t}\r\n\r\n\t/* 视频信息卡片 */\r\n\t.video-info-card {\r\n\t\tbackground-color: #fff;\r\n\t\tpadding: 30rpx;\r\n\t}\r\n\r\n\t.info-header {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 30rpx;\r\n\t}\r\n\r\n\t.author-avatar {\r\n\t\twidth: 60rpx;\r\n\t\theight: 60rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\r\n\t.author-info {\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.author-name {\r\n\t\tfont-size: 28rpx;\r\n\t\tfont-weight: 600;\r\n\t\tcolor: #333;\r\n\t\tdisplay: block;\r\n\t}\r\n\r\n\t.video-count {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.header-actions {\r\n\t\tdisplay: flex;\r\n\t\tgap: 20rpx;\r\n\t}\r\n\r\n\t.teacher-btn,\r\n\t.follow-btn {\r\n\t\tpadding: 8rpx 16rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tborder-radius: 8rpx;\r\n\t}\r\n\r\n\t.teacher-btn {\r\n\t\tbackground-color: transparent;\r\n\t\tborder: 1rpx solid #FF9500;\r\n\t\tcolor: #FF9500;\r\n\t}\r\n\r\n\t.follow-btn {\r\n\t\tbackground-color: #FF9500;\r\n\t\tcolor: #fff;\r\n\t\tborder: none;\r\n\t}\r\n\r\n\t/* 视频标题区域 */\r\n\t.video-title-section {\r\n\t\tdisplay: flex;\r\n\t\talign-items: flex-start;\r\n\t\tgap: 20rpx;\r\n\t}\r\n\r\n\t.price-tag {\r\n\t\tbackground-color: #ff4757;\r\n\t\tpadding: 6rpx 12rpx;\r\n\t\tborder-radius: 4rpx;\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 24rpx;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t.video-title-text {\r\n\t\tflex: 1;\r\n\t\tfont-size: 30rpx;\r\n\t\tfont-weight: 600;\r\n\t\tcolor: #333;\r\n\t\tline-height: 1.5;\r\n\t}\r\n\r\n\t/* 底部购买栏 */\r\n\t.bottom-bar {\r\n\t\tposition: fixed;\r\n\t\tbottom: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tdisplay: flex;\r\n\t\tbackground-color: #fff;\r\n\t\tpadding: 20rpx;\r\n\t\tbox-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t.bottom-left {\r\n\t\tdisplay: flex;\r\n\t\tgap: 40rpx;\r\n\t}\r\n\r\n\t.icon-item {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tgap: 4rpx;\r\n\t}\r\n\r\n\t.icon-label {\r\n\t\tfont-size: 20rpx;\r\n\t\tcolor: #666;\r\n\t}\r\n\r\n\t.bottom-buy-btn {\r\n\t\tflex: 1;\r\n\t\tbackground-color: #FF9500;\r\n\t\tcolor: #fff;\r\n\t\tborder: none;\r\n\t\tborder-radius: 50rpx;\r\n\t\tfont-size: 32rpx;\r\n\t\tfont-weight: 600;\r\n\t\tmargin-left: 40rpx;\r\n\t}\r\n\r\n\t/* 视频加载占位符 */\r\n\t.video-placeholder {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tbackground-color: #000;\r\n\t}\r\n\r\n\t.placeholder-text {\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\r\n\t/* 表单图片显示 */\r\n\t.form-image-overlay {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tbottom: 0;\r\n\t\tbackground-color: rgba(0, 0, 0, 0.8);\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tz-index: 9999;\r\n\t}\r\n\r\n\t.form-image-container {\r\n\t\twidth: 90%;\r\n\t\tmax-width: 600rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 20rpx;\r\n\t\toverflow: hidden;\r\n\t\tmax-height: 80vh;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\r\n\t.form-image-header {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t\tpadding: 30rpx;\r\n\t\tborder-bottom: 1rpx solid #f0f0f0;\r\n\t}\r\n\r\n\t.form-image-title {\r\n\t\tfont-size: 32rpx;\r\n\t\tfont-weight: 600;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.form-image-close {\r\n\t\twidth: 48rpx;\r\n\t\theight: 48rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.form-image {\r\n\t\twidth: 100%;\r\n\t\tmax-height: 70vh;\r\n\t}\r\n\r\n\t.form-image-loading {\r\n\t\tpadding: 60rpx;\r\n\t\ttext-align: center;\r\n\t\tcolor: #666;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n</style>","import MiniProgramPage from 'C:/Users/Administrator/Desktop/caimixcx/pages/video/play.vue'\nwx.createPage(MiniProgramPage)"],"names":["useVideoStore","ref","computed","uni","apiGetVideo","getToken","apiCheckVideoPayment","getAccount","onLoad","onShow","onMounted","apiUserimg","apiWordQuery","originalIsLiked","originalLikeCount","apiGetIsLike","apiGetLikelist"],"mappings":"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"}