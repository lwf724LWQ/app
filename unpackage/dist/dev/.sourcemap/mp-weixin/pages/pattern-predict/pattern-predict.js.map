{"version":3,"file":"pattern-predict.js","sources":["pages/pattern-predict/pattern-predict.vue","D:/uniapp/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcGF0dGVybi1wcmVkaWN0L3BhdHRlcm4tcHJlZGljdC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"pattern-predict-container\">\r\n    <!-- 导航栏 -->\r\n    <view class=\"nav-bar\">\r\n      <view class=\"nav-left\" @click=\"goBack\">\r\n        <uni-icons type=\"left\" size=\"20\" color=\"#333\"></uni-icons>\r\n      </view>\r\n      <view class=\"nav-title\">规律预测</view>\r\n      <view class=\"nav-right\"></view>\r\n    </view>\r\n    \r\n    <!-- 主要内容 -->\r\n    <view class=\"main-content\">\r\n      <!-- 我的方案区域 -->\r\n      <view class=\"scheme-section\">\r\n        <view class=\"section-title\">我的方案 (必选)</view>\r\n        <view class=\"scheme-input\" @click=\"goToSchemePage\">\r\n          <view class=\"issue-info\">\r\n            <text class=\"issue-number\">第{{ issueNumber }}期</text>\r\n          </view>\r\n          <!-- 显示已设置的方案 -->\r\n          <view v-if=\"schemes.length > 0\" class=\"scheme-display\">\r\n            <view class=\"scheme-content\">\r\n              <!-- 期号显示 -->\r\n              <text class=\"issue-number\">第{{ issueNumber }}期</text>\r\n              \r\n              <!-- 方案详情 -->\r\n              <view \r\n                v-for=\"(scheme, index) in schemes\" \r\n                :key=\"index\" \r\n                class=\"scheme-item\"\r\n              >\r\n                <text class=\"scheme-name\">[{{ scheme.id }}]</text>\r\n                <view class=\"scheme-details\">\r\n                  <text \r\n                    v-for=\"(detail, detailIndex) in getSchemeDisplayData(scheme)\" \r\n                    :key=\"detailIndex\" \r\n                    class=\"scheme-detail\"\r\n                  >\r\n                    {{ detail }}\r\n                  </text>\r\n                </view>\r\n              </view>\r\n            </view>\r\n          </view>\r\n          <!-- 未设置方案时的提示 -->\r\n          <view v-else class=\"scheme-placeholder\">\r\n            <text class=\"placeholder-text\">还没有添加方案噢,点击可添加方案 ></text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      \r\n      <!-- 添加规律图片区域 -->\r\n      <view class=\"image-section\">\r\n        <view class=\"section-title\">添加规律图片 (必选，最多6张)</view>\r\n        <view class=\"image-upload-container\">\r\n          <!-- 已选择的图片 -->\r\n          <view v-if=\"selectedImages.length > 0\" class=\"selected-images\">\r\n            <view \r\n              v-for=\"(image, index) in selectedImages\" \r\n              :key=\"index\" \r\n              class=\"image-item\"\r\n            >\r\n              <image :src=\"image\" class=\"uploaded-image\" mode=\"aspectFit\"></image>\r\n              <view class=\"image-delete\" @click=\"removeImage(index)\">\r\n                <uni-icons type=\"close\" size=\"16\" color=\"#fff\"></uni-icons>\r\n              </view>\r\n            </view>\r\n          </view>\r\n          \r\n          <!-- 添加图片按钮 -->\r\n          <view \r\n            v-if=\"selectedImages.length < 6\" \r\n            class=\"add-image-btn\" \r\n            @click=\"selectImage\"\r\n          >\r\n            <uni-icons type=\"camera\" size=\"40\" color=\"#ccc\"></uni-icons>\r\n            <text class=\"add-text\">添加图片</text>\r\n            <text class=\"count-text\">{{ selectedImages.length }}/6</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      \r\n      <!-- 免责声明 -->\r\n      <view class=\"disclaimer\">\r\n        <text class=\"disclaimer-text\">注: 帖子一旦发布, 将不能进行修改或删除操作</text>\r\n      </view>\r\n      \r\n      <!-- 底部按钮区域 -->\r\n      <view class=\"bottom-buttons\">\r\n        <button class=\"modify-btn\" @click=\"goToSchemePage\">修改</button>\r\n        <button class=\"publish-btn\" :class=\"{ disabled: !canPublish }\" @click=\"handlePublish\">\r\n          发布\r\n        </button>\r\n      </view>\r\n      \r\n      \r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { onShow } from '@dcloudio/uni-app'\r\nimport { apiGetIssueNo, apiPost, getCOSSecretKey } from '@/api/apis.js'\r\nimport { getAccount } from '@/utils/request.js'\r\n\r\n// 响应式数据\r\nconst issueNumber = ref('')\r\nconst selectedImages = ref([]) // 改为数组支持多张图片\r\nconst schemes = ref([])\r\nconst lotteryType = ref(null)\r\nconst uploadedImageUrls = ref([]) // 改为数组存储多张图片URL\r\nconst isUploadingImage = ref(false)\r\n// 请求锁 - 防止重复请求\r\nconst isLoadingIssueInfo = ref(false)\r\n\r\n// 计算属性\r\nconst canPublish = computed(() => {\r\n  return schemes.value.length > 0 && selectedImages.value.length > 0\r\n})\r\n\r\n// 页面加载时获取期号\r\nonMounted(() => {\r\n  loadIssueInfo()\r\n  loadSchemesFromStorage()\r\n})\r\n\r\n// 页面显示时重新加载方案数据\r\nonShow(() => {\r\n  loadSchemesFromStorage()\r\n})\r\n\r\n// OSS上传函数，和edit-profile.vue相同的方法\r\nconst uploadObject = async (file, callback) => {\r\n  try {\r\n    let fileName = file.name || ''\r\n    const origin_file_name = fileName.split(\".\").slice(0, fileName.split(\".\").length - 1).join('.') // 获取文件名\r\n    \r\n    // 获取当前时间戳\r\n    const upload_file_name = new Date().getTime() + '.' + fileName.split(\".\")[fileName.split(\".\").length - 1]\r\n    \r\n    // 请求接口得到token\r\n    let res = await getCOSSecretKey({})\r\n    \r\n    if (res.code !== 200) {\r\n      throw new Error('获取上传凭证失败')\r\n    }\r\n    \r\n    // 动态导入ali-oss\r\n    const OSS = await import('ali-oss')\r\n    \r\n    // 根据STS接口实际返回的数据结构创建OSS客户端\r\n    const ossConfig = {\r\n      region: res.data.region || 'cn-guangzhou',\r\n      accessKeyId: res.data.STSaccessKeyId,\r\n      accessKeySecret: res.data.STSsecretAccessKey,\r\n      stsToken: res.data.security_token,\r\n      bucket: res.data.bucket || 'cjvd',\r\n      // 使用正确的endpoint\r\n      endpoint: 'https://oss-cn-guangzhou.aliyuncs.com',\r\n      // 添加STS token刷新机制\r\n      refreshSTSToken: async () => {\r\n        const newRes = await getCOSSecretKey({})\r\n        return {\r\n          accessKeyId: newRes.data.STSaccessKeyId,\r\n          accessKeySecret: newRes.data.STSsecretAccessKey,\r\n          stsToken: newRes.data.security_token\r\n        }\r\n      },\r\n      refreshSTSTokenInterval: 300000 // 5分钟刷新一次\r\n    }\r\n    \r\n    const client = new OSS.default(ossConfig)\r\n    \r\n    // 上传文件\r\n    const result = await client.put(`pimg/${upload_file_name}`, file)\r\n    \r\n    if (result && result.url) {\r\n      // 直接使用固定的自定义域名前缀 + 唯一文件名（改用 pimg）\r\n      const customUrl = `http://video.caimizm.com/pimg/${upload_file_name}`\r\n      \r\n      callback(customUrl)\r\n    } else {\r\n      throw new Error('上传失败')\r\n    }\r\n    \r\n  } catch (error) {\r\n    throw error\r\n  }\r\n}\r\n\r\n// 获取分行显示的方案数据\r\nconst getSchemeDisplayData = (scheme) => {\r\n  const data = scheme.data\r\n  const result = []\r\n  \r\n  if (scheme.id === '二字现' || scheme.id === '三字现') {\r\n    // 组合类方案\r\n    if (data.combinations && data.combinations.length > 0) {\r\n      result.push(`组合: ${data.combinations.join(',')}`)\r\n    } else {\r\n      result.push('组合: 未选择')\r\n    }\r\n  } else {\r\n    // 数字类方案 - 按照图片格式显示\r\n    if (data.thousands && data.thousands.length > 0) {\r\n      let thousandsInfo = `千位: ${data.thousands.join('')}`\r\n      if (data.thousandsMainAttack && data.thousandsMainAttack.length > 0) {\r\n        thousandsInfo += ` 主攻${data.thousandsMainAttack.join('')}`\r\n      }\r\n      if (data.thousandsKeyPoint && data.thousandsKeyPoint.length > 0) {\r\n        thousandsInfo += ` 重点${data.thousandsKeyPoint.join('')}`\r\n      }\r\n      result.push(thousandsInfo)\r\n    }\r\n    \r\n    if (data.hundreds && data.hundreds.length > 0) {\r\n      let hundredsInfo = `百位: ${data.hundreds.join('')}`\r\n      if (data.hundredsMainAttack && data.hundredsMainAttack.length > 0) {\r\n        hundredsInfo += ` 主攻${data.hundredsMainAttack.join('')}`\r\n      }\r\n      if (data.hundredsKeyPoint && data.hundredsKeyPoint.length > 0) {\r\n        hundredsInfo += ` 重点${data.hundredsKeyPoint.join('')}`\r\n      }\r\n      result.push(hundredsInfo)\r\n    }\r\n    \r\n    if (data.tens && data.tens.length > 0) {\r\n      let tensInfo = `十位: ${data.tens.join('')}`\r\n      if (data.tensMainAttack && data.tensMainAttack.length > 0) {\r\n        tensInfo += ` 主攻${data.tensMainAttack.join('')}`\r\n      }\r\n      if (data.tensKeyPoint && data.tensKeyPoint.length > 0) {\r\n        tensInfo += ` 重点${data.tensKeyPoint.join('')}`\r\n      }\r\n      result.push(tensInfo)\r\n    }\r\n    \r\n    if (data.units && data.units.length > 0) {\r\n      let unitsInfo = `个位: ${data.units.join('')}`\r\n      if (data.unitsMainAttack && data.unitsMainAttack.length > 0) {\r\n        unitsInfo += ` 主攻${data.unitsMainAttack.join('')}`\r\n      }\r\n      if (data.unitsKeyPoint && data.unitsKeyPoint.length > 0) {\r\n        unitsInfo += ` 重点${data.unitsKeyPoint.join('')}`\r\n      }\r\n      result.push(unitsInfo)\r\n    }\r\n    \r\n    if (result.length === 0) {\r\n      result.push('未选择')\r\n    }\r\n  }\r\n  \r\n  return result\r\n}\r\n\r\n// 从本地存储加载方案数据\r\nconst loadSchemesFromStorage = () => {\r\n  try {\r\n    const savedData = uni.getStorageSync('predict_schemes_data')\r\n    if (savedData && savedData.addedSchemes && Array.isArray(savedData.addedSchemes)) {\r\n      schemes.value = savedData.addedSchemes\r\n    } else {\r\n      schemes.value = []\r\n    }\r\n  } catch (error) {\r\n    schemes.value = []\r\n  }\r\n}\r\n\r\n// 加载期号信息\r\nconst loadIssueInfo = async () => {\r\n  // 防止重复请求\r\n  if (isLoadingIssueInfo.value) {\r\n    console.log('正在加载期号信息，跳过重复请求')\r\n    return\r\n  }\r\n  \r\n  try {\r\n    isLoadingIssueInfo.value = true\r\n    // 从本地存储获取当前彩票类型\r\n    const savedLotteryType = uni.getStorageSync('currentLotteryType')\r\n    if (savedLotteryType) {\r\n      lotteryType.value = savedLotteryType\r\n    } else {\r\n      // 默认使用排列三\r\n      lotteryType.value = { id: 16, code: 16, name: '排列三' }\r\n    }\r\n    \r\n    if (!lotteryType.value || !lotteryType.value.id) {\r\n      return\r\n    }\r\n    \r\n    uni.showLoading({ title: '加载期号中...' })\r\n    \r\n    const response = await apiGetIssueNo({ tname: lotteryType.value.name })\r\n    \r\n    uni.hideLoading()\r\n    \r\n    if (response.code === 200 && response.data !== null && response.data !== undefined) {\r\n      let issueNumberValue = null\r\n      let issueStatus = '待开奖'\r\n      let issueTime = '今天 21:30'\r\n      \r\n      if (typeof response.data === 'number' || typeof response.data === 'string') {\r\n        issueNumberValue = response.data.toString()\r\n      } else if (typeof response.data === 'object') {\r\n        issueNumberValue = response.data.issueno || response.data.number || response.data.id\r\n        issueStatus = response.data.status || '待开奖'\r\n        issueTime = response.data.time || '今天 21:30'\r\n      }\r\n      \r\n      // 直接使用获取到的期号，即使是0也使用\r\n      issueNumber.value = issueNumberValue || '0'\r\n      uni.showToast({ title: `期号加载成功: ${issueNumber.value}`, icon: 'success' })\r\n    } else {\r\n      // 如果接口失败，使用0作为默认期号\r\n      issueNumber.value = '0'\r\n      uni.showToast({ title: '使用默认期号: 0', icon: 'none' })\r\n    }\r\n  } catch (error) {\r\n    uni.hideLoading()\r\n    console.error('加载期号信息失败:', error)\r\n    // 如果加载失败，也使用0作为期号\r\n    issueNumber.value = '0'\r\n    uni.showToast({ title: '期号加载异常，使用默认期号: 0', icon: 'none' })\r\n  } finally {\r\n    isLoadingIssueInfo.value = false\r\n  }\r\n}\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n  uni.navigateBack()\r\n}\r\n\r\n// 跳转到方案页面\r\nconst goToSchemePage = () => {\r\n  console.log('=== 规律帖跳转到方案页面 ===')\r\n  console.log('当前页面:', 'pages/pattern-predict/pattern-predict')\r\n  \r\n  // 准备传递的数据\r\n  const publishData = {\r\n    lotteryType: lotteryType.value,\r\n    issueInfo: {\r\n      id: issueNumber.value,\r\n      number: issueNumber.value,\r\n      status: '待开奖',\r\n      time: '今天 21:30'\r\n    },\r\n    schemes: schemes.value\r\n  }\r\n  \r\n  uni.navigateTo({\r\n    url: `/pages/predict-scheme/predict-scheme?data=${encodeURIComponent(JSON.stringify(publishData))}`,\r\n    success: () => {\r\n      // 跳转成功\r\n    },\r\n    fail: (err) => {\r\n      uni.showToast({\r\n        title: '跳转失败',\r\n        icon: 'none'\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\n// 选择图片\r\nconst selectImage = async () => {\r\n  if (isUploadingImage.value) {\r\n    uni.showToast({\r\n      title: '图片正在上传中，请稍候',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n\r\n  // 计算还能选择多少张图片\r\n  const remainingCount = 6 - selectedImages.value.length\r\n  if (remainingCount <= 0) {\r\n    uni.showToast({\r\n      title: '最多只能选择6张图片',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n\r\n  try {\r\n    // 选择图片\r\n    const chooseResult = await uni.chooseImage({\r\n      count: remainingCount, // 最多选择剩余数量\r\n      sizeType: ['compressed'],\r\n      sourceType: ['album', 'camera']\r\n    })\r\n    \r\n    if (chooseResult.tempFilePaths && chooseResult.tempFilePaths.length > 0) {\r\n      // 显示上传进度\r\n      uni.showLoading({\r\n        title: '上传图片中...'\r\n      })\r\n      \r\n      isUploadingImage.value = true\r\n      \r\n      // 批量上传图片\r\n      const uploadPromises = chooseResult.tempFilePaths.map(async (tempFilePath, index) => {\r\n        try {\r\n          // 在H5环境中，需要将临时路径转换为File对象\r\n          let fileToUpload\r\n          if (process.env.NODE_ENV === 'development' || typeof window !== 'undefined') {\r\n            // H5环境\r\n            const response = await fetch(tempFilePath)\r\n            const blob = await response.blob()\r\n            fileToUpload = new File([blob], `pattern-image-${index}.jpg`, { type: 'image/jpeg' })\r\n          } else {\r\n            // 小程序环境\r\n            fileToUpload = tempFilePath\r\n          }\r\n          \r\n          // 上传到OSS\r\n          return new Promise((resolve, reject) => {\r\n            uploadObject(fileToUpload, (url) => {\r\n              resolve({ tempFilePath, url })\r\n            })\r\n          })\r\n        } catch (error) {\r\n          throw error\r\n        }\r\n      })\r\n      \r\n      // 等待所有图片上传完成\r\n      const uploadResults = await Promise.all(uploadPromises)\r\n      \r\n      // 更新图片列表\r\n      uploadResults.forEach(({ tempFilePath, url }) => {\r\n        selectedImages.value.push(tempFilePath)\r\n        uploadedImageUrls.value.push(url)\r\n      })\r\n      \r\n      uni.hideLoading()\r\n      uni.showToast({\r\n        title: `成功上传${uploadResults.length}张图片`,\r\n        icon: 'success'\r\n      })\r\n      \r\n      isUploadingImage.value = false\r\n    }\r\n  } catch (error) {\r\n    uni.hideLoading()\r\n    isUploadingImage.value = false\r\n    uni.showToast({\r\n      title: '图片上传失败',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\n// 删除图片\r\nconst removeImage = (index) => {\r\n  selectedImages.value.splice(index, 1)\r\n  uploadedImageUrls.value.splice(index, 1)\r\n}\r\n\r\n// 生成帖子内容\r\nconst generatePostContent = () => {\r\n  let content = '【规律预测】\\n\\n'\r\n  \r\n  if (schemes.value.length > 0) {\r\n    schemes.value.forEach((scheme, index) => {\r\n      content += `${index + 1}. [${scheme.id}]\\n`\r\n      \r\n      // 获取方案显示数据\r\n      const schemeDetails = getSchemeDisplayData(scheme)\r\n      schemeDetails.forEach(detail => {\r\n        content += `   ${detail}\\n`\r\n      })\r\n      content += '\\n'\r\n    })\r\n  }\r\n  \r\n  // 使用获取到的期号，即使是0也使用\r\n  const validIssueNumber = issueNumber.value || '0'\r\n  content += `期号: 第${validIssueNumber}期\\n`\r\n  content += `发布时间: ${new Date().toLocaleString()}`\r\n  \r\n  return content\r\n}\r\n\r\n// 处理发布\r\nconst handlePublish = async () => {\r\n  if (!canPublish.value) {\r\n    uni.showToast({\r\n      title: '请完善方案和图片',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n\r\n  if (!uploadedImageUrls.value || uploadedImageUrls.value.length === 0) {\r\n    uni.showToast({\r\n      title: '请等待图片上传完成',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n\r\n  try {\r\n    uni.showLoading({\r\n      title: '发布中...'\r\n    })\r\n\r\n    // 获取当前登录用户的头像URL\r\n    let currentUserAvatar = ''\r\n    const loginData = uni.getStorageSync('loginData') || {}\r\n    if (loginData.himg) {\r\n      currentUserAvatar = loginData.himg\r\n    }\r\n\r\n    // 准备发帖数据\r\n    const postData = {\r\n      tname: lotteryType.value ? `${lotteryType.value.name}-规律预测` : '规律预测', // 彩票名称 - 添加\"规律预测\"标识\r\n      issueno: parseInt(issueNumber.value) || 0, // 期号转换为数字\r\n      content: generatePostContent(), // 发帖内容\r\n      account: getAccount() || '', // 账号\r\n      pimg: uploadedImageUrls.value.join(','), // 多张图片URL用逗号分隔\r\n      flag: false // 需要审核\r\n    }\r\n\r\n    // 检查必要参数\r\n    if (!postData.account) {\r\n      uni.showToast({\r\n        title: '账号信息缺失，请重新登录',\r\n        icon: 'none'\r\n      })\r\n      return\r\n    }\r\n\r\n    if (postData.issueno === null || postData.issueno === undefined || postData.issueno === '') {\r\n      uni.showToast({\r\n        title: '期号信息缺失',\r\n        icon: 'none'\r\n      })\r\n      return\r\n    }\r\n\r\n    if (!postData.content) {\r\n      uni.showToast({\r\n        title: '发帖内容为空',\r\n        icon: 'none'\r\n      })\r\n      return\r\n    }\r\n\r\n    if (!postData.pimg || postData.pimg.trim() === '') {\r\n      uni.showToast({\r\n        title: '请至少上传一张图片',\r\n        icon: 'none'\r\n      })\r\n      return\r\n    }\r\n\r\n    const response = await apiPost(postData)\r\n\r\n    uni.hideLoading()\r\n\r\n    if (response.code === 200) {\r\n      // 发帖成功后，保存当前用户的头像信息到本地存储\r\n      try {\r\n        const userAvatars = uni.getStorageSync('userAvatars') || {}\r\n        userAvatars[getAccount()] = currentUserAvatar\r\n        uni.setStorageSync('userAvatars', userAvatars)\r\n      } catch (error) {\r\n        // 静默处理错误\r\n      }\r\n\r\n      uni.showToast({\r\n        title: '规律帖已提交审核',\r\n        icon: 'success'\r\n      })\r\n\r\n      // 清除本地存储的方案数据和图片URL\r\n      uni.removeStorageSync('predict_schemes_data')\r\n      selectedImages.value = []\r\n      uploadedImageUrls.value = []\r\n\r\n      // 延迟返回规律预测页面\r\n      setTimeout(() => {\r\n        uni.navigateBack()\r\n      }, 1500)\r\n    } else {\r\n      uni.showToast({\r\n        title: response.msg || '发布失败',\r\n        icon: 'none'\r\n      })\r\n    }\r\n\r\n  } catch (error) {\r\n    uni.hideLoading()\r\n    uni.showToast({\r\n      title: '发布失败，请重试',\r\n      icon: 'none'\r\n    })\r\n  }\r\n}\r\n\r\n\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.pattern-predict-container {\r\n  min-height: 100vh;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.nav-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 20rpx 30rpx;\r\n  background-color: #fff;\r\n  border-bottom: 1rpx solid #eee;\r\n}\r\n\r\n.nav-left {\r\n  width: 60rpx;\r\n  height: 60rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.nav-title {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.nav-right {\r\n  width: 60rpx;\r\n}\r\n\r\n.main-content {\r\n  padding: 30rpx;\r\n}\r\n\r\n.scheme-section {\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.scheme-input {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 30rpx;\r\n  border: 2rpx solid #eee;\r\n}\r\n\r\n.issue-info {\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.issue-number {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  font-weight: bold;\r\n}\r\n\r\n.scheme-placeholder {\r\n  padding: 20rpx 0;\r\n}\r\n\r\n.placeholder-text {\r\n  font-size: 28rpx;\r\n  color: #999;\r\n}\r\n\r\n.scheme-display {\r\n  padding: 20rpx 0;\r\n}\r\n\r\n.scheme-content {\r\n  background-color: #f8f8f8;\r\n  padding: 30rpx;\r\n  border-radius: 15rpx;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n.scheme-item {\r\n  margin-bottom: 15rpx;\r\n}\r\n\r\n.scheme-name {\r\n  font-size: 28rpx;\r\n  color: #ff4757;\r\n  font-weight: bold;\r\n  display: block;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.scheme-details {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8rpx;\r\n}\r\n\r\n.scheme-detail {\r\n  font-size: 26rpx;\r\n  color: #333;\r\n  line-height: 1.5;\r\n}\r\n\r\n.image-section {\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.image-upload-container {\r\n  background-color: #fff;\r\n  border-radius: 16rpx;\r\n  padding: 30rpx;\r\n  border: 2rpx solid #eee;\r\n}\r\n\r\n.selected-images {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 20rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.image-item {\r\n  position: relative;\r\n  width: 200rpx;\r\n  height: 200rpx;\r\n}\r\n\r\n.uploaded-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 12rpx;\r\n}\r\n\r\n.image-delete {\r\n  position: absolute;\r\n  top: -10rpx;\r\n  right: -10rpx;\r\n  width: 40rpx;\r\n  height: 40rpx;\r\n  background-color: #ff4757;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.add-image-btn {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 200rpx;\r\n  height: 200rpx;\r\n  border: 2rpx dashed #ccc;\r\n  border-radius: 12rpx;\r\n  background-color: #f8f8f8;\r\n}\r\n\r\n.add-text {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n  margin-top: 10rpx;\r\n}\r\n\r\n.count-text {\r\n  font-size: 20rpx;\r\n  color: #ccc;\r\n  margin-top: 5rpx;\r\n}\r\n\r\n.disclaimer {\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.disclaimer-text {\r\n  font-size: 24rpx;\r\n  color: #ff4757;\r\n  line-height: 1.5;\r\n}\r\n\r\n.bottom-buttons {\r\n  margin-top: 40rpx;\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.modify-btn,\r\n.publish-btn {\r\n  flex: 1;\r\n  height: 88rpx;\r\n  border: none;\r\n  border-radius: 44rpx;\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.modify-btn {\r\n  background-color: #f0f0f0;\r\n  color: #666;\r\n}\r\n\r\n.publish-btn {\r\n  background-color: #ff4757;\r\n  color: #fff;\r\n}\r\n\r\n.publish-btn.disabled {\r\n  background-color: #ccc;\r\n  color: #999;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/caimixcx/pages/pattern-predict/pattern-predict.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","onMounted","onShow","getCOSSecretKey","uni","apiGetIssueNo","getAccount","apiPost"],"mappings":";;;;;;;;;;;;;;;AA4GM,UAAA,cAAcA,kBAAI,EAAE;AACpB,UAAA,iBAAiBA,kBAAI,CAAA,CAAE;AACvB,UAAA,UAAUA,kBAAI,CAAA,CAAE;AAChB,UAAA,cAAcA,kBAAI,IAAI;AACtB,UAAA,oBAAoBA,kBAAI,CAAA,CAAE;AAC1B,UAAA,mBAAmBA,kBAAI,KAAK;AAE5B,UAAA,qBAAqBA,kBAAI,KAAK;AAG9B,UAAA,aAAaC,cAAAA,SAAS,MAAM;AAChC,aAAO,QAAQ,MAAM,SAAS,KAAK,eAAe,MAAM,SAAS;AAAA,IAAA,CAClE;AAGDC,kBAAAA,UAAU,MAAM;AACA;AACS;IAAA,CACxB;AAGDC,kBAAAA,OAAO,MAAM;AACY;IAAA,CACxB;AAGK,UAAA,eAAe,OAAO,MAAM,aAAa;AACzC,UAAA;AACE,YAAA,WAAW,KAAK,QAAQ;AAC5B,cAAM,mBAAmB,SAAS,MAAM,GAAG,EAAE,MAAM,GAAG,SAAS,MAAM,GAAG,EAAE,SAAS,CAAC,EAAE,KAAK,GAAG;AAG9F,cAAM,oBAAuB,oBAAA,KAAO,GAAA,QAAA,IAAY,MAAM,SAAS,MAAM,GAAG,EAAE,SAAS,MAAM,GAAG,EAAE,SAAS,CAAC;AAGxG,YAAI,MAAM,MAAMC,yBAAgB,CAAA,CAAE;AAE9B,YAAA,IAAI,SAAS,KAAK;AACd,gBAAA,IAAI,MAAM,UAAU;AAAA,QAC5B;AAGM,cAAA,MAAM,MAAa;AAGzB,cAAM,YAAY;AAAA,UAChB,QAAQ,IAAI,KAAK,UAAU;AAAA,UAC3B,aAAa,IAAI,KAAK;AAAA,UACtB,iBAAiB,IAAI,KAAK;AAAA,UAC1B,UAAU,IAAI,KAAK;AAAA,UACnB,QAAQ,IAAI,KAAK,UAAU;AAAA;AAAA,UAE3B,UAAU;AAAA;AAAA,UAEV,iBAAiB,YAAY;AAC3B,kBAAM,SAAS,MAAMA,yBAAgB,CAAA,CAAE;AAChC,mBAAA;AAAA,cACL,aAAa,OAAO,KAAK;AAAA,cACzB,iBAAiB,OAAO,KAAK;AAAA,cAC7B,UAAU,OAAO,KAAK;AAAA,YAAA;AAAA,UAE1B;AAAA,UACA,yBAAyB;AAAA;AAAA,QAAA;AAG3B,cAAM,SAAS,IAAI,IAAI,QAAQ,SAAS;AAGxC,cAAM,SAAS,MAAM,OAAO,IAAI,QAAQ,gBAAgB,IAAI,IAAI;AAE5D,YAAA,UAAU,OAAO,KAAK;AAElB,gBAAA,YAAY,iCAAiC,gBAAgB;AAEnE,mBAAS,SAAS;AAAA,QAAA,OACb;AACC,gBAAA,IAAI,MAAM,MAAM;AAAA,QACxB;AAAA,eAEO,OAAO;AACR,cAAA;AAAA,MACR;AAAA,IAAA;AAII,UAAA,uBAAuB,CAAC,WAAW;AACvC,YAAM,OAAO,OAAO;AACpB,YAAM,SAAS,CAAA;AAEf,UAAI,OAAO,OAAO,SAAS,OAAO,OAAO,OAAO;AAE9C,YAAI,KAAK,gBAAgB,KAAK,aAAa,SAAS,GAAG;AACrD,iBAAO,KAAK,OAAO,KAAK,aAAa,KAAK,GAAG,CAAC,EAAE;AAAA,QAAA,OAC3C;AACL,iBAAO,KAAK,SAAS;AAAA,QACvB;AAAA,MAAA,OACK;AAEL,YAAI,KAAK,aAAa,KAAK,UAAU,SAAS,GAAG;AAC/C,cAAI,gBAAgB,OAAO,KAAK,UAAU,KAAK,EAAE,CAAC;AAClD,cAAI,KAAK,uBAAuB,KAAK,oBAAoB,SAAS,GAAG;AACnE,6BAAiB,MAAM,KAAK,oBAAoB,KAAK,EAAE,CAAC;AAAA,UAC1D;AACA,cAAI,KAAK,qBAAqB,KAAK,kBAAkB,SAAS,GAAG;AAC/D,6BAAiB,MAAM,KAAK,kBAAkB,KAAK,EAAE,CAAC;AAAA,UACxD;AACA,iBAAO,KAAK,aAAa;AAAA,QAC3B;AAEA,YAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAC7C,cAAI,eAAe,OAAO,KAAK,SAAS,KAAK,EAAE,CAAC;AAChD,cAAI,KAAK,sBAAsB,KAAK,mBAAmB,SAAS,GAAG;AACjE,4BAAgB,MAAM,KAAK,mBAAmB,KAAK,EAAE,CAAC;AAAA,UACxD;AACA,cAAI,KAAK,oBAAoB,KAAK,iBAAiB,SAAS,GAAG;AAC7D,4BAAgB,MAAM,KAAK,iBAAiB,KAAK,EAAE,CAAC;AAAA,UACtD;AACA,iBAAO,KAAK,YAAY;AAAA,QAC1B;AAEA,YAAI,KAAK,QAAQ,KAAK,KAAK,SAAS,GAAG;AACrC,cAAI,WAAW,OAAO,KAAK,KAAK,KAAK,EAAE,CAAC;AACxC,cAAI,KAAK,kBAAkB,KAAK,eAAe,SAAS,GAAG;AACzD,wBAAY,MAAM,KAAK,eAAe,KAAK,EAAE,CAAC;AAAA,UAChD;AACA,cAAI,KAAK,gBAAgB,KAAK,aAAa,SAAS,GAAG;AACrD,wBAAY,MAAM,KAAK,aAAa,KAAK,EAAE,CAAC;AAAA,UAC9C;AACA,iBAAO,KAAK,QAAQ;AAAA,QACtB;AAEA,YAAI,KAAK,SAAS,KAAK,MAAM,SAAS,GAAG;AACvC,cAAI,YAAY,OAAO,KAAK,MAAM,KAAK,EAAE,CAAC;AAC1C,cAAI,KAAK,mBAAmB,KAAK,gBAAgB,SAAS,GAAG;AAC3D,yBAAa,MAAM,KAAK,gBAAgB,KAAK,EAAE,CAAC;AAAA,UAClD;AACA,cAAI,KAAK,iBAAiB,KAAK,cAAc,SAAS,GAAG;AACvD,yBAAa,MAAM,KAAK,cAAc,KAAK,EAAE,CAAC;AAAA,UAChD;AACA,iBAAO,KAAK,SAAS;AAAA,QACvB;AAEI,YAAA,OAAO,WAAW,GAAG;AACvB,iBAAO,KAAK,KAAK;AAAA,QACnB;AAAA,MACF;AAEO,aAAA;AAAA,IAAA;AAIT,UAAM,yBAAyB,MAAM;AAC/B,UAAA;AACI,cAAA,YAAYC,cAAAA,MAAI,eAAe,sBAAsB;AAC3D,YAAI,aAAa,UAAU,gBAAgB,MAAM,QAAQ,UAAU,YAAY,GAAG;AAChF,kBAAQ,QAAQ,UAAU;AAAA,QAAA,OACrB;AACL,kBAAQ,QAAQ;QAClB;AAAA,eACO,OAAO;AACd,gBAAQ,QAAQ;MAClB;AAAA,IAAA;AAIF,UAAM,gBAAgB,YAAY;AAEhC,UAAI,mBAAmB,OAAO;AAC5BA,sBAAAA,MAAA,MAAA,OAAA,oDAAY,iBAAiB;AAC7B;AAAA,MACF;AAEI,UAAA;AACF,2BAAmB,QAAQ;AAErB,cAAA,mBAAmBA,cAAAA,MAAI,eAAe,oBAAoB;AAChE,YAAI,kBAAkB;AACpB,sBAAY,QAAQ;AAAA,QAAA,OACf;AAEL,sBAAY,QAAQ,EAAE,IAAI,IAAI,MAAM,IAAI,MAAM;QAChD;AAEA,YAAI,CAAC,YAAY,SAAS,CAAC,YAAY,MAAM,IAAI;AAC/C;AAAA,QACF;AAEAA,sBAAAA,MAAI,YAAY,EAAE,OAAO,WAAY,CAAA;AAE/B,cAAA,WAAW,MAAMC,SAAAA,cAAc,EAAE,OAAO,YAAY,MAAM,MAAM;AAEtED,sBAAA,MAAI,YAAY;AAEZ,YAAA,SAAS,SAAS,OAAO,SAAS,SAAS,QAAQ,SAAS,SAAS,QAAW;AAClF,cAAI,mBAAmB;AACvB,cAAI,cAAc;AAClB,cAAI,YAAY;AAEhB,cAAI,OAAO,SAAS,SAAS,YAAY,OAAO,SAAS,SAAS,UAAU;AACvD,+BAAA,SAAS,KAAK;UACxB,WAAA,OAAO,SAAS,SAAS,UAAU;AAC5C,+BAAmB,SAAS,KAAK,WAAW,SAAS,KAAK,UAAU,SAAS,KAAK;AACpE,0BAAA,SAAS,KAAK,UAAU;AAC1B,wBAAA,SAAS,KAAK,QAAQ;AAAA,UACpC;AAGA,sBAAY,QAAQ,oBAAoB;AACpCA,wBAAAA,MAAA,UAAU,EAAE,OAAO,WAAW,YAAY,KAAK,IAAI,MAAM,UAAW,CAAA;AAAA,QAAA,OACnE;AAEL,sBAAY,QAAQ;AACpBA,wBAAA,MAAI,UAAU,EAAE,OAAO,aAAa,MAAM,QAAQ;AAAA,QACpD;AAAA,eACO,OAAO;AACdA,sBAAA,MAAI,YAAY;AAChBA,sBAAA,MAAA,MAAA,SAAA,oDAAc,aAAa,KAAK;AAEhC,oBAAY,QAAQ;AACpBA,sBAAA,MAAI,UAAU,EAAE,OAAO,oBAAoB,MAAM,QAAQ;AAAA,MAAA,UACzD;AACA,2BAAmB,QAAQ;AAAA,MAC7B;AAAA,IAAA;AAIF,UAAM,SAAS,MAAM;AACnBA,oBAAA,MAAI,aAAa;AAAA,IAAA;AAInB,UAAM,iBAAiB,MAAM;2FACf,oBAAoB;AAChCA,oBAAA,uEAAY,SAAS,uCAAuC;AAG5D,YAAM,cAAc;AAAA,QAClB,aAAa,YAAY;AAAA,QACzB,WAAW;AAAA,UACT,IAAI,YAAY;AAAA,UAChB,QAAQ,YAAY;AAAA,UACpB,QAAQ;AAAA,UACR,MAAM;AAAA,QACR;AAAA,QACA,SAAS,QAAQ;AAAA,MAAA;AAGnBA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,6CAA6C,mBAAmB,KAAK,UAAU,WAAW,CAAC,CAAC;AAAA,QACjG,SAAS,MAAM;AAAA,QAEf;AAAA,QACA,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IAAA;AAIH,UAAM,cAAc,YAAY;AAC9B,UAAI,iBAAiB,OAAO;AAC1BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD;AAAA,MACF;AAGM,YAAA,iBAAiB,IAAI,eAAe,MAAM;AAChD,UAAI,kBAAkB,GAAG;AACvBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD;AAAA,MACF;AAEI,UAAA;AAEI,cAAA,eAAe,MAAMA,cAAA,MAAI,YAAY;AAAA,UACzC,OAAO;AAAA;AAAA,UACP,UAAU,CAAC,YAAY;AAAA,UACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAAA,CAC/B;AAED,YAAI,aAAa,iBAAiB,aAAa,cAAc,SAAS,GAAG;AAEvEA,wBAAAA,MAAI,YAAY;AAAA,YACd,OAAO;AAAA,UAAA,CACR;AAED,2BAAiB,QAAQ;AAGzB,gBAAM,iBAAiB,aAAa,cAAc,IAAI,OAAO,cAAc,UAAU;AAC/E,gBAAA;AAEE,kBAAA;AACJ,kBAAI,MAAyE;AAErE,sBAAA,WAAW,MAAM,MAAM,YAAY;AACnC,sBAAA,OAAO,MAAM,SAAS;AACb,+BAAA,IAAI,KAAK,CAAC,IAAI,GAAG,iBAAiB,KAAK,QAAQ,EAAE,MAAM,aAAc,CAAA;AAAA,cAItF;AAGA,qBAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACzB,6BAAA,cAAc,CAAC,QAAQ;AAC1B,0BAAA,EAAE,cAAc,IAAA,CAAK;AAAA,gBAAA,CAC9B;AAAA,cAAA,CACF;AAAA,qBACM,OAAO;AACR,oBAAA;AAAA,YACR;AAAA,UAAA,CACD;AAGD,gBAAM,gBAAgB,MAAM,QAAQ,IAAI,cAAc;AAGtD,wBAAc,QAAQ,CAAC,EAAE,cAAc,UAAU;AAChC,2BAAA,MAAM,KAAK,YAAY;AACpB,8BAAA,MAAM,KAAK,GAAG;AAAA,UAAA,CACjC;AAEDA,wBAAA,MAAI,YAAY;AAChBA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,OAAO,cAAc,MAAM;AAAA,YAClC,MAAM;AAAA,UAAA,CACP;AAED,2BAAiB,QAAQ;AAAA,QAC3B;AAAA,eACO,OAAO;AACdA,sBAAA,MAAI,YAAY;AAChB,yBAAiB,QAAQ;AACzBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AAAA,IAAA;AAII,UAAA,cAAc,CAAC,UAAU;AACd,qBAAA,MAAM,OAAO,OAAO,CAAC;AAClB,wBAAA,MAAM,OAAO,OAAO,CAAC;AAAA,IAAA;AAIzC,UAAM,sBAAsB,MAAM;AAChC,UAAI,UAAU;AAEV,UAAA,QAAQ,MAAM,SAAS,GAAG;AAC5B,gBAAQ,MAAM,QAAQ,CAAC,QAAQ,UAAU;AACvC,qBAAW,GAAG,QAAQ,CAAC,MAAM,OAAO,EAAE;AAAA;AAGhC,gBAAA,gBAAgB,qBAAqB,MAAM;AACjD,wBAAc,QAAQ,CAAU,WAAA;AAC9B,uBAAW,MAAM,MAAM;AAAA;AAAA,UAAA,CACxB;AACU,qBAAA;AAAA,QAAA,CACZ;AAAA,MACH;AAGM,YAAA,mBAAmB,YAAY,SAAS;AAC9C,iBAAW,QAAQ,gBAAgB;AAAA;AACnC,iBAAW,UAAS,oBAAI,KAAK,GAAE,eAAgB,CAAA;AAExC,aAAA;AAAA,IAAA;AAIT,UAAM,gBAAgB,YAAY;AAC5B,UAAA,CAAC,WAAW,OAAO;AACrBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD;AAAA,MACF;AAEA,UAAI,CAAC,kBAAkB,SAAS,kBAAkB,MAAM,WAAW,GAAG;AACpEA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AACD;AAAA,MACF;AAEI,UAAA;AACFA,sBAAAA,MAAI,YAAY;AAAA,UACd,OAAO;AAAA,QAAA,CACR;AAGD,YAAI,oBAAoB;AACxB,cAAM,YAAYA,cAAA,MAAI,eAAe,WAAW,KAAK,CAAA;AACrD,YAAI,UAAU,MAAM;AAClB,8BAAoB,UAAU;AAAA,QAChC;AAGA,cAAM,WAAW;AAAA,UACf,OAAO,YAAY,QAAQ,GAAG,YAAY,MAAM,IAAI,UAAU;AAAA;AAAA,UAC9D,SAAS,SAAS,YAAY,KAAK,KAAK;AAAA;AAAA,UACxC,SAAS,oBAAoB;AAAA;AAAA,UAC7B,SAASE,8BAAgB;AAAA;AAAA,UACzB,MAAM,kBAAkB,MAAM,KAAK,GAAG;AAAA;AAAA,UACtC,MAAM;AAAA;AAAA,QAAA;AAIJ,YAAA,CAAC,SAAS,SAAS;AACrBF,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AACD;AAAA,QACF;AAEI,YAAA,SAAS,YAAY,QAAQ,SAAS,YAAY,UAAa,SAAS,YAAY,IAAI;AAC1FA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AACD;AAAA,QACF;AAEI,YAAA,CAAC,SAAS,SAAS;AACrBA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AACD;AAAA,QACF;AAEA,YAAI,CAAC,SAAS,QAAQ,SAAS,KAAK,WAAW,IAAI;AACjDA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AACD;AAAA,QACF;AAEM,cAAA,WAAW,MAAMG,iBAAQ,QAAQ;AAEvCH,sBAAA,MAAI,YAAY;AAEZ,YAAA,SAAS,SAAS,KAAK;AAErB,cAAA;AACF,kBAAM,cAAcA,cAAA,MAAI,eAAe,aAAa,KAAK,CAAA;AAC7C,wBAAAE,cAAAA,YAAY,IAAI;AACxBF,0BAAAA,MAAA,eAAe,eAAe,WAAW;AAAA,mBACtC,OAAO;AAAA,UAEhB;AAEAA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACP;AAGDA,8BAAI,kBAAkB,sBAAsB;AAC5C,yBAAe,QAAQ;AACvB,4BAAkB,QAAQ;AAG1B,qBAAW,MAAM;AACfA,0BAAA,MAAI,aAAa;AAAA,aAChB,IAAI;AAAA,QAAA,OACF;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,SAAS,OAAO;AAAA,YACvB,MAAM;AAAA,UAAA,CACP;AAAA,QACH;AAAA,eAEO,OAAO;AACdA,sBAAA,MAAI,YAAY;AAChBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1lBF,GAAG,WAAW,eAAe;"}