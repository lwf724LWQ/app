{"version":3,"file":"useTableData.js","sources":["pages/juWang/drawLine/useFunc/useTableData.js"],"sourcesContent":["import {\r\n\tref,\r\n\ttoRaw,\r\n\twatch\r\n} from 'vue';\r\n// import {GetListInfo} from '../../../../api/index.js'\r\n// import { useCounterStore } from '@/stores/counter'\r\n// const counter = useCounterStore()\r\n//该文件是生成表格数据\r\nexport default function useTableData(child, NumberGroups = null,showNumberSelectorCallback) {\r\n\t// 在 useTableData 函数中调用\r\n\tconst externalData=null;\r\n\tconsole.log('useTableData 被调用，externalData:');\r\n\tconst ListInfo = ref([]);\r\n\t// const getListInfo = () => {\r\n\t// \tlet res = uni.request({\r\n\t// \t\turl: \"http://caimi.s7.tunnelfrp.com/web/ticket/query?tname=排列5&page=1&limit=20\"\r\n\t// \t}).then(\r\n\r\n\t\t// )\r\n\t\t// if(res.data.code===200)\r\n\t\t// {\r\n\t\t// \tListInfo.value=res.data.data.records\r\n\t\t// \tconsole.log(res.data.data.records)\r\n\t\t// }\r\n\t// }\r\n\t// getListInfo()\r\n\t// console.log(ListInfo.value)\r\n\r\n\t// -----------------------------------------------------------\r\n\t// 数字组数据（包含期数和随机数）\r\n\tconst storageDrawLineData = uni.getStorageSync('drawLineData');\r\n\t// console.log('storage drawData',storageDrawLineData)\r\n\t// console.log(\"pinia drawData\",counter.storeDrawData)\r\n\r\n\t// const numberGroups = ref([]);\r\n\t// numberGroups.value=counter.storeDrawData\r\n\tconst numberGroups = ref(externalData);\r\n\t// 如果外部数据变化，更新 numberGroups\r\n\tif (externalData) {\r\n\t\twatch(externalData, (newData) => {\r\n\t\t\tnumberGroups.value = newData;\r\n\t\t\tconsole.log(newData)\r\n\t\t});\r\n\t}\r\n\t//调试信息\r\n\tfunction validateDataFormat(data) {\r\n\t\tif (!Array.isArray(data)) {\r\n\t\t\tconsole.warn('数据不是数组:', data);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn data.every(item => {\r\n\t\t\tconst isValid = item &&\r\n\t\t\t\titem.hasOwnProperty('qishu') &&\r\n\t\t\t\titem.hasOwnProperty('numbers') &&\r\n\t\t\t\tArray.isArray(item.numbers) &&\r\n\t\t\t\titem.numbers.length === 6;\r\n\t\t\tif (!isValid) {\r\n\t\t\t\tconsole.warn('数据项格式不正确:', item);\r\n\t\t\t}\r\n\r\n\t\t\treturn isValid;\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\t// 高亮状态存储：格式为 [{groupIndex: 0, numIndex: 1}, ...]\r\n\tconst highlighted = ref([]);\r\n\tconst numberRefs = ref([]);\r\n\r\n\t// 索引对象，用于单元格点击事件\r\n\tconst indexes = {\r\n\t\tcolIndex: 0,\r\n\t\tgroupIndex: 1,\r\n\t};\r\n\r\n\t// function generateNumberGroups() {\r\n\t// \tconst groups = [];\r\n\t// \tfor (let qishu = 0; qishu <= 49; qishu++) {\r\n\t// \t\t// 生成1~50的随机数（qishu2）\r\n\t// \t\tconst qishu2 = 111;\r\n\t// \t\t// console.log(a)\r\n\r\n\t// \t\t// 生成1~9的5个不重复随机数字\r\n\t// \t\tconst numbers = [];\r\n\t// \t\twhile (numbers.length < 5) {\r\n\t// \t\t\tconst randomNum = Math.floor(Math.random() * 9) + 1;\r\n\t// \t\t\tif (!numbers.includes(randomNum)) {\r\n\t// \t\t\t\tnumbers.push(randomNum);\r\n\t// \t\t\t}\r\n\t// \t\t}\r\n\r\n\t// \t\t// 创建包含6个数字的数组：qishu2 + numbers\r\n\t// \t\tconst combinedNumbers = [qishu2, ...numbers];\r\n\r\n\t// \t\tgroups.push({\r\n\t// \t\t\tqishu,\r\n\t// \t\t\tnumbers: combinedNumbers // 使用合并后的数组\r\n\t// \t\t});\r\n\r\n\t// \t}\r\n\t// \treturn setLastFourToEmpty(groups);\r\n\t// }\r\n\t\r\n\t//更新数据与前面的画布一样\r\n\tfunction updateNumberGroups(newData) {\r\n\t\tconsole.log('updateNumberGroups 被调用，数据:', newData);\r\n\t\tif (validateDataFormat(newData)) {\r\n\t\t\t// externalData = newData;\r\n\t\t\t// console.log(externalData[0],'asdddsadsadsadsadsad')\r\n\t\t\tconsole.log('数据更新成功');\r\n\t\t\treturn '数据更新成功';\r\n\t\t} \r\n\t}\r\n\t\r\n\t// // 如果外部数据存在且有效，使用外部数据\r\n\t// if (externalData && validateDataFormat(externalData)) {\r\n\t// \tconsole.log('使用有效的外部数据');\r\n\t// \tnumberGroups.value = externalData;\r\n\t// } else {\r\n\t// \tconsole.log('使用默认生成的数字组');\r\n\t// \tnumberGroups.value = generateNumberGroups();\r\n\t// }\r\n\t// console.log('numberGroups', numberGroups.value, '这里是随机生成的数据')\r\n\r\n\t// 将最后四个qishu2设置为空\r\n\t//  function setLastFourQishu2ToZero(arr) {\r\n\t//      const len = arr.length;\r\n\t//      for (let i = Math.max(0, len - 4); i < len; i++) {\r\n\t//          arr[i].qishu2 = '';\r\n\t//          arr[i].numbers = ['','','','',''];\r\n\t// console.log(arr)\r\n\r\n\t//      }\r\n\t//      return arr;\r\n\t//  }\r\n\r\n\tfunction setLastFourToEmpty(arr) {\r\n\t\tconst len = arr.length;\r\n\t\tfor (let i = Math.max(0, len - 4); i < len; i++) {\r\n\t\t\t// 设置所有6个数字为空\r\n\t\t\tarr[i].numbers = ['', '', '', '', '', ''];\r\n\t\t\t// console.log(arr)\r\n\t\t}\r\n\t\treturn arr;\r\n\t}\r\n\r\n\t// 获取目标行索引（倒数第四行）\r\n\t// function getTargetRowIndex() {\r\n\t// \treturn numberGroups.value.length - 4;\r\n\t// }\r\n\r\n\t// 判断是否为目标行（倒数1~4行）\r\n\tfunction isTargetRow(groupIndex) {\r\n\t\tconst totalRows = 23;\r\n\t\t// 检查当前行索引是否在倒数1~4行范围内\r\n\t\treturn groupIndex > totalRows - 4 && groupIndex <= totalRows;\r\n\t}\r\n\t// 处理单元格点击事件\r\n\tfunction handleCellClick(groupIndex, colIndex) {\r\n\t\t// 检查是否为目标行（倒数第四行）且是2~7列\r\n\t\tif (isTargetRow(groupIndex) && colIndex >= 0 && colIndex <= 6) {\r\n\t\t\t// 这里假设update函数在主组件中定义\r\n\t\t\t// child.value.showFab = true;\r\n\t\t\tindexes.colIndex = colIndex;\r\n\t\t\tindexes.groupIndex = groupIndex;\r\n\t\t\tshowNumberSelectorCallback(indexes.groupIndex,indexes.colIndex);\r\n\t\t}\r\n\t\ttoggleHighlight(groupIndex, colIndex);\r\n\t}\r\n\r\n\r\n\r\n\t// 检查数字是否高亮\r\n\tfunction isHighlighted(groupIndex, numIndex) {\r\n\t\treturn highlighted.value.some(item =>\r\n\t\t\titem.groupIndex === groupIndex && item.numIndex === numIndex\r\n\t\t);\r\n\t}\r\n\r\n\t// 切换数字高亮状态\r\n\tfunction toggleHighlight(groupIndex, numIndex) {\r\n\t\tconst highlightIndex = highlighted.value.findIndex(item =>\r\n\t\t\titem.groupIndex === groupIndex && item.numIndex === numIndex\r\n\t\t);\r\n\t\tif (highlightIndex > -1) {\r\n\t\t\t// 移除高亮\r\n\t\t\thighlighted.value.splice(highlightIndex, 1);\r\n\t\t} else {\r\n\t\t\t// 添加高亮\r\n\t\t\thighlighted.value.push({\r\n\t\t\t\tgroupIndex,\r\n\t\t\t\tnumIndex\r\n\t\t\t}); //参数表示行，列\r\n\t\t\t//当空白格高亮时弹出对话框\r\n\t\t\tif (groupIndex >= 46 && groupIndex <= 49 && numIndex >= 1 && numIndex <= 4) {\r\n\t\t\t\tconsole.log(1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\t// function checkHighlightCondition() {\r\n\t//         // 检查46到49行，1到4列是否有高亮的单元格\r\n\t//         let found = false;\r\n\t//         for (let groupIndex = 46; groupIndex <= 49; groupIndex++) {\r\n\t//             for (let numIndex = 1; numIndex <= 4; numIndex++) {\r\n\t//                 if (isHighlighted(groupIndex, numIndex)) {\r\n\t//                     found = true;\r\n\t//                     break;\r\n\t//                 }\r\n\t//             }\r\n\t//             if (found) break;\r\n\t//         }\r\n\t//         if (found) {\r\n\t//             console.log(1);\r\n\t//         }\r\n\t//     }\r\n\r\n\r\n\t// 处理子组件消息\r\n\t// function handleMessage(msg) {\r\n\t//     const { colIndex, groupIndex } = indexes;\r\n\t//     // 列索引转换：2列对应qishu2，3-7列对应numbers数组\r\n\t//     if (colIndex === 1) {\r\n\t//         // 第2列 - qishu2\r\n\t//         numberGroups.value[groupIndex].qishu2 = msg;\r\n\t//     } else {\r\n\t//         // 第3-7列 - numbers数组（索引0-4）\r\n\t//         const numIndex = colIndex - 2;\r\n\t//         numberGroups.value[groupIndex].numbers[numIndex] = msg;\r\n\t//     }\r\n\t// }\r\n\tfunction handleMessage(msg) {\r\n\t\tconst {\r\n\t\t\tcolIndex,\r\n\t\t\tgroupIndex\r\n\t\t} = indexes;\r\n\t\t// 直接更新对应位置的数字\r\n\t\tnumberGroups.value[groupIndex].numbers[colIndex] = msg;\r\n\t}\r\n\t//=-------------------------------\r\n\tfunction validateDataFormat(data) {\r\n\t\tif (!Array.isArray(data)) return false;\r\n\r\n\t\treturn data.every(item => {\r\n\t\t\treturn item.hasOwnProperty('qishu') &&\r\n\t\t\t\titem.hasOwnProperty('numbers') &&\r\n\t\t\t\tArray.isArray(item.numbers) &&\r\n\t\t\t\titem.numbers.length === 6;\r\n\t\t});\r\n\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\treturn {\r\n\t\tvalidateDataFormat,\r\n\t\tupdateNumberGroups,\r\n\t\tnumberGroups,\r\n\t\thighlighted,\r\n\t\tnumberRefs,\r\n\t\t// getTargetRowIndex,\r\n\t\tisTargetRow,\r\n\t\thandleCellClick,\r\n\t\tisHighlighted,\r\n\t\ttoggleHighlight,\r\n\t\thandleMessage\r\n\t};\r\n}"],"names":["uni","ref"],"mappings":"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"}