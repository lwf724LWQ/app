{"version":3,"file":"alioss.js","sources":["utils/alioss.js"],"sourcesContent":["import OSS from 'ali-oss'\nimport { apigetsts } from '@/api/apis.js'\n\nlet client = null\nlet isInitializing = false\n\nasync function initOSS() {\n  if (isInitializing) {\n    // 如果正在初始化，等待完成\n    return new Promise(resolve => {\n      const checkInterval = setInterval(() => {\n        if (client) {\n          clearInterval(checkInterval)\n          resolve(client)\n        }\n      }, 100)\n    })\n  }\n  \n  isInitializing = true\n  try {\n    const sts = await apigetsts()\n    console.log('STS获取成功:', sts)\n    \n    client = new OSS({\n      accessKeyId: sts.data.STSaccessKeyId,\n      accessKeySecret: sts.data.STSsecretAccessKey,\n      stsToken: sts.data.security_token,\n      bucket: 'cjvd',\n      region: 'oss-cn-guangzhou',\n    })\n    \n    console.log('OSS客户端初始化成功')\n    isInitializing = false\n    return client\n  } catch (error) {\n    console.error('OSS客户端初始化失败:', error)\n    isInitializing = false\n    throw error\n  }\n}\n\n// 导出初始化函数和客户端\nexport { client, initOSS }"],"names":["client","apigetsts","uni","OSS"],"mappings":";;;AAGIA,QAAAA,SAAS;AACb,IAAI,iBAAiB;AAErB,eAAe,UAAU;AACvB,MAAI,gBAAgB;AAElB,WAAO,IAAI,QAAQ,aAAW;AAC5B,YAAM,gBAAgB,YAAY,MAAM;AACtC,YAAIA,gBAAQ;AACV,wBAAc,aAAa;AAC3B,kBAAQA,QAAAA,MAAM;AAAA,QACf;AAAA,MACF,GAAE,GAAG;AAAA,IACZ,CAAK;AAAA,EACF;AAED,mBAAiB;AACjB,MAAI;AACF,UAAM,MAAM,MAAMC,mBAAW;AAC7BC,kBAAAA,4CAAY,YAAY,GAAG;AAE3BF,YAAM,SAAG,IAAIG,cAAAA,IAAI;AAAA,MACf,aAAa,IAAI,KAAK;AAAA,MACtB,iBAAiB,IAAI,KAAK;AAAA,MAC1B,UAAU,IAAI,KAAK;AAAA,MACnB,QAAQ;AAAA,MACR,QAAQ;AAAA,IACd,CAAK;AAEDD,kBAAAA,MAAY,MAAA,OAAA,yBAAA,aAAa;AACzB,qBAAiB;AACjB,WAAOF,QAAM;AAAA,EACd,SAAQ,OAAO;AACdE,kBAAAA,MAAc,MAAA,SAAA,yBAAA,gBAAgB,KAAK;AACnC,qBAAiB;AACjB,UAAM;AAAA,EACP;AACH;;"}