{"version":3,"file":"alioss.js","sources":["utils/alioss.js"],"sourcesContent":["import OSS from 'ali-oss'\r\nimport { apigetsts } from '@/api/apis.js'\r\n\r\nlet client = null\r\nlet isInitializing = false\r\n\r\nasync function initOSS() {\r\n  if (isInitializing) {\r\n    // 如果正在初始化，等待完成\r\n    return new Promise(resolve => {\r\n      const checkInterval = setInterval(() => {\r\n        if (client) {\r\n          clearInterval(checkInterval)\r\n          resolve(client)\r\n        }\r\n      }, 100)\r\n    })\r\n  }\r\n  \r\n  isInitializing = true\r\n  try {\r\n    const sts = await apigetsts()\r\n    console.log('STS获取成功:', sts)\r\n    \r\n    client = new OSS({\r\n      accessKeyId: sts.data.STSaccessKeyId,\r\n      accessKeySecret: sts.data.STSsecretAccessKey,\r\n      stsToken: sts.data.security_token,\r\n      bucket: 'cjvd',\r\n      region: 'oss-cn-guangzhou',\r\n    })\r\n    \r\n    console.log('OSS客户端初始化成功')\r\n    isInitializing = false\r\n    return client\r\n  } catch (error) {\r\n    console.error('OSS客户端初始化失败:', error)\r\n    isInitializing = false\r\n    throw error\r\n  }\r\n}\r\n\r\n// 导出初始化函数和客户端\r\nexport { client, initOSS }"],"names":["client","apigetsts","uni","OSS"],"mappings":";;;AAGIA,QAAAA,SAAS;AACb,IAAI,iBAAiB;AAErB,eAAe,UAAU;AACvB,MAAI,gBAAgB;AAElB,WAAO,IAAI,QAAQ,aAAW;AAC5B,YAAM,gBAAgB,YAAY,MAAM;AACtC,YAAIA,gBAAQ;AACV,wBAAc,aAAa;AAC3B,kBAAQA,QAAAA,MAAM;AAAA,QACf;AAAA,MACF,GAAE,GAAG;AAAA,IACZ,CAAK;AAAA,EACF;AAED,mBAAiB;AACjB,MAAI;AACF,UAAM,MAAM,MAAMC,mBAAW;AAC7BC,kBAAAA,MAAA,MAAA,OAAA,yBAAY,YAAY,GAAG;AAE3BF,YAAM,SAAG,IAAIG,cAAAA,IAAI;AAAA,MACf,aAAa,IAAI,KAAK;AAAA,MACtB,iBAAiB,IAAI,KAAK;AAAA,MAC1B,UAAU,IAAI,KAAK;AAAA,MACnB,QAAQ;AAAA,MACR,QAAQ;AAAA,IACd,CAAK;AAEDD,kBAAAA,4CAAY,aAAa;AACzB,qBAAiB;AACjB,WAAOF,QAAM;AAAA,EACd,SAAQ,OAAO;AACdE,kBAAAA,MAAc,MAAA,SAAA,yBAAA,gBAAgB,KAAK;AACnC,qBAAiB;AACjB,UAAM;AAAA,EACP;AACH;;"}