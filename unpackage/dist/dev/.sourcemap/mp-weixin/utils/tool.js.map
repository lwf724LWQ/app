{"version":3,"file":"tool.js","sources":["utils/tool.js"],"sourcesContent":["import { client, initOSS } from \"./alioss.js\";\nimport { nanoid } from 'nanoid';\n\nconst tool = {\n  oss: {\n    async upload(file, options = {}) {\n      try {\n        // 确保客户端已初始化\n        let ossClient = client\n        if (!ossClient) {\n          ossClient = await initOSS()\n        }\n        \n        // 从选项中获取文件夹路径和文件名前缀\n        const folder = options.folder || 'uploads'\n        const prefix = options.prefix || ''\n        \n        // 安全地获取文件名\n        let fileName = ''\n        if (file && file.name) {\n          fileName = file.name\n        } else if (file && file.path) {\n          const pathParts = file.path.split('/')\n          fileName = pathParts[pathParts.length - 1]\n        } else {\n          throw new Error('文件对象格式不正确，缺少 name 或 path 属性')\n        }\n        \n        // 安全地截取文件后缀名\n        const index = fileName.lastIndexOf('.')\n        if (index === -1) {\n          throw new Error('文件名不包含扩展名')\n        }\n        const suffix = fileName.substring(index + 1)\n        \n        // 生成唯一文件名\n        const uuid = nanoid()\n        const remoteFileName = `${folder}/${prefix}${uuid}.${suffix}`\n        \n        console.log('上传文件信息:', {\n          原始文件名: fileName,\n          远程文件名: remoteFileName,\n        })\n        \n        // 使用 put 方法（兼容性更好）\n        return await ossClient.put(remoteFileName, file, {\n          progress: options.progress || function(p) {\n            console.log('上传进度:', Math.round(p * 100) + '%')\n          },\n        })\n      } catch (error) {\n        console.error('上传文件时发生错误:', error)\n        throw error\n      }\n    }\n  },\n}\n\nexport default tool"],"names":["client","initOSS","nanoid","uni"],"mappings":";;;AAGK,MAAC,OAAO;AAAA,EACX,KAAK;AAAA,IACH,MAAM,OAAO,MAAM,UAAU,IAAI;AAC/B,UAAI;AAEF,YAAI,YAAYA,aAAM;AACtB,YAAI,CAAC,WAAW;AACd,sBAAY,MAAMC,aAAAA,QAAS;AAAA,QAC5B;AAGD,cAAM,SAAS,QAAQ,UAAU;AACjC,cAAM,SAAS,QAAQ,UAAU;AAGjC,YAAI,WAAW;AACf,YAAI,QAAQ,KAAK,MAAM;AACrB,qBAAW,KAAK;AAAA,QAC1B,WAAmB,QAAQ,KAAK,MAAM;AAC5B,gBAAM,YAAY,KAAK,KAAK,MAAM,GAAG;AACrC,qBAAW,UAAU,UAAU,SAAS,CAAC;AAAA,QACnD,OAAe;AACL,gBAAM,IAAI,MAAM,6BAA6B;AAAA,QAC9C;AAGD,cAAM,QAAQ,SAAS,YAAY,GAAG;AACtC,YAAI,UAAU,IAAI;AAChB,gBAAM,IAAI,MAAM,WAAW;AAAA,QAC5B;AACD,cAAM,SAAS,SAAS,UAAU,QAAQ,CAAC;AAG3C,cAAM,OAAOC,cAAAA,OAAQ;AACrB,cAAM,iBAAiB,GAAG,MAAM,IAAI,MAAM,GAAG,IAAI,IAAI,MAAM;AAE3DC,sBAAAA,MAAY,MAAA,OAAA,uBAAA,WAAW;AAAA,UACrB,OAAO;AAAA,UACP,OAAO;AAAA,QACjB,CAAS;AAGD,eAAO,MAAM,UAAU,IAAI,gBAAgB,MAAM;AAAA,UAC/C,UAAU,QAAQ,YAAY,SAAS,GAAG;AACxCA,0BAAAA,MAAY,MAAA,OAAA,uBAAA,SAAS,KAAK,MAAM,IAAI,GAAG,IAAI,GAAG;AAAA,UAC/C;AAAA,QACX,CAAS;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAc,MAAA,SAAA,uBAAA,cAAc,KAAK;AACjC,cAAM;AAAA,MACP;AAAA,IACF;AAAA,EACF;AACH;;"}