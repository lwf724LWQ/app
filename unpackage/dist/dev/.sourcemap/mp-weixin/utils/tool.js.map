{"version":3,"file":"tool.js","sources":["utils/tool.js"],"sourcesContent":["import { client, initOSS } from \"./alioss.js\";\r\nimport { nanoid } from 'nanoid/non-secure';\r\n\r\nconst tool = {\r\n  oss: {\r\n    async upload(file, options = {}) {\r\n      try {\r\n        // 确保客户端已初始化\r\n        let ossClient = client\r\n        if (!ossClient) {\r\n          ossClient = await initOSS()\r\n        }\r\n        \r\n        // 从选项中获取文件夹路径和文件名前缀\r\n        const folder = options.folder || 'uploads'\r\n        const prefix = options.prefix || ''\r\n        \r\n        // 安全地获取文件名\r\n        let fileName = ''\r\n        if (file && file.name) {\r\n          fileName = file.name\r\n        } else if (file && file.path) {\r\n          const pathParts = file.path.split('/')\r\n          fileName = pathParts[pathParts.length - 1]\r\n        } else {\r\n          throw new Error('文件对象格式不正确，缺少 name 或 path 属性')\r\n        }\r\n        \r\n        // 安全地截取文件后缀名\r\n        const index = fileName.lastIndexOf('.')\r\n        if (index === -1) {\r\n          throw new Error('文件名不包含扩展名')\r\n        }\r\n        const suffix = fileName.substring(index + 1)\r\n        \r\n        // 生成唯一文件名\r\n        const uuid = nanoid()\r\n        const remoteFileName = `${folder}/${prefix}${uuid}.${suffix}`\r\n        \r\n        console.log('上传文件信息:', {\r\n          原始文件名: fileName,\r\n          远程文件名: remoteFileName,\r\n        })\r\n        \r\n        // 使用 put 方法（兼容性更好）\r\n        return await ossClient.put(remoteFileName, file, {\r\n          progress: options.progress || function(p) {\r\n            console.log('上传进度:', Math.round(p * 100) + '%')\r\n          },\r\n        })\r\n      } catch (error) {\r\n        console.error('上传文件时发生错误:', error)\r\n        throw error\r\n      }\r\n    }\r\n  },\r\n}\r\n\r\nexport default tool"],"names":["client","initOSS","nanoid","uni"],"mappings":";;;AAGK,MAAC,OAAO;AAAA,EACX,KAAK;AAAA,IACH,MAAM,OAAO,MAAM,UAAU,IAAI;AAC/B,UAAI;AAEF,YAAI,YAAYA,aAAM;AACtB,YAAI,CAAC,WAAW;AACd,sBAAY,MAAMC,aAAAA,QAAS;AAAA,QAC5B;AAGD,cAAM,SAAS,QAAQ,UAAU;AACjC,cAAM,SAAS,QAAQ,UAAU;AAGjC,YAAI,WAAW;AACf,YAAI,QAAQ,KAAK,MAAM;AACrB,qBAAW,KAAK;AAAA,QAC1B,WAAmB,QAAQ,KAAK,MAAM;AAC5B,gBAAM,YAAY,KAAK,KAAK,MAAM,GAAG;AACrC,qBAAW,UAAU,UAAU,SAAS,CAAC;AAAA,QACnD,OAAe;AACL,gBAAM,IAAI,MAAM,6BAA6B;AAAA,QAC9C;AAGD,cAAM,QAAQ,SAAS,YAAY,GAAG;AACtC,YAAI,UAAU,IAAI;AAChB,gBAAM,IAAI,MAAM,WAAW;AAAA,QAC5B;AACD,cAAM,SAAS,SAAS,UAAU,QAAQ,CAAC;AAG3C,cAAM,OAAOC,cAAAA,OAAQ;AACrB,cAAM,iBAAiB,GAAG,MAAM,IAAI,MAAM,GAAG,IAAI,IAAI,MAAM;AAE3DC,sBAAAA,0CAAY,WAAW;AAAA,UACrB,OAAO;AAAA,UACP,OAAO;AAAA,QACjB,CAAS;AAGD,eAAO,MAAM,UAAU,IAAI,gBAAgB,MAAM;AAAA,UAC/C,UAAU,QAAQ,YAAY,SAAS,GAAG;AACxCA,0BAAAA,MAAY,MAAA,OAAA,uBAAA,SAAS,KAAK,MAAM,IAAI,GAAG,IAAI,GAAG;AAAA,UAC/C;AAAA,QACX,CAAS;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAAA,MAAA,MAAA,SAAA,uBAAc,cAAc,KAAK;AACjC,cAAM;AAAA,MACP;AAAA,IACF;AAAA,EACF;AACH;;"}